<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Advanced Operations Dashboard with KPIs</title>
    <meta name="description" content="Professional operations dashboard with KPI tracking and dynamic downtime-based calculations">
    <meta name="keywords" content="operations, dashboard, KPI, performance tracking, business analytics">
    <meta name="author" content="Operations Dashboard Team">
    
    <!-- External CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Main Application Container -->
    <div class="main-container">
        <!-- Header Section -->
        <header class="header">
            <h1>ğŸ“Š Advanced Operations Dashboard with KPI Analytics</h1>
            <p>Integrated Daily & Monthly Tracking with Dynamic Percentage Calculation & KPI Monitoring</p>
        </header>

        <!-- Main Content Area -->
        <main class="content">
            <!-- Top Controls Panel -->
            <section class="top-controls" role="region" aria-label="Dashboard Controls">
                <div class="control-row">
                    <div class="control-group">
                        <label for="landscapeSelect">ğŸŒ Landscape:</label>
                        <div class="landscape-controls">
                            <select id="landscapeSelect" aria-label="Select landscape">
                                <!-- Dynamically populated by JavaScript -->
                            </select>
                            <button class="add-landscape-btn" onclick="addNewLandscape()" 
                                    title="Add New Landscape" aria-label="Add new landscape">â•</button>
                        </div>
                    </div>

                    <div class="control-group" id="monthControl">
                        <label for="monthSelect">ğŸ“… Month:</label>
                        <input type="month" id="monthSelect" aria-label="Select month">
                    </div>

                    <div class="control-group" id="dateControl" style="display: none;">
                        <label for="dateSelect">ğŸ“… Date:</label>
                        <input type="date" id="dateSelect" aria-label="Select date">
                    </div>

                    <div class="control-group">
                        <label>ğŸ“Š View Mode:</label>
                        <div class="view-toggle" role="tablist">
                            <button class="toggle-btn active" onclick="switchView('monthly')" 
                                    role="tab" aria-selected="true">ğŸ“Š Monthly</button>
                            <button class="toggle-btn" onclick="switchView('daily')" 
                                    role="tab" aria-selected="false">ğŸ“… Daily</button>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <nav class="action-buttons" role="navigation" aria-label="Dashboard Actions">
                    <button class="btn btn-primary" onclick="loadCurrentView()" aria-label="Refresh current view">ğŸ”„ Refresh</button>
                    <button class="btn btn-success" onclick="showAddSkillModal()" aria-label="Add new skill">â• Add Skill</button>
                    <button class="btn btn-primary" onclick="exportToExcel()" aria-label="Export to Excel">ğŸ“Š Export Excel Report</button>
                    <button class="btn btn-primary" onclick="importData()" aria-label="Import data">ğŸ“¤ Import</button>
                    <button class="btn btn-primary" onclick="showHistoryModal()" aria-label="View history">ğŸ“‹ History</button>
                    <button class="btn btn-danger" onclick="clearCurrentData()" aria-label="Clear current data">ğŸ—‘ï¸ Clear</button>
                </nav>
            </section>

            <!-- KPI Dashboard Section -->
            <section class="kpi-dashboard" role="region" aria-label="Key Performance Indicators">
                <h3>ğŸ“ˆ Key Performance Indicators</h3>
                
                <!-- Monthly KPIs -->
                <div class="kpi-section monthly-kpis">
                    <h4>ğŸ“… Monthly Performance - <span id="currentMonthDisplay"></span></h4>
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div class="kpi-value" id="monthlyOverallAvailability">0%</div>
                            <div class="kpi-label">Overall Availability</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-value" id="monthlyGreenPercentage">0%</div>
                            <div class="kpi-label">ğŸŸ¢ Green Performance</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-value" id="monthlyAmberPercentage">0%</div>
                            <div class="kpi-label">ğŸŸ¡ Amber Performance</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-value" id="monthlyRedPercentage">0%</div>
                            <div class="kpi-label">ğŸ”´ Red Performance</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-value" id="monthlyTrendIndicator">ğŸ“Š</div>
                            <div class="kpi-label">Monthly Trend</div>
                        </div>
                    </div>
                </div>

                <!-- Yearly KPIs -->
                <div class="kpi-section yearly-kpis">
                    <h4>ğŸ“Š Yearly Performance - <span id="currentYearDisplay"></span></h4>
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div class="kpi-value" id="yearlyOverallAvailability">0%</div>
                            <div class="kpi-label">Overall Availability</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-value" id="yearlyGreenPercentage">0%</div>
                            <div class="kpi-label">ğŸŸ¢ Green Performance</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-value" id="yearlyAmberPercentage">0%</div>
                            <div class="kpi-label">ğŸŸ¡ Amber Performance</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-value" id="yearlyRedPercentage">0%</div>
                            <div class="kpi-label">ğŸ”´ Red Performance</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-value" id="yearlyTrendIndicator">ğŸ“Š</div>
                            <div class="kpi-label">Yearly Trend</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Dynamic Percentage Information -->
            <section class="percentage-info" role="region" aria-label="Calculation Information">
                <h4>ğŸ¤– Dynamic Percentage Calculation (Downtime-Based)</h4>
                <ul>
                    <li>ğŸŸ¢ <strong>Green (95-100%):</strong> Minimal downtime (â‰¤1.2 hours/day)</li>
                    <li>ğŸŸ¡ <strong>Amber (45-95%):</strong> Moderate downtime (1.2-13.2 hours/day)</li>
                    <li>ğŸ”´ <strong>Red (0-45%):</strong> High downtime (>13.2 hours/day)</li>
                    <li>ğŸ“Š <strong>Monthly View:</strong> Shows weekly averages calculated from daily data</li>
                </ul>
            </section>

            <!-- Legend Section -->
            <section class="legend-section" role="region" aria-label="Status Legend">
                <div class="legend">
                    <strong style="color: #28a745; font-size: 18px;">ğŸ“Œ Status Guide:</strong>
                    <div class="legend-item">
                        <div class="legend-dot dot-green" aria-hidden="true"></div>
                        <span>Green - Optimal Performance (95-100%)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot dot-amber" aria-hidden="true"></div>
                        <span>Amber - Needs Attention (45-95%)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot dot-red" aria-hidden="true"></div>
                        <span>Red - Critical Issues (0-45%)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot dot-none" aria-hidden="true"></div>
                        <span>No Data Available (0%)</span>
                    </div>
                </div>
            </section>

            <!-- Summary Cards -->
            <section class="summary-cards" role="region" aria-label="Performance Summary">
                <div class="summary-card">
                    <h3 id="totalCount">0</h3>
                    <p>Total Entries</p>
                </div>
                <div class="summary-card green">
                    <h3 id="greenCount">0</h3>
                    <p>ğŸŸ¢ Optimal Performance</p>
                </div>
                <div class="summary-card amber">
                    <h3 id="amberCount">0</h3>
                    <p>ğŸŸ¡ Needs Attention</p>
                </div>
                <div class="summary-card red">
                    <h3 id="redCount">0</h3>
                    <p>ğŸ”´ Critical Issues</p>
                </div>
            </section>

            <!-- Skill Management -->
            <section class="skill-management" role="region" aria-label="Skill Management">
                <h4>ğŸ› ï¸ Skill Management</h4>
                <p>Manage operational skills being tracked</p>
                <div class="add-skill-form">
                    <input type="text" id="newSkillInput" placeholder="Enter new skill name" 
                           aria-label="New skill name">
                    <button class="btn btn-success" onclick="addSkill()">Add Skill</button>
                </div>
                <div class="skill-list" id="skillList" role="list">
                    <!-- Skills displayed here by JavaScript -->
                </div>
            </section>

            <!-- Main Dashboard Container -->
            <section class="view-container" role="region" aria-label="Dashboard Data">
                <!-- Monthly View -->
                <div id="monthlyView" role="tabpanel" aria-labelledby="monthly-tab">
                    <!-- Weekly Availability KPIs Above Table -->
                    <div class="weekly-kpis" id="weeklyKPIs">
                        <h4>ğŸ“Š Weekly Skill Availability Overview</h4>
                        <div class="weekly-kpi-grid" id="weeklyKPIGrid">
                            <!-- Weekly KPIs will be generated dynamically -->
                        </div>
                    </div>
                    
                    <table class="grid-table" id="monthlyTable" role="grid">
                        <thead id="monthlyHeaders">
                            <!-- Headers generated dynamically by JavaScript -->
                        </thead>
                        <tbody id="monthlyBody">
                            <!-- Body generated dynamically by JavaScript -->
                        </tbody>
                    </table>
                </div>

                <!-- Daily View -->
                <div id="dailyView" style="display: none;" role="tabpanel" aria-labelledby="daily-tab">
                    <div class="daily-container">
                        <div class="daily-stats">
                            <h3 style="color: #28a745; margin-bottom: 15px;">ğŸ“Š Daily Performance Statistics</h3>
                            <div style="display: flex; gap: 30px; flex-wrap: wrap;">
                                <div style="text-align: center;">
                                    <div style="font-size: 2rem; color: #28a745; font-weight: bold;" id="dailyCompletion">0%</div>
                                    <div style="font-weight: 600;">Today's Average</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 2rem; color: #28a745; font-weight: bold;" id="weeklyAverage">0%</div>
                                    <div style="font-weight: 600;">Weekly Average</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 2rem; color: #28a745; font-weight: bold;" id="trendIndicator">ğŸ“ˆ</div>
                                    <div style="font-weight: 600;">Performance Trend</div>
                                </div>
                            </div>
                        </div>
                        <div class="daily-grid" id="dailyGrid" role="grid">
                            <!-- Daily grid generated dynamically by JavaScript -->
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal Dialogs (same as before) -->
    <!-- Edit Entry Modal -->
    <div id="editModal" class="modal" role="dialog" aria-labelledby="edit-modal-title" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="edit-modal-title">âœï¸ Edit Entry</h3>
                <button class="close-btn" onclick="closeModal()" aria-label="Close modal">&times;</button>
            </div>
            
            <form onsubmit="return false;">
                <div class="form-group">
                    <label for="modalSkill">ğŸ“‹ Skill:</label>
                    <input type="text" id="modalSkill" readonly>
                </div>
                
                <div class="form-group">
                    <label for="modalPeriod">ğŸ“… Period:</label>
                    <input type="text" id="modalPeriod" readonly>
                </div>
                
                <div class="form-group">
                    <label for="modalDate">ğŸ“… Date:</label>
                    <input type="date" id="modalDate">
                </div>

                <div id="conditionalFields" class="conditional-section">
                    <h5>â±ï¸ Downtime Configuration (Determines Status & Percentage)</h5>
                    <div class="form-group">
                        <label for="modalDowntime">â±ï¸ Downtime Hours (0-24):</label>
                        <input type="number" id="modalDowntime" step="0.5" min="0" max="24" 
                               placeholder="0.0" oninput="updateStatusFromDowntime()">
                        <small style="color: #666; display: block; margin-top: 5px;">
                            â€¢ 0-1.2 hours: Green (95-100%)<br>
                            â€¢ 1.2-13.2 hours: Amber (45-95%)<br>
                            â€¢ 13.2+ hours: Red (0-45%)
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="modalIncident">ğŸ†” Incident Number (if applicable):</label>
                        <input type="text" id="modalIncident" placeholder="INC123456">
                    </div>
                </div>

                <div class="form-group">
                    <label for="modalNotes">ğŸ“ Notes:</label>
                    <textarea id="modalNotes" rows="4" placeholder="Additional details and comments..."></textarea>
                </div>

                <div class="form-group">
                    <label for="modalPercentage">ğŸ“Š Calculated Performance (Auto-Calculated from Downtime):</label>
                    <input type="text" id="modalPercentage" readonly 
                           style="background: #f8f9fa; cursor: not-allowed; font-weight: bold; font-size: 1.2rem;">
                    <small style="color: #666; margin-top: 5px; display: block;">
                        Percentage and status automatically calculated based on downtime hours.
                    </small>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-success" onclick="saveEntry()">ğŸ’¾ Save</button>
                    <button type="button" class="btn btn-danger" onclick="deleteEntry()">ğŸ—‘ï¸ Delete</button>
                    <button type="button" class="btn btn-primary" onclick="closeModal()">âŒ Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- History Modal -->
    <div id="historyModal" class="modal" role="dialog" aria-labelledby="history-modal-title" aria-hidden="true">
        <div class="modal-content" style="width: 95%; max-width: 1200px;">
            <div class="modal-header">
                <h3 id="history-modal-title">ğŸ“‹ Entry History - Click any entry to edit</h3>
                <button class="close-btn" onclick="closeHistoryModal()" aria-label="Close history modal">&times;</button>
            </div>
            
            <div style="margin-bottom: 25px; display: flex; gap: 15px; flex-wrap: wrap;">
                <button class="btn btn-success" onclick="exportHistoryToExcel()">ğŸ“Š Export History to Excel</button>
                <select id="historyFilter" onchange="filterHistory()" style="padding: 10px;" aria-label="Filter by landscape">
                    <option value="">All Landscapes</option>
                </select>
            </div>

            <div style="max-height: 500px; overflow-y: auto;">
                <table class="history-table" role="grid">
                    <thead>
                        <tr role="row">
                            <th scope="col">Date</th>
                            <th scope="col">Landscape</th>
                            <th scope="col">Skill</th>
                            <th scope="col">Period</th>
                            <th scope="col">Status</th>
                            <th scope="col">Performance %</th>
                            <th scope="col">Downtime (h)</th>
                            <th scope="col">Incident</th>
                            <th scope="col">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="historyTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add Landscape Modal -->
    <div id="addLandscapeModal" class="modal" role="dialog" aria-labelledby="landscape-modal-title" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="landscape-modal-title">ğŸŒ Add New Landscape</h3>
                <button class="close-btn" onclick="closeAddLandscapeModal()" aria-label="Close landscape modal">&times;</button>
            </div>
            
            <form onsubmit="return false;">
                <div class="form-group">
                    <label for="newLandscapeName">ğŸ·ï¸ Landscape Name:</label>
                    <input type="text" id="newLandscapeName" placeholder="Enter landscape name (e.g., APAC, EMEA)">
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-success" onclick="saveNewLandscape()">ğŸ’¾ Add Landscape</button>
                    <button type="button" class="btn btn-primary" onclick="closeAddLandscapeModal()">âŒ Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Hidden File Input for Import -->
    <input type="file" id="fileInput" accept=".json" style="display: none;" 
           onchange="handleFileImport(event)" aria-label="Import data file">

    <!-- External JavaScript -->
    <script src="main.js"></script>
</body>
</html>
