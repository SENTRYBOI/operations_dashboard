<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>üîπ HBoard - Advanced Operations Excellence Dashboard v2024 üîπ</title>
    <meta name="description" content="Production-ready operations dashboard with Firebase authentication, SMTP integration, dynamic KPI analytics, real-time team collaboration, and email screenshot functionality">
    
    <!-- External CDN Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3.11.0/dist/email.min.js"></script>
    <script src="https://smtpjs.com/v3/smtp.js"></script>
    
    <!-- Firebase SDK v9 -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, collection, addDoc } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js';
        
        // Firebase configuration (replace with your config)
        const firebaseConfig = {
            apiKey: "your-api-key",
            authDomain: "your-project.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "your-sender-id",
            appId: "your-app-id"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // Make Firebase available globally
        window.firebaseAuth = auth;
        window.firebaseDB = db;
        window.firebaseSignIn = signInWithEmailAndPassword;
        window.firebaseSignUp = createUserWithEmailAndPassword;
        window.firebaseSignOut = signOut;
        window.firebaseAuthStateChanged = onAuthStateChanged;
    </script>
    
    <style>
        /* Global Styles and CSS Variables */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-green: #28a745;
            --secondary-teal: #20c997;
            --accent-blue: #17a2b8;
            --warning-amber: #ffc107;
            --danger-red: #dc3545;
            --light-gray: #f8f9fa;
            --medium-gray: #6c757d;
            --dark-gray: #343a40;
            --border-color: #dee2e6;
            --shadow-light: 0 2px 10px rgba(0,0,0,0.1);
            --shadow-medium: 0 4px 20px rgba(0,0,0,0.15);
            --shadow-heavy: 0 8px 30px rgba(0,0,0,0.2);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --gradient-primary: linear-gradient(135deg, var(--primary-green) 0%, var(--secondary-teal) 100%);
            --gradient-secondary: linear-gradient(135deg, var(--secondary-teal) 0%, var(--accent-blue) 100%);
        }
        
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--dark-gray);
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
            font-size: 14px;
            padding: 10px;
        }

        /* Authentication Section Styles */
        #auth-section {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(10px);
        }

        .auth-container {
            background: white;
            padding: 50px;
            border-radius: 20px;
            box-shadow: var(--shadow-heavy);
            text-align: center;
            min-width: 450px;
            max-width: 500px;
            border: 3px solid var(--primary-green);
            position: relative;
            animation: slideInUp 0.6s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(100px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .auth-container h2 {
            color: var(--primary-green);
            font-size: 2.5rem;
            margin-bottom: 15px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .auth-container .subtitle {
            color: var(--medium-gray);
            margin-bottom: 40px;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .auth-form input {
            padding: 18px 25px;
            border: 3px solid var(--primary-green);
            border-radius: 12px;
            font-size: 18px;
            background: white;
            color: var(--dark-gray);
            transition: var(--transition);
            font-family: inherit;
        }

        .auth-form input:focus {
            outline: none;
            border-color: var(--secondary-teal);
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
            transform: translateY(-2px);
        }

        .auth-form input::placeholder {
            color: var(--medium-gray);
        }

        .auth-buttons {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }

        .auth-btn {
            flex: 1;
            padding: 18px 25px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            font-family: inherit;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .auth-btn.signup {
            background: var(--primary-green);
            color: white;
            border: 3px solid var(--primary-green);
        }

        .auth-btn.signup:hover {
            background: var(--secondary-teal);
            border-color: var(--secondary-teal);
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }

        .auth-btn.signin {
            background: transparent;
            color: var(--primary-green);
            border: 3px solid var(--primary-green);
        }

        .auth-btn.signin:hover {
            background: var(--primary-green);
            color: white;
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }

        .auth-btn.signout {
            background: var(--danger-red);
            color: white;
            border: 3px solid var(--danger-red);
            position: fixed;
            top: 20px;
            right: 20px;
            flex: none;
            padding: 12px 20px;
            font-size: 14px;
            z-index: 10000;
            border-radius: 25px;
        }

        .auth-btn.signout:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .auth-status {
            margin-top: 25px;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 16px;
        }

        .auth-status.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .auth-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .auth-loading {
            color: var(--primary-green);
            font-style: italic;
        }

        .auth-divider {
            margin: 30px 0;
            position: relative;
            text-align: center;
        }

        .auth-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--border-color);
        }

        .auth-divider span {
            background: white;
            padding: 0 20px;
            color: var(--medium-gray);
            font-weight: 600;
        }

        .admin-badge {
            background: #ff6b6b;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            position: absolute;
            top: -10px;
            right: -10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Connection Status */
        .connection-status {
            position: fixed;
            top: 10px;
            left: 20px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1000;
            transition: var(--transition);
        }

        .connection-status.connected {
            background: var(--primary-green);
            color: white;
        }

        .connection-status.connecting {
            background: var(--warning-amber);
            color: var(--dark-gray);
        }

        .connection-status.offline {
            background: var(--danger-red);
            color: white;
        }

        .connection-status.admin {
            background: #ff6b6b;
            color: white;
            animation: pulse 2s infinite;
        }

        /* Main Container */
        .main-container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-heavy);
            overflow: hidden;
            border: 2px solid var(--primary-green);
            display: none; /* Hidden by default until authenticated */
        }
        
        /* Header Styles */
        .header {
            background: var(--gradient-primary);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 2.4rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .header .subtitle {
            font-size: 1.15rem;
            opacity: 0.95;
            font-weight: 500;
        }
        
        .version-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .user-info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: none;
        }
        
        /* Content Area */
        .content {
            padding: 25px;
            background: var(--light-gray);
        }
        
        /* Control Panel */
        .control-panel {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow-light);
            border: 2px solid var(--primary-green);
        }
        
        .control-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 180px;
        }
        
        .control-group label {
            font-weight: 700;
            color: var(--primary-green);
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Form Elements */
        select, input[type="month"], input[type="date"], input[type="text"], input[type="number"], input[type="email"] {
            padding: 12px 16px;
            border: 2px solid var(--primary-green);
            border-radius: 8px;
            font-size: 14px;
            background: white;
            color: var(--dark-gray);
            transition: var(--transition);
            font-family: inherit;
        }
        
        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: var(--secondary-teal);
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
            transform: translateY(-1px);
        }
        
        textarea {
            padding: 12px 16px;
            border: 2px solid var(--primary-green);
            border-radius: 8px;
            font-size: 14px;
            background: white;
            color: var(--dark-gray);
            resize: vertical;
            font-family: inherit;
            min-height: 80px;
        }
        
        /* View Toggle */
        .view-toggle {
            display: flex;
            background: var(--border-color);
            border-radius: 25px;
            padding: 4px;
            border: 2px solid var(--primary-green);
        }
        
        .toggle-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 20px;
            background: transparent;
            color: var(--medium-gray);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .toggle-btn.active {
            background: var(--primary-green);
            color: white;
            box-shadow: var(--shadow-light);
        }
        
        .toggle-btn:hover:not(.active) {
            background: rgba(40, 167, 69, 0.1);
            color: var(--primary-green);
        }
        
        /* Buttons */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border: 2px solid transparent;
        }
        
        .btn-primary {
            background: var(--primary-green);
            color: white;
            border-color: var(--primary-green);
        }
        
        .btn-primary:hover {
            background: var(--secondary-teal);
            border-color: var(--secondary-teal);
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        .btn-success {
            background: var(--secondary-teal);
            color: white;
            border-color: var(--secondary-teal);
        }
        
        .btn-success:hover {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        .btn-warning {
            background: var(--warning-amber);
            color: var(--dark-gray);
            border-color: var(--warning-amber);
        }
        
        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        .btn-danger {
            background: var(--danger-red);
            color: white;
            border-color: var(--danger-red);
        }
        
        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        .btn-email {
            background: var(--accent-blue);
            color: white;
            border-color: var(--accent-blue);
        }
        
        .btn-email:hover {
            background: #138496;
            border-color: #138496;
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        /* Action Buttons Grid */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        /* KPI Dashboard Section */
        .kpi-dashboard {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 25px;
            border: 2px solid var(--secondary-teal);
            box-shadow: var(--shadow-light);
        }

        .kpi-dashboard h2 {
            color: var(--secondary-teal);
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .kpi-performance-section {
            margin-bottom: 40px;
        }

        .kpi-performance-section h3 {
            color: var(--primary-green);
            font-size: 1.4rem;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .performance-card {
            background: var(--gradient-primary);
            color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: var(--shadow-medium);
            transition: var(--transition);
        }

        .performance-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-heavy);
        }

        .performance-card h4 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .performance-value {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .performance-label {
            font-size: 0.9rem;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .performance-trend {
            margin-top: 15px;
            padding: 10px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            font-size: 0.85rem;
            backdrop-filter: blur(10px);
        }

        /* Dynamic Calculation Section */
        .calculation-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid var(--warning-amber);
            box-shadow: var(--shadow-light);
        }

        .calculation-section h3 {
            color: var(--warning-amber);
            font-size: 1.4rem;
            margin-bottom: 20px;
            font-weight: 700;
            text-align: center;
        }

        .calculation-rules {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .rule-card {
            padding: 20px;
            border-radius: var(--border-radius);
            border: 2px solid;
            transition: var(--transition);
        }

        .rule-card.green {
            border-color: var(--primary-green);
            background: rgba(40, 167, 69, 0.05);
        }

        .rule-card.amber {
            border-color: var(--warning-amber);
            background: rgba(255, 193, 7, 0.05);
        }

        .rule-card.red {
            border-color: var(--danger-red);
            background: rgba(220, 53, 69, 0.05);
        }

        .rule-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-light);
        }

        .rule-icon {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .rule-title {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .rule-description {
            color: var(--medium-gray);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* Statistics Cards */
        .stats-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid var(--accent-blue);
            box-shadow: var(--shadow-light);
        }

        .stats-section h3 {
            color: var(--accent-blue);
            font-size: 1.4rem;
            margin-bottom: 20px;
            font-weight: 700;
            text-align: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-card {
            background: var(--gradient-secondary);
            color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: var(--shadow-light);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
            font-weight: 600;
        }

        .stat-icon {
            font-size: 1.2rem;
            margin-right: 8px;
        }

        /* Dashboard Views */
        .dashboard-container {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-light);
            border: 2px solid var(--primary-green);
        }
        
        /* KPI Section */
        .kpi-section {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            border: 2px solid var(--secondary-teal);
            box-shadow: var(--shadow-light);
        }
        
        .kpi-section h3 {
            color: var(--secondary-teal);
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.4rem;
            font-weight: 700;
        }
        
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
        }
        
        .kpi-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid var(--secondary-teal);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
        }
        
        .kpi-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
            border-color: var(--primary-green);
        }
        
        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .kpi-value.red { color: var(--danger-red) !important; }
        .kpi-value.amber { color: var(--warning-amber) !important; }
        .kpi-value.green { color: var(--primary-green) !important; }
        
        .kpi-label {
            font-size: 0.85rem;
            color: var(--medium-gray);
            font-weight: 600;
            line-height: 1.3;
        }
        
        /* Monthly View Table */
        .monthly-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            background: white;
        }
        
        .monthly-table th {
            background: var(--gradient-primary);
            color: white;
            padding: 16px 12px;
            text-align: center;
            border: 1px solid var(--secondary-teal);
            font-weight: 700;
            font-size: 13px;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .monthly-table th.skill-header {
            text-align: left;
            padding-left: 15px;
            min-width: 100px;
            max-width: 120px;
            position: sticky;
            left: 0;
            z-index: 11;
        }
        
        .monthly-table td {
            border: 1px solid var(--border-color);
            padding: 12px 8px;
            text-align: center;
            vertical-align: middle;
            transition: var(--transition);
        }
        
        .monthly-table td.skill-name {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            font-weight: 600;
            text-align: left;
            padding-left: 15px;
            border-right: 3px solid var(--primary-green);
            color: var(--primary-green);
            min-width: 100px;
            max-width: 120px;
            font-size: 11px;
            position: sticky;
            left: 0;
            z-index: 5;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .monthly-table td.skill-name:hover {
            background: rgba(40, 167, 69, 0.1);
        }
        
        .monthly-table tbody tr:hover {
            background: rgba(40, 167, 69, 0.02);
        }
        
        /* Status Cells and Dots */
        .status-cell {
            cursor: pointer;
            position: relative;
            padding: 15px 8px;
        }
        
        .status-cell:hover {
            background: rgba(40, 167, 69, 0.1);
            transform: scale(1.02);
        }
        
        .status-dot {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin: 0 auto 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 11px;
            color: white;
            border: 3px solid transparent;
            box-shadow: var(--shadow-light);
            transition: var(--transition);
        }
        
        .status-dot:hover {
            transform: scale(1.2);
            box-shadow: var(--shadow-medium);
        }
        
        .status-dot.green {
            background: var(--primary-green);
            border-color: #1e7e34;
        }
        
        .status-dot.amber {
            background: var(--warning-amber);
            border-color: #d39e00;
            color: var(--dark-gray);
        }
        
        .status-dot.red {
            background: var(--danger-red);
            border-color: #bd2130;
        }
        
        .status-dot.gray {
            background: var(--medium-gray);
            border-color: #495057;
        }
        
        .status-dot.empty {
            background: var(--light-gray);
            border: 3px dashed var(--medium-gray);
            color: var(--medium-gray);
        }
        
        /* Status Indicators */
        .status-indicators {
            display: flex;
            justify-content: center;
            gap: 2px;
            margin-top: 5px;
        }
        
        .status-indicator {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--border-color);
            transition: var(--transition);
        }
        
        .status-indicator.filled {
            background: var(--primary-green);
        }
        
        .status-indicator.partial {
            background: var(--warning-amber);
        }
        
        /* Daily View Styles */
        .daily-container {
            padding: 25px;
        }
        
        .daily-stats {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            border: 2px solid var(--primary-green);
            box-shadow: var(--shadow-light);
        }
        
        .daily-stats h3 {
            color: var(--primary-green);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .daily-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }
        
        .daily-stat-card {
            text-align: center;
        }
        
        .daily-stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-green);
            margin-bottom: 5px;
        }
        
        .daily-stat-label {
            font-size: 0.9rem;
            color: var(--medium-gray);
            font-weight: 600;
        }
        
        .daily-grid {
            display: grid;
            grid-template-columns: 120px repeat(7, 1fr);
            gap: 2px;
            background: var(--border-color);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-light);
        }
        
        .daily-header {
            background: var(--gradient-primary);
            color: white;
            padding: 15px 8px;
            text-align: center;
            font-weight: 700;
            font-size: 12px;
        }
        
        .daily-skill {
            background: var(--secondary-teal);
            color: white;
            padding: 15px 8px;
            font-weight: 600;
            display: flex;
            align-items: center;
            font-size: 11px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .daily-cell {
            background: white;
            padding: 12px 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 70px;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }
        
        .daily-cell:hover {
            background: rgba(40, 167, 69, 0.1);
            border-color: var(--primary-green);
            transform: scale(1.02);
        }

        /* Skill Management Section - REDUCED WIDTH */
        .skill-management {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 25px;
            border: 2px solid var(--accent-blue);
            box-shadow: var(--shadow-light);
            max-width: 800px; /* Reduced from default */
        }

        .skill-management h3 {
            color: var(--accent-blue);
            font-size: 1.2rem; /* Reduced from 1.4rem */
            margin-bottom: 15px; /* Reduced from 20px */
            font-weight: 700;
            text-align: center;
        }

        .skill-management-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px; /* Reduced from 25px */
        }

        .skill-list-section, .add-skill-section {
            padding: 15px; /* Reduced from 20px */
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
        }

        .skill-list-section h4, .add-skill-section h4 {
            color: var(--primary-green);
            margin-bottom: 12px; /* Reduced from 15px */
            font-weight: 600;
            font-size: 14px; /* Reduced */
        }

        .skills-list {
            max-height: 250px; /* Reduced from 300px */
            overflow-y: auto;
        }

        .skill-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px; /* Reduced from 12px */
            border: 1px solid var(--border-color);
            border-radius: 6px; /* Reduced from 8px */
            margin-bottom: 6px; /* Reduced from 8px */
            transition: var(--transition);
        }

        .skill-item:hover {
            background: var(--light-gray);
            border-color: var(--primary-green);
        }

        .skill-item-name {
            font-weight: 600;
            color: var(--dark-gray);
            font-size: 13px; /* Reduced */
        }

        .skill-item-actions {
            display: flex;
            gap: 4px; /* Reduced from 5px */
        }

        .skill-action-btn {
            padding: 4px 8px; /* Reduced from 5px 10px */
            border: none;
            border-radius: 4px; /* Reduced from 5px */
            font-size: 11px; /* Reduced from 12px */
            cursor: pointer;
            transition: var(--transition);
        }

        .skill-action-btn.edit {
            background: var(--warning-amber);
            color: var(--dark-gray);
        }

        .skill-action-btn.delete {
            background: var(--danger-red);
            color: white;
        }

        .skill-action-btn:hover {
            transform: scale(1.1);
        }

        .add-skill-form {
            display: flex;
            flex-direction: column;
            gap: 12px; /* Reduced from 15px */
        }

        .add-skill-form input {
            padding: 10px; /* Reduced from 12px */
            border: 2px solid var(--border-color);
            border-radius: 6px; /* Reduced from 8px */
            font-size: 13px; /* Reduced from 14px */
        }

        .add-skill-form input:focus {
            border-color: var(--primary-green);
            outline: none;
        }
        
        /* Email Modal Styles */
        .email-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .email-modal-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 40px;
            max-width: 700px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-heavy);
            border: 3px solid var(--accent-blue);
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .email-modal h3 {
            color: var(--accent-blue);
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 25px;
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--accent-blue);
        }
        
        .email-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .email-form label {
            font-weight: 700;
            color: var(--accent-blue);
            margin-bottom: 5px;
            display: block;
        }
        
        .email-form select[multiple] {
            min-height: 120px;
        }
        
        .email-form small {
            color: var(--medium-gray);
            font-size: 11px;
            margin-top: 5px;
            display: block;
        }
        
        /* Screenshot Preview */
        .screenshot-preview {
            margin: 15px 0;
            padding: 15px;
            border: 2px dashed var(--primary-green);
            border-radius: 8px;
            background: var(--light-gray);
            text-align: center;
            display: none;
        }
        
        .screenshot-preview img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            box-shadow: var(--shadow-medium);
        }
        
        .preview-info {
            margin-top: 10px;
            font-size: 12px;
            color: var(--medium-gray);
        }
        
        .email-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            color: var(--danger-red);
            cursor: pointer;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .email-close:hover {
            background: var(--danger-red);
            color: white;
            transform: scale(1.1);
        }
        
        .email-status {
            padding: 15px;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            margin-top: 15px;
            display: none;
        }
        
        .email-status.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        
        .email-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        
        .email-status.loading {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffeaa7;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            box-shadow: var(--shadow-heavy);
            border: 3px solid var(--primary-green);
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            color: var(--danger-red);
            cursor: pointer;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .modal-close:hover {
            background: var(--danger-red);
            color: white;
            transform: scale(1.1);
        }
        
        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-container {
                margin: 0 10px;
            }
            
            .action-buttons {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .skill-management-content {
                grid-template-columns: 1fr;
            }
            
            .skill-management {
                max-width: 100%;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .content {
                padding: 15px;
            }
            
            .control-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .control-group {
                min-width: auto;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .kpi-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
            
            .daily-stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
            
            .daily-grid {
                grid-template-columns: 100px repeat(7, 1fr);
                font-size: 12px;
            }
            
            .daily-skill {
                font-size: 10px;
            }
            
            .monthly-table th.skill-header,
            .monthly-table td.skill-name {
                min-width: 80px;
                max-width: 100px;
                font-size: 10px;
            }
            
            .monthly-table {
                font-size: 12px;
            }
            
            .email-modal-content {
                padding: 25px;
                margin: 20px;
            }

            .auth-container {
                min-width: 300px;
                padding: 30px;
                margin: 20px;
            }

            .auth-buttons {
                flex-direction: column;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .calculation-rules {
                grid-template-columns: 1fr;
            }
        }
        
        /* Print Styles */
        @media print {
            .action-buttons, .version-badge, .email-modal, .auth-section {
                display: none !important;
            }
            
            .main-container {
                box-shadow: none;
                border: 1px solid #ccc;
            }
            
            .header {
                background: #28a745 !important;
                -webkit-print-color-adjust: exact;
            }
        }
        
        /* Utility Classes */
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        .font-bold { font-weight: 700; }
        .font-medium { font-weight: 600; }
        .text-green { color: var(--primary-green); }
        .text-teal { color: var(--secondary-teal); }
        .text-red { color: var(--danger-red); }
        .text-amber { color: var(--warning-amber); }
        .text-gray { color: var(--medium-gray); }
        .mb-10 { margin-bottom: 10px; }
        .mb-15 { margin-bottom: 15px; }
        .mb-20 { margin-bottom: 20px; }
        .mt-10 { margin-top: 10px; }
        .mt-15 { margin-top: 15px; }
        .mt-20 { margin-top: 20px; }
        .hidden { display: none; }
        .visible { display: block; }
    </style>
</head>
<body>
    <!-- Authentication Section -->
    <div id="auth-section">
        <div class="auth-container">
            <div class="admin-badge" style="display: none;" id="adminBadge">üëë ADMIN</div>
            <h2>üîê HBoard Login</h2>
            <p class="subtitle">Secure access to your operations excellence dashboard</p>
            
            <form class="auth-form" onsubmit="return false;">
                <input type="text" id="email" placeholder="üìß Enter your email or username" required>
                <input type="password" id="password" placeholder="üîí Enter your password" required>
                
                <div class="auth-buttons">
                    <button type="button" class="auth-btn signup" onclick="signUp()">
                        üöÄ Create Account
                    </button>
                    <button type="button" class="auth-btn signin" onclick="signIn()">
                        üîë Sign In
                    </button>
                </div>
            </form>
            
            <div id="auth-status" class="auth-status"></div>
            
            <div class="auth-divider">
                <span>Enterprise-grade security with Firebase + SMTP Integration</span>
            </div>
        </div>
    </div>

    <!-- Sign Out Button -->
    <button id="signOutBtn" class="auth-btn signout" onclick="signOut()" style="display:none">
        üö™ Sign Out
    </button>

    <!-- Connection Status -->
    <div id="connectionStatus" class="connection-status connecting">üîÑ Connecting...</div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Header Section -->
        <header class="header">
            <div id="userInfo" class="user-info" style="display:none">
                üë§ <span id="userEmail"></span>
            </div>
            <div class="version-badge">v2024.09.07</div>
            <h1>üìä HBoard - Operations Excellence Dashboard</h1>
            <p class="subtitle">Advanced KPI Analytics with Dynamic Downtime Calculations, Real-time Team Collaboration & SMTP Email Screenshot Functionality</p>
        </header>

        <!-- Main Content -->
        <main class="content">
            <!-- Control Panel -->
            <section class="control-panel">
                <div class="control-row">
                    <div class="control-group">
                        <label for="landscapeSelect">üåç Landscape</label>
                        <select id="landscapeSelect">
                            <option value="Europe">Europe</option>
                            <option value="NAM">North America</option>
                            <option value="APAC">Asia Pacific</option>
                            <option value="SEA">Southeast Asia</option>
                            <option value="IA">India & Australia</option>
                            <option value="Global">Global Operations</option>
                        </select>
                    </div>

                    <div class="control-group" id="monthControl">
                        <label for="monthSelect">üìÖ Month/Year</label>
                        <input type="month" id="monthSelect">
                    </div>

                    <div class="control-group hidden" id="dateControl">
                        <label for="dateSelect">üìÖ Specific Date</label>
                        <input type="date" id="dateSelect">
                    </div>

                    <div class="control-group">
                        <label>üìä View Mode</label>
                        <div class="view-toggle">
                            <button class="toggle-btn active" onclick="switchView('monthly')">üìä Monthly</button>
                            <button class="toggle-btn" onclick="switchView('daily')">üìÖ Daily</button>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="refreshData()">
                        üîÑ Refresh Data
                    </button>
                    <button class="btn btn-email" onclick="openEmailModal()">
                        üì§ Email Screenshot
                    </button>
                    <button class="btn btn-success" onclick="addNewSkill()">
                        ‚ûï Add Skill
                    </button>
                    <button class="btn btn-primary" onclick="exportToExcel()">
                        üìä Export Excel
                    </button>
                    <button class="btn btn-warning" onclick="importData()">
                        üì§ Import Data
                    </button>
                    <button class="btn btn-primary" onclick="viewHistory()">
                        üìã View History
                    </button>
                    <button class="btn btn-danger" onclick="clearData()">
                        üóëÔ∏è Clear Data
                    </button>
                    <button class="btn btn-success" onclick="syncData()">
                        üîÑ Sync Now
                    </button>
                </div>
            </section>

            <!-- KPI Dashboard Section -->
            <section class="kpi-dashboard">
                <h2>üìà Key Performance Indicators</h2>
                
                <!-- Monthly/Yearly Performance -->
                <div class="kpi-performance-section">
                    <h3>üìÖ Monthly Performance - <span id="currentMonthDisplay">September 2024</span></h3>
                    <div class="performance-grid">
                        <div class="performance-card">
                            <h4>üìÖ Monthly Performance</h4>
                            <div class="performance-value" id="monthlyPerformance">0%</div>
                            <div class="performance-label">Overall Availability</div>
                            <div class="performance-trend" id="monthlyTrend">üìä Monthly Trend</div>
                        </div>
                        <div class="performance-card">
                            <h4>üìä Yearly Performance</h4>
                            <div class="performance-value" id="yearlyPerformance">0%</div>
                            <div class="performance-label">Overall Availability</div>
                            <div class="performance-trend" id="yearlyTrend">üìä Yearly Trend</div>
                        </div>
                    </div>
                </div>

                <!-- Dynamic Percentage Calculation -->
                <div class="calculation-section">
                    <h3>ü§ñ Dynamic Percentage Calculation (Downtime-Based) + Real-time Team Sync</h3>
                    <div class="calculation-rules">
                        <div class="rule-card green">
                            <div class="rule-icon">üü¢</div>
                            <div class="rule-title">Green (95-100%):</div>
                            <div class="rule-description">Minimal downtime (‚â§1.2 hours/day)</div>
                        </div>
                        <div class="rule-card amber">
                            <div class="rule-icon">üü°</div>
                            <div class="rule-title">Amber (45-95%):</div>
                            <div class="rule-description">Moderate downtime (1.2-13.2 hours/day)</div>
                        </div>
                        <div class="rule-card red">
                            <div class="rule-icon">üî¥</div>
                            <div class="rule-title">Red (0-45%):</div>
                            <div class="rule-description">High downtime (>13.2 hours/day)</div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 20px; padding: 15px; background: rgba(32, 201, 151, 0.1); border-radius: 8px;">
                        <strong>üìä Monthly View:</strong> Shows weekly averages calculated from daily data<br>
                        <strong>üî• Team Sync:</strong> Changes sync in real-time across all team members
                    </div>
                </div>

                <!-- Performance Statistics -->
                <div class="stats-section">
                    <h3>üìä Performance Statistics</h3>
                    <div style="text-align: center; margin-bottom: 20px; font-weight: 600; color: var(--medium-gray);">
                        <strong>üìå Status Guide:</strong><br>
                        Green - Optimal Performance (95-100%) | Amber - Needs Attention (45-95%) | Red - Critical Issues (0-45%) | No Data Available (0%)
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="totalEntries">0</div>
                            <div class="stat-label">Total Entries</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="optimalCount">0</div>
                            <div class="stat-label"><span class="stat-icon">üü¢</span>Optimal Performance</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="attentionCount">0</div>
                            <div class="stat-label"><span class="stat-icon">üü°</span>Needs Attention</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="criticalCount">0</div>
                            <div class="stat-label"><span class="stat-icon">üî¥</span>Critical Issues</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Skill Management Section - REDUCED WIDTH -->
            <section class="skill-management">
                <h3>üõ†Ô∏è Skill Management</h3>
                <p style="text-align: center; color: var(--medium-gray); margin-bottom: 15px; font-size: 13px;">
                    Manage operational skills being tracked across your team
                </p>
                <div class="skill-management-content">
                    <div class="skill-list-section">
                        <h4>üìã Current Skills</h4>
                        <div class="skills-list" id="skillsList">
                            <!-- Skills will be populated dynamically -->
                        </div>
                    </div>
                    <div class="add-skill-section">
                        <h4>‚ûï Add New Skill</h4>
                        <div class="add-skill-form">
                            <input type="text" id="newSkillInput" placeholder="Enter new skill/operational area...">
                            <button class="btn btn-success" onclick="addSkillFromInput()">
                                ‚úÖ Add Skill
                            </button>
                        </div>
                        <div style="margin-top: 10px; font-size: 11px; color: var(--medium-gray);">
                            <strong>Tip:</strong> Skills represent operational areas that require tracking and monitoring.
                        </div>
                    </div>
                </div>
            </section>

            <!-- Dashboard Container -->
            <section class="dashboard-container">
                <!-- Monthly View -->
                <div id="monthlyView">
                    <!-- KPI Section -->
                    <div class="kpi-section" id="weeklyKPIs">
                        <h3>üìä Weekly Skill Availability Overview</h3>
                        <div class="kpi-grid" id="kpiGrid">
                            <!-- KPI cards will be generated by JavaScript -->
                        </div>
                    </div>

                    <!-- Monthly Table -->
                    <div style="overflow-x: auto;">
                        <table class="monthly-table" id="monthlyTable">
                            <thead id="monthlyHeaders">
                                <!-- Headers will be generated by JavaScript -->
                            </thead>
                            <tbody id="monthlyBody">
                                <!-- Table body will be generated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Daily View -->
                <div id="dailyView" class="hidden">
                    <div class="daily-container">
                        <!-- Daily Stats -->
                        <div class="daily-stats">
                            <h3>üìä Daily Performance Statistics</h3>
                            <div class="daily-stats-grid">
                                <div class="daily-stat-card">
                                    <div class="daily-stat-value" id="todayAverage">0%</div>
                                    <div class="daily-stat-label">Today's Average</div>
                                </div>
                                <div class="daily-stat-card">
                                    <div class="daily-stat-value" id="weeklyAverage">0%</div>
                                    <div class="daily-stat-label">Weekly Average</div>
                                </div>
                                <div class="daily-stat-card">
                                    <div class="daily-stat-value" id="trendIndicator">üìà</div>
                                    <div class="daily-stat-label">Performance Trend</div>
                                </div>
                                <div class="daily-stat-card">
                                    <div class="daily-stat-value text-teal">üî•</div>
                                    <div class="daily-stat-label">Team Sync Active</div>
                                </div>
                            </div>
                        </div>

                        <!-- Daily Grid -->
                        <div class="daily-grid" id="dailyGrid">
                            <!-- Daily grid will be generated by JavaScript -->
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Email Screenshot Modal with Preview -->
    <div class="email-modal" id="emailModal">
        <div class="email-modal-content">
            <button class="email-close" onclick="closeEmailModal()">&times;</button>
            <h3>üì§ Send Dashboard Screenshot</h3>
            
            <form class="email-form" onsubmit="return false;">
                <div>
                    <label for="emailRecipients">üìß Select Recipients:</label>
                    <select id="emailRecipients" multiple>
                        <option value="manager@company.com">üëî Manager (manager@company.com)</option>
                        <option value="team.lead@company.com">üë• Team Lead (team.lead@company.com)</option>
                        <option value="operations@company.com">‚öôÔ∏è Operations Team (operations@company.com)</option>
                        <option value="executives@company.com">üè¢ Executive Team (executives@company.com)</option>
                        <option value="qa.team@company.com">üîç QA Team (qa.team@company.com)</option>
                        <option value="support@company.com">üõü Support Team (support@company.com)</option>
                    </select>
                    <small>Hold Ctrl (or Cmd on Mac) to select multiple recipients</small>
                </div>

                <div>
                    <label for="customEmail">üìù Or enter custom email:</label>
                    <input type="email" id="customEmail" placeholder="user@company.com">
                </div>

                <div>
                    <label for="screenshotType">üìä Screenshot Content:</label>
                    <select id="screenshotType" onchange="generateScreenshotPreview()">
                        <option value="complete">üìä Complete Dashboard (KPIs + Table)</option>
                        <option value="kpi-dashboard">üìà KPI Dashboard Section</option>
                        <option value="weekly-kpis">üìä Weekly KPIs Overview Only</option>
                        <option value="skills-table">üìã Skills Performance Table Only</option>
                        <option value="daily-view">üìÖ Daily View (if active)</option>
                        <option value="skill-management">üõ†Ô∏è Skill Management Section</option>
                    </select>
                </div>

                <!-- Screenshot Preview -->
                <div class="screenshot-preview" id="screenshotPreview">
                    <img id="previewImage" src="" alt="Screenshot Preview">
                    <div class="preview-info">
                        üì∏ Preview of selected section - This will be sent via email
                    </div>
                </div>

                <div>
                    <label for="emailSubject">üìå Email Subject:</label>
                    <input type="text" id="emailSubject" placeholder="Operations Dashboard Report">
                </div>

                <div>
                    <label for="emailMessage">üí¨ Message (optional):</label>
                    <textarea id="emailMessage" rows="4" placeholder="Add a custom message to accompany the screenshot..."></textarea>
                </div>

                <div style="display: flex; gap: 15px;">
                    <button type="button" class="btn btn-primary" onclick="generateScreenshotPreview()" style="flex: 1;">
                        üîç Preview Screenshot
                    </button>
                    <button type="button" class="btn btn-email" onclick="sendScreenshotEmail()" style="flex: 2;">
                        üì§ Capture & Send Screenshot
                    </button>
                </div>
            </form>

            <div id="emailStatus" class="email-status"></div>
        </div>
    </div>

    <!-- Add Skill Modal -->
    <div class="modal" id="addSkillModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('addSkillModal')">&times;</button>
            <h2 style="color: var(--primary-green); margin-bottom: 20px;">‚ûï Add New Skill</h2>
            <form onsubmit="return submitNewSkill();">
                <div style="margin-bottom: 20px;">
                    <label for="newSkillName" style="display: block; margin-bottom: 10px; font-weight: bold;">Skill Name:</label>
                    <input type="text" id="newSkillName" placeholder="Enter new skill/operational area..." required>
                </div>
                <div style="display: flex; gap: 15px; justify-content: flex-end;">
                    <button type="button" class="btn btn-danger" onclick="closeModal('addSkillModal')">‚ùå Cancel</button>
                    <button type="submit" class="btn btn-success">‚úÖ Add Skill</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Import Data Modal -->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('importModal')">&times;</button>
            <h2 style="color: var(--primary-green); margin-bottom: 20px;">üì§ Import Data</h2>
            <p style="margin-bottom: 20px; color: var(--medium-gray);">
                Upload a JSON file containing operational data or Excel file with skill performance data.
            </p>
            <div style="margin-bottom: 20px;">
                <input type="file" id="importFile" accept=".json,.xlsx,.csv" style="margin-bottom: 15px;">
                <div style="font-size: 12px; color: var(--medium-gray);">
                    Supported formats: JSON, Excel (.xlsx), CSV
                </div>
            </div>
            <div style="display: flex; gap: 15px; justify-content: flex-end;">
                <button type="button" class="btn btn-danger" onclick="closeModal('importModal')">‚ùå Cancel</button>
                <button type="button" class="btn btn-success" onclick="processImport()">üì§ Import</button>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div class="modal" id="historyModal">
        <div class="modal-content" style="max-width: 800px;">
            <button class="modal-close" onclick="closeModal('historyModal')">&times;</button>
            <h2 style="color: var(--primary-green); margin-bottom: 20px;">üìã Data History & Changes</h2>
            <div id="historyContent" style="max-height: 400px; overflow-y: auto;">
                <!-- History content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Hidden file input for imports -->
    <input type="file" id="hiddenFileInput" style="display: none;" accept=".json,.xlsx,.csv">

    <script>
        // ========================================
        // SMTP.JS AND EMAILJS INITIALIZATION
        // ========================================

        (function() {
            try {
                // Initialize EmailJS with your public key (fallback)
                if (typeof emailjs !== 'undefined') {
                    emailjs.init("uMjP4LeVCl37KXNHo");
                    console.log('üìß EmailJS initialized successfully!');
                }
                console.log('üìß SMTP.js loaded successfully!');
            } catch (error) {
                console.error('‚ùå Email service initialization error:', error);
            }
        })();

        // ========================================
        // GLOBAL VARIABLES AND DATA STORAGE
        // ========================================

        let currentView = 'monthly';
        let currentLandscape = 'Europe';
        let currentMonth = new Date().toISOString().substring(0, 7);
        let currentDate = new Date().toISOString().split('T')[0];

        // Global variables for admin access and Firebase
        window.isAdminMode = false;
        window.firebaseUser = null;

        // Sample Skills Data
        let skillsData = [
            'Business Clarity',
            'Revenue',
            'BPT Processing', 
            'Stock Aging',
            'Inventory',
            'AMB for Manufacturing',
            'PMI for Manufacturing',
            'BPM Stock Reconciliation'
        ];

        // Operational Data Storage
        let operationalData = JSON.parse(localStorage.getItem('hboard_operational_data')) || {};
        let historyLog = JSON.parse(localStorage.getItem('hboard_history_log')) || [];

        // Statistics Data
        let statisticsData = {
            totalEntries: 0,
            optimalCount: 0,
            attentionCount: 0,
            criticalCount: 0,
            monthlyPerformance: 0,
            yearlyPerformance: 0
        };

        // SMTP Configuration (use your own SMTP settings)
        const SMTP_CONFIG = {
            Host: "smtp.elasticemail.com", // Change to your SMTP server
            Username: "kastrobistro@gmail.com", // Your SMTP username
            Password: "9A72C1254E0F0B3106218B9A74FF64248798", // Your SMTP password
            Port: 2525,
            // Optional: use secure token instead of username/password
        };

        // ========================================
        // FIREBASE AUTHENTICATION INTEGRATION
        // ========================================

        function checkAdminAccess(username, password) {
            return username.toLowerCase().trim() === 'admin' && password === 'admin123';
        }

        function activateAdminMode() {
            window.isAdminMode = true;
            document.getElementById('adminBadge').style.display = 'block';
            updateConnectionStatus('admin');
            
            // Show admin user info
            const userInfo = document.getElementById('userInfo');
            const userEmail = document.getElementById('userEmail');
            userInfo.style.display = 'block';
            userEmail.textContent = 'üëë ADMIN ACCESS';
            
            console.log('üëë Admin mode activated');
        }

        // Sign up function with Firebase integration
        window.signUp = async function() {
            const emailInput = document.getElementById("email").value.trim();
            const passwordInput = document.getElementById("password").value;
            const statusDiv = document.getElementById("auth-status");
            
            // Check for admin access first
            if (checkAdminAccess(emailInput, passwordInput)) {
                statusDiv.innerHTML = '<div>üëë Admin access granted! Welcome, Administrator!</div>';
                statusDiv.className = 'auth-status success';
                
                activateAdminMode();
                showDashboard();
                return;
            }

            statusDiv.innerHTML = '<div class="auth-loading">üîÑ Creating account...</div>';
            statusDiv.className = 'auth-status';

            try {
                // Try Firebase sign up if available
                if (window.firebaseAuth && window.firebaseSignUp) {
                    const userCredential = await window.firebaseSignUp(window.firebaseAuth, emailInput, passwordInput);
                    window.firebaseUser = userCredential.user;
                    
                    statusDiv.innerHTML = '<div>‚úÖ Account created successfully! Welcome to HBoard!</div>';
                    statusDiv.className = 'auth-status success';
                    
                    updateConnectionStatus('connected');
                    showDashboard();
                    
                    // Show user info
                    const userInfo = document.getElementById('userInfo');
                    const userEmail = document.getElementById('userEmail');
                    userInfo.style.display = 'block';
                    userEmail.textContent = emailInput;
                } else {
                    throw new Error('Firebase not configured');
                }
            } catch (error) {
                console.error('Sign up error:', error);
                statusDiv.innerHTML = `<div class="error">‚ùå ${error.message || 'Sign up failed. Please try again.'}</div>`;
                statusDiv.className = 'auth-status error';
            }
        }

        // Sign in function with Firebase integration
        window.signIn = async function() {
            const emailInput = document.getElementById("email").value.trim();
            const passwordInput = document.getElementById("password").value;
            const statusDiv = document.getElementById("auth-status");
            
            // Check for admin access first
            if (checkAdminAccess(emailInput, passwordInput)) {
                statusDiv.innerHTML = '<div>üëë Admin access granted! Welcome back, Administrator!</div>';
                statusDiv.className = 'auth-status success';
                
                activateAdminMode();
                showDashboard();
                return;
            }

            statusDiv.innerHTML = '<div class="auth-loading">üîÑ Signing in...</div>';
            statusDiv.className = 'auth-status';

            try {
                // Try Firebase sign in if available
                if (window.firebaseAuth && window.firebaseSignIn) {
                    const userCredential = await window.firebaseSignIn(window.firebaseAuth, emailInput, passwordInput);
                    window.firebaseUser = userCredential.user;
                    
                    statusDiv.innerHTML = '<div>‚úÖ Welcome back! You are now signed in.</div>';
                    statusDiv.className = 'auth-status success';
                    
                    updateConnectionStatus('connected');
                    showDashboard();
                    
                    // Show user info
                    const userInfo = document.getElementById('userInfo');
                    const userEmail = document.getElementById('userEmail');
                    userInfo.style.display = 'block';
                    userEmail.textContent = emailInput;
                } else {
                    throw new Error('Firebase not configured');
                }
            } catch (error) {
                console.error('Sign in error:', error);
                statusDiv.innerHTML = `<div class="error">‚ùå ${error.message || 'Sign in failed. Please check your credentials.'}</div>`;
                statusDiv.className = 'auth-status error';
            }
        }

        // Sign out function
        window.signOut = async function() {
            try {
                if (window.firebaseAuth && window.firebaseSignOut && window.firebaseUser) {
                    await window.firebaseSignOut(window.firebaseAuth);
                }
                
                window.firebaseUser = null;
                window.isAdminMode = false;
                document.getElementById('adminBadge').style.display = 'none';
                updateConnectionStatus('connecting');
                console.log('üëã User signed out');
                
                hideDashboard();
                
            } catch (error) {
                console.error('‚ùå Sign out error:', error);
                // Force sign out even if Firebase fails
                hideDashboard();
            }
        }

        function showDashboard() {
            const dashboard = document.querySelector('.main-container');
            const authSection = document.getElementById('auth-section');
            const signOutBtn = document.getElementById('signOutBtn');
            
            dashboard.style.display = "block";
            authSection.style.display = "none";
            signOutBtn.style.display = "block";
            
            // Initialize dashboard
            setTimeout(() => {
                initializeDashboard();
            }, 500);
        }

        function hideDashboard() {
            const dashboard = document.querySelector('.main-container');
            const authSection = document.getElementById('auth-section');
            const signOutBtn = document.getElementById('signOutBtn');
            const userInfo = document.getElementById('userInfo');
            
            dashboard.style.display = "none";
            authSection.style.display = "flex";
            signOutBtn.style.display = "none";
            userInfo.style.display = "none";
            
            // Clear form
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
            document.getElementById('auth-status').innerHTML = '';
        }
        
        function updateConnectionStatus(status) {
            const statusEl = document.getElementById('connectionStatus');
            if (!statusEl) return;
            
            statusEl.className = `connection-status ${status}`;
            
            switch(status) {
                case 'connected':
                    statusEl.textContent = 'üî• Team Sync Active';
                    break;
                case 'connecting':
                    statusEl.textContent = 'üîÑ Connecting...';
                    break;
                case 'offline':
                    statusEl.textContent = '‚ö†Ô∏è Offline Mode';
                    break;
                case 'admin':
                    statusEl.textContent = 'üëë Admin Mode - Full Access';
                    break;
            }
        }

        // ========================================
        // ENHANCED EMAIL SCREENSHOT FUNCTIONALITY WITH SMTP
        // ========================================

        function openEmailModal() {
            document.getElementById('emailModal').style.display = 'flex';
            document.getElementById('emailStatus').style.display = 'none';
            document.getElementById('screenshotPreview').style.display = 'none';
            
            // Set default subject
            const landscape = document.getElementById('landscapeSelect').value;
            const month = document.getElementById('monthSelect').value;
            document.getElementById('emailSubject').value = `HBoard Operations Report - ${landscape} (${month})`;
        }

        function closeEmailModal() {
            document.getElementById('emailModal').style.display = 'none';
            document.getElementById('emailStatus').style.display = 'none';
            document.getElementById('screenshotPreview').style.display = 'none';
            
            // Reset form
            const recipientSelect = document.getElementById('emailRecipients');
            for (let i = 0; i < recipientSelect.options.length; i++) {
                recipientSelect.options[i].selected = false;
            }
            document.getElementById('customEmail').value = '';
            document.getElementById('emailMessage').value = '';
        }

        async function generateScreenshotPreview() {
            const screenshotType = document.getElementById('screenshotType').value;
            const previewDiv = document.getElementById('screenshotPreview');
            const previewImg = document.getElementById('previewImage');
            
            try {
                showEmailStatus('üì∏ Generating preview...', 'loading');
                
                // Determine what to capture
                let targetElement = getScreenshotTarget(screenshotType);
                
                if (!targetElement || targetElement.offsetWidth === 0) {
                    showEmailStatus('‚ùå Selected view is not visible or available', 'error');
                    return;
                }

                // Capture screenshot
                const canvas = await html2canvas(targetElement, {
                    useCORS: true,
                    allowTaint: false,
                    scale: 0.5, // Lower scale for preview
                    backgroundColor: '#ffffff',
                    logging: false,
                    width: targetElement.scrollWidth,
                    height: targetElement.scrollHeight
                });

                const imageData = canvas.toDataURL('image/png', 0.8);
                
                // Show preview
                previewImg.src = imageData;
                previewDiv.style.display = 'block';
                
                showEmailStatus('‚úÖ Preview generated successfully', 'success');
                setTimeout(() => {
                    document.getElementById('emailStatus').style.display = 'none';
                }, 2000);
                
            } catch (error) {
                console.error('Preview generation error:', error);
                showEmailStatus('‚ùå Failed to generate preview: ' + error.message, 'error');
            }
        }

        function getScreenshotTarget(screenshotType) {
            switch (screenshotType) {
                case 'complete':
                    return document.getElementById('monthlyView').style.display !== 'none' 
                        ? document.querySelector('.dashboard-container') 
                        : document.getElementById('dailyView');
                case 'kpi-dashboard':
                    return document.querySelector('.kpi-dashboard');
                case 'weekly-kpis':
                    return document.getElementById('weeklyKPIs');
                case 'skills-table':
                    return document.getElementById('monthlyTable');
                case 'daily-view':
                    return document.getElementById('dailyView');
                case 'skill-management':
                    return document.querySelector('.skill-management');
                default:
                    return document.querySelector('.dashboard-container');
            }
        }

        async function sendScreenshotEmail() {
            const recipientSelect = document.getElementById('emailRecipients');
            const customEmail = document.getElementById('customEmail').value.trim();
            const screenshotType = document.getElementById('screenshotType').value;
            const subject = document.getElementById('emailSubject').value.trim();
            const message = document.getElementById('emailMessage').value.trim();

            // Get selected recipients
            let recipients = [];
            for (let option of recipientSelect.selectedOptions) {
                recipients.push(option.value);
            }
            
            if (customEmail) {
                if (isValidEmail(customEmail)) {
                    recipients.push(customEmail);
                } else {
                    showEmailStatus('‚ùå Please enter a valid email address', 'error');
                    return;
                }
            }

            // Validation
            if (recipients.length === 0) {
                showEmailStatus('‚ùå Please select at least one recipient or enter a custom email', 'error');
                return;
            }

            if (!subject) {
                showEmailStatus('‚ùå Please enter an email subject', 'error');
                return;
            }

            try {
                showEmailStatus('üì∏ Capturing high-quality screenshot...', 'loading');

                // Determine what to capture
                let targetElement = getScreenshotTarget(screenshotType);
                let viewName = getViewName(screenshotType);
                
                if (!targetElement || targetElement.offsetWidth === 0) {
                    showEmailStatus('‚ùå Selected view is not visible or available', 'error');
                    return;
                }

                // Capture high-quality screenshot
                const canvas = await html2canvas(targetElement, {
                    useCORS: true,
                    allowTaint: false,
                    scale: 1.5,
                    backgroundColor: '#ffffff',
                    logging: false,
                    width: targetElement.scrollWidth,
                    height: targetElement.scrollHeight
                });

                const imageData = canvas.toDataURL('image/png', 0.9);
                
                showEmailStatus('üì§ Sending emails via SMTP...', 'loading');

                // Prepare email data
                const landscape = document.getElementById('landscapeSelect').value;
                const period = document.getElementById('monthSelect').value;
                const timestamp = new Date().toLocaleString();
                
                const emailBody = message || `Please find attached the ${viewName} screenshot from our HBoard Operations Dashboard.

Landscape: ${landscape}
Period: ${period}
Generated: ${timestamp}

This automated report provides key insights into our operational performance and system availability.

Best regards,
HBoard Operations Team`;

                let successCount = 0;
                let errors = [];
                
                // Send emails to all recipients using SMTP.js
                for (let email of recipients) {
                    try {
                        // Try SMTP.js first
                        if (typeof Email !== 'undefined') {
                            await Email.send({
                                SecureToken: SMTP_CONFIG.SecureToken,
                                Host: SMTP_CONFIG.Host,
                                Username: SMTP_CONFIG.Username,
                                Password: SMTP_CONFIG.Password,
                                Port: SMTP_CONFIG.Port,
                                To: email,
                                From: SMTP_CONFIG.Username,
                                Subject: subject,
                                Body: emailBody,
                                Attachments: [{
                                    name: `hboard-screenshot-${Date.now()}.png`,
                                    data: imageData
                                }]
                            });
                            console.log(`üìß SMTP email sent successfully to: ${email}`);
                            successCount++;
                        }
                        // Fallback to EmailJS if SMTP fails
                        else if (typeof emailjs !== 'undefined') {
                            const emailParams = {
                                to_email: email,
                                to_name: email.split('@')[0],
                                subject: subject,
                                message: emailBody,
                                landscape: landscape,
                                period: period,
                                timestamp: timestamp,
                                view_name: viewName,
                                screenshot_data: imageData
                            };
                            
                            await emailjs.send('service_gf6rddd', 'template_894t362', emailParams);
                            console.log(`üìß EmailJS fallback sent successfully to: ${email}`);
                            successCount++;
                        }
                        
                        // Add delay between emails to avoid rate limiting
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        
                    } catch (error) {
                        console.error(`Failed to send to ${email}:`, error);
                        errors.push(`${email}: ${error.text || error.message || 'Unknown error'}`);
                    }
                }

                if (successCount > 0) {
                    showEmailStatus(`‚úÖ Screenshot sent successfully to ${successCount} recipient(s) via SMTP!${errors.length > 0 ? ` (${errors.length} failed)` : ''}`, 'success');
                    
                    // Log the action
                    logAction('Email Screenshot', `Sent ${viewName} to ${successCount} recipients via SMTP`);
                    
                    // Auto-close after 3 seconds
                    setTimeout(closeEmailModal, 3000);
                } else {
                    showEmailStatus(`‚ùå Failed to send emails. ${errors.length > 0 ? 'Errors: ' + errors.join(', ') : 'Please check your SMTP configuration.'}`, 'error');
                }

            } catch (error) {
                console.error('Screenshot email error:', error);
                showEmailStatus('‚ùå Failed to capture screenshot: ' + error.message, 'error');
            }
        }

        function getViewName(screenshotType) {
            switch (screenshotType) {
                case 'complete': return 'Complete Dashboard View';
                case 'kpi-dashboard': return 'KPI Dashboard Section';
                case 'weekly-kpis': return 'Weekly KPIs Overview';
                case 'skills-table': return 'Skills Performance Table';
                case 'daily-view': return 'Daily Operations View';
                case 'skill-management': return 'Skill Management Section';
                default: return 'Dashboard View';
            }
        }

        function showEmailStatus(message, type) {
            const statusDiv = document.getElementById('emailStatus');
            statusDiv.textContent = message;
            statusDiv.className = `email-status ${type}`;
            statusDiv.style.display = 'block';
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // ========================================
        // MAIN DASHBOARD FUNCTIONALITY
        // ========================================

        function initializeDashboard() {
            console.log('üöÄ Initializing HBoard Operations Dashboard...');
            
            // Set current date values
            document.getElementById('monthSelect').value = currentMonth;
            document.getElementById('dateSelect').value = currentDate;
            document.getElementById('landscapeSelect').value = currentLandscape;
            
            // Update current month display
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            const [year, month] = currentMonth.split('-');
            document.getElementById('currentMonthDisplay').textContent = `${monthNames[parseInt(month) - 1]} ${year}`;
            
            // Add event listeners
            document.getElementById('landscapeSelect').addEventListener('change', refreshData);
            document.getElementById('monthSelect').addEventListener('change', refreshData);
            document.getElementById('dateSelect').addEventListener('change', refreshData);
            
            // Load initial data
            refreshData();
            updateSkillsList();
            updateStatistics();
            
            console.log('‚úÖ Dashboard initialized successfully with SMTP and Firebase integration');
        }

        function switchView(viewType) {
            currentView = viewType;
            
            // Update toggle buttons
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Show/hide appropriate controls and views
            const monthControl = document.getElementById('monthControl');
            const dateControl = document.getElementById('dateControl');
            const monthlyView = document.getElementById('monthlyView');
            const dailyView = document.getElementById('dailyView');
            
            if (viewType === 'daily') {
                monthControl.classList.add('hidden');
                dateControl.classList.remove('hidden');
                monthlyView.classList.add('hidden');
                dailyView.classList.remove('hidden');
                generateDailyView();
            } else {
                monthControl.classList.remove('hidden');
                dateControl.classList.add('hidden');
                monthlyView.classList.remove('hidden');
                dailyView.classList.add('hidden');
                generateMonthlyView();
            }
        }

        function refreshData() {
            currentLandscape = document.getElementById('landscapeSelect').value;
            
            if (currentView === 'monthly') {
                currentMonth = document.getElementById('monthSelect').value;
                generateMonthlyView();
                
                // Update month display
                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                    'July', 'August', 'September', 'October', 'November', 'December'];
                const [year, month] = currentMonth.split('-');
                document.getElementById('currentMonthDisplay').textContent = `${monthNames[parseInt(month) - 1]} ${year}`;
            } else {
                currentDate = document.getElementById('dateSelect').value;
                generateDailyView();
            }
            
            updateStatistics();
        }

        function generateMonthlyView() {
            console.log('üìä Generating monthly view...');
            
            const weeks = getWeeksInMonth(currentMonth);
            generateKPICards(weeks);
            generateMonthlyHeaders(weeks);
            generateMonthlyTableBody(weeks);
        }

        function getWeeksInMonth(monthYear) {
            const [year, month] = monthYear.split('-').map(Number);
            const firstDay = new Date(year, month - 1, 1);
            const lastDay = new Date(year, month, 0);
            
            const weeks = [];
            let currentWeek = 1;
            let currentDate = new Date(firstDay);
            
            while (currentDate <= lastDay) {
                const weekStart = new Date(currentDate);
                const weekEnd = new Date(Math.min(currentDate.getTime() + 6 * 24 * 60 * 60 * 1000, lastDay.getTime()));
                
                weeks.push({
                    number: currentWeek,
                    label: `WK ${currentWeek}`,
                    start: weekStart.getDate(),
                    end: weekEnd.getDate(),
                    dates: getWeekDates(weekStart, weekEnd)
                });
                
                currentDate.setTime(weekEnd.getTime() + 24 * 60 * 60 * 1000);
                currentWeek++;
            }
            
            return weeks;
        }

        function getWeekDates(start, end) {
            const dates = [];
            const currentDate = new Date(start);
            
            while (currentDate <= end) {
                dates.push(new Date(currentDate));
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            return dates;
        }

        function generateKPICards(weeks) {
            const kpiGrid = document.getElementById('kpiGrid');
            let kpiHTML = '';
            
            weeks.forEach((week, index) => {
                // Sample data - in real implementation, calculate from actual data
                const percentage = index === 0 ? 100 : 0;
                const colorClass = percentage >= 95 ? 'green' : percentage >= 45 ? 'amber' : 'red';
                
                kpiHTML += `
                    <div class="kpi-card">
                        <div class="kpi-value ${colorClass}">${percentage}%</div>
                        <div class="kpi-label">${week.label} Availability</div>
                    </div>
                `;
            });
            
            kpiGrid.innerHTML = kpiHTML;
        }

        function generateMonthlyHeaders(weeks) {
            const headersContainer = document.getElementById('monthlyHeaders');
            let headerHTML = '<tr><th class="skill-header">Skills / Operational Areas</th>';
            
            weeks.forEach(week => {
                headerHTML += `<th>${week.label}<br><small>${week.start}-${week.end}</small></th>`;
            });
            
            headerHTML += '</tr>';
            headersContainer.innerHTML = headerHTML;
        }

        function generateMonthlyTableBody(weeks) {
            const bodyContainer = document.getElementById('monthlyBody');
            let bodyHTML = '';
            
            skillsData.forEach((skill, skillIndex) => {
                bodyHTML += `<tr><td class="skill-name" title="${skill}">${skill}</td>`;
                
                weeks.forEach((week, weekIndex) => {
                    // Sample data - replace with actual operational data
                    const percentage = (skillIndex === 0 && weekIndex === 0) ? 100 : 0;
                    const statusClass = percentage >= 95 ? 'green' : percentage >= 45 ? 'amber' : percentage > 0 ? 'red' : 'empty';
                    const filledDays = percentage >= 95 ? 7 : percentage >= 45 ? Math.floor(percentage / 100 * 7) : 0;
                    
                    bodyHTML += `
                        <td class="status-cell" onclick="editCell('${skill}', '${week.label}')">
                            <div class="status-dot ${statusClass}">
                                ${percentage > 0 ? percentage + '%' : '--'}
                            </div>
                            <div class="status-indicators">
                                ${generateStatusIndicators(7, filledDays)}
                            </div>
                        </td>
                    `;
                });
                
                bodyHTML += '</tr>';
            });
            
            bodyContainer.innerHTML = bodyHTML;
        }

        function generateStatusIndicators(total, filled) {
            let indicators = '';
            for (let i = 0; i < total; i++) {
                const className = i < filled ? 'status-indicator filled' : 'status-indicator';
                indicators += `<div class="${className}"></div>`;
            }
            return indicators;
        }

        function generateDailyView() {
            console.log('üìÖ Generating daily view...');
            
            const selectedDate = new Date(currentDate);
            const weekStart = new Date(selectedDate);
            weekStart.setDate(selectedDate.getDate() - selectedDate.getDay());
            
            generateDailyStats();
            generateDailyGrid(weekStart);
        }

        function generateDailyStats() {
            // Sample statistics - replace with actual calculations
            document.getElementById('todayAverage').textContent = '75%';
            document.getElementById('weeklyAverage').textContent = '68%';
            document.getElementById('trendIndicator').textContent = 'üìà';
        }

        function generateDailyGrid(weekStart) {
            const gridContainer = document.getElementById('dailyGrid');
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            
            let gridHTML = '<div class="daily-header">Skills</div>';
            
            // Generate day headers
            for (let i = 0; i < 7; i++) {
                const currentDay = new Date(weekStart);
                currentDay.setDate(weekStart.getDate() + i);
                
                gridHTML += `
                    <div class="daily-header">
                        ${dayNames[i]}<br>
                        <small>${currentDay.getDate()}/${currentDay.getMonth() + 1}</small>
                    </div>
                `;
            }
            
            // Generate skill rows
            skillsData.forEach((skill, skillIndex) => {
                gridHTML += `<div class="daily-skill" title="${skill}">${skill}</div>`;
                
                // Generate daily cells for each skill
                for (let i = 0; i < 7; i++) {
                    // Sample data - replace with actual data
                    const hasData = skillIndex === 0 && i < 3; // Sample: first skill has data for first 3 days
                    const percentage = hasData ? 100 : 0;
                    const statusClass = hasData ? 'green' : 'empty';
                    
                    gridHTML += `
                        <div class="daily-cell" onclick="editDailyCell('${skill}', ${i})">
                            <div class="status-dot ${statusClass}">
                                ${hasData ? '‚úì' : '--'}
                            </div>
                            <div style="font-size: 10px; font-weight: 600; color: var(--primary-green); margin-top: 4px;">
                                ${percentage}%
                            </div>
                        </div>
                    `;
                }
            });
            
            gridContainer.innerHTML = gridHTML;
        }

        function updateStatistics() {
            // Calculate statistics from current data
            let totalEntries = 0;
            let optimalCount = 0;
            let attentionCount = 0;
            let criticalCount = 0;

            // Sample calculations - replace with actual data analysis
            totalEntries = skillsData.length * 5; // 5 weeks of data per skill
            optimalCount = 1; // One entry at 100%
            attentionCount = 0;
            criticalCount = totalEntries - optimalCount - attentionCount;

            // Update DOM elements
            document.getElementById('totalEntries').textContent = totalEntries;
            document.getElementById('optimalCount').textContent = optimalCount;
            document.getElementById('attentionCount').textContent = attentionCount;
            document.getElementById('criticalCount').textContent = criticalCount;

            // Update performance metrics
            const monthlyPerf = Math.round((optimalCount / totalEntries) * 100) || 0;
            const yearlyPerf = Math.round(monthlyPerf * 0.8) || 0; // Sample yearly calculation

            document.getElementById('monthlyPerformance').textContent = monthlyPerf + '%';
            document.getElementById('yearlyPerformance').textContent = yearlyPerf + '%';

            // Update trend indicators
            document.getElementById('monthlyTrend').textContent = monthlyPerf > 50 ? 'üìà Improving' : 'üìâ Needs Attention';
            document.getElementById('yearlyTrend').textContent = yearlyPerf > 50 ? 'üìà Stable Growth' : 'üìâ Focus Required';

            // Store updated statistics
            statisticsData = {
                totalEntries,
                optimalCount,
                attentionCount,
                criticalCount,
                monthlyPerformance: monthlyPerf,
                yearlyPerformance: yearlyPerf
            };
        }

        // ========================================
        // SKILL MANAGEMENT FUNCTIONS
        // ========================================

        function updateSkillsList() {
            const skillsList = document.getElementById('skillsList');
            let skillsHTML = '';

            skillsData.forEach((skill, index) => {
                skillsHTML += `
                    <div class="skill-item">
                        <div class="skill-item-name">${skill}</div>
                        <div class="skill-item-actions">
                            <button class="skill-action-btn edit" onclick="editSkill(${index})">‚úèÔ∏è Edit</button>
                            <button class="skill-action-btn delete" onclick="deleteSkill(${index})">üóëÔ∏è Delete</button>
                        </div>
                    </div>
                `;
            });

            skillsList.innerHTML = skillsHTML || '<p style="color: var(--medium-gray);">No skills added yet.</p>';
        }

        function addSkillFromInput() {
            const skillInput = document.getElementById('newSkillInput');
            const skillName = skillInput.value.trim();

            if (!skillName) {
                alert('Please enter a skill name');
                return;
            }

            if (skillsData.includes(skillName)) {
                alert('This skill already exists');
                return;
            }

            skillsData.push(skillName);
            localStorage.setItem('hboard_skills_data', JSON.stringify(skillsData));

            skillInput.value = '';
            updateSkillsList();
            refreshData();
            logAction('Add Skill', `Added new skill: ${skillName}`);

            console.log('‚úÖ Skill added:', skillName);
        }

        function editSkill(index) {
            const currentName = skillsData[index];
            const newName = prompt('Enter new skill name:', currentName);

            if (newName && newName.trim() && newName !== currentName) {
                const trimmedName = newName.trim();
                
                if (skillsData.includes(trimmedName)) {
                    alert('This skill name already exists');
                    return;
                }

                skillsData[index] = trimmedName;
                localStorage.setItem('hboard_skills_data', JSON.stringify(skillsData));

                updateSkillsList();
                refreshData();
                logAction('Edit Skill', `Changed "${currentName}" to "${trimmedName}"`);

                console.log('‚úÖ Skill edited:', trimmedName);
            }
        }

        function deleteSkill(index) {
            const skillName = skillsData[index];
            
            if (confirm(`Are you sure you want to delete "${skillName}"?\n\nThis will remove all associated data.`)) {
                skillsData.splice(index, 1);
                localStorage.setItem('hboard_skills_data', JSON.stringify(skillsData));

                updateSkillsList();
                refreshData();
                logAction('Delete Skill', `Deleted skill: ${skillName}`);

                console.log('üóëÔ∏è Skill deleted:', skillName);
            }
        }

        // ========================================
        // UTILITY FUNCTIONS
        // ========================================

        function editCell(skill, week) {
            console.log(`Editing: ${skill} - ${week}`);
            // In a real implementation, this would open an editing interface
            const newValue = prompt(`Edit ${skill} for ${week}:\n\nEnter percentage (0-100):`);
            
            if (newValue !== null && !isNaN(newValue) && newValue >= 0 && newValue <= 100) {
                console.log(`Updated ${skill} ${week} to ${newValue}%`);
                logAction('Edit Cell', `Updated ${skill} ${week} to ${newValue}%`);
                // In real implementation, save to operationalData and refresh view
            }
        }

        function editDailyCell(skill, dayIndex) {
            console.log(`Editing daily: ${skill} - Day ${dayIndex}`);
            // In a real implementation, this would open an editing interface
            const newValue = prompt(`Edit ${skill} for day ${dayIndex}:\n\nEnter percentage (0-100):`);
            
            if (newValue !== null && !isNaN(newValue) && newValue >= 0 && newValue <= 100) {
                console.log(`Updated ${skill} day ${dayIndex} to ${newValue}%`);
                logAction('Edit Daily Cell', `Updated ${skill} day ${dayIndex} to ${newValue}%`);
                // In real implementation, save to operationalData and refresh view
            }
        }

        function addNewSkill() {
            document.getElementById('addSkillModal').style.display = 'block';
            document.getElementById('newSkillName').focus();
        }

        function submitNewSkill() {
            const skillName = document.getElementById('newSkillName').value.trim();
            
            if (!skillName) {
                alert('Please enter a skill name');
                return false;
            }
            
            if (skillsData.includes(skillName)) {
                alert('This skill already exists');
                return false;
            }
            
            skillsData.push(skillName);
            localStorage.setItem('hboard_skills_data', JSON.stringify(skillsData));
            
            logAction('Add Skill', `Added new skill: ${skillName}`);
            closeModal('addSkillModal');
            updateSkillsList();
            refreshData();
            
            return false;
        }

        function exportToExcel() {
            console.log('üìä Exporting to Excel...');
            
            // In a real implementation, this would generate an actual Excel file
            const data = {
                landscape: currentLandscape,
                month: currentMonth,
                skills: skillsData,
                statistics: statisticsData,
                timestamp: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `hboard-export-${currentLandscape}-${currentMonth}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            logAction('Export Data', `Exported data for ${currentLandscape} - ${currentMonth}`);
            alert('‚úÖ Data exported successfully!');
        }

        function importData() {
            document.getElementById('importModal').style.display = 'block';
        }

        function processImport() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a file to import');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Process imported data
                    if (data.skills && Array.isArray(data.skills)) {
                        skillsData = [...new Set([...skillsData, ...data.skills])]; // Merge and deduplicate
                        localStorage.setItem('hboard_skills_data', JSON.stringify(skillsData));
                    }
                    
                    if (data.operationalData) {
                        Object.assign(operationalData, data.operationalData);
                        localStorage.setItem('hboard_operational_data', JSON.stringify(operationalData));
                    }
                    
                    logAction('Import Data', `Imported data from ${file.name}`);
                    closeModal('importModal');
                    updateSkillsList();
                    refreshData();
                    alert('‚úÖ Data imported successfully!');
                    
                } catch (error) {
                    console.error('Import error:', error);
                    alert('‚ùå Error importing file: Invalid format');
                }
            };
            
            reader.readAsText(file);
        }

        function viewHistory() {
            document.getElementById('historyModal').style.display = 'block';
            
            const historyContent = document.getElementById('historyContent');
            
            if (historyLog.length === 0) {
                historyContent.innerHTML = '<p style="text-align: center; color: var(--medium-gray);">No history available yet. Start using the dashboard to see activity logs here.</p>';
                return;
            }
            
            let historyHTML = '<div style="space-y: 10px;">';
            
            historyLog.slice(-20).reverse().forEach(entry => { // Show last 20 entries
                historyHTML += `
                    <div style="padding: 12px; border-left: 3px solid var(--primary-green); background: var(--light-gray); margin-bottom: 8px; border-radius: 4px;">
                        <div style="font-weight: 600; color: var(--primary-green);">${entry.action}</div>
                        <div style="font-size: 12px; color: var(--medium-gray); margin-top: 4px;">
                            ${entry.details} ‚Ä¢ ${entry.timestamp}
                        </div>
                    </div>
                `;
            });
            
            historyHTML += '</div>';
            historyContent.innerHTML = historyHTML;
        }

        function clearData() {
            if (confirm('‚ö†Ô∏è Are you sure you want to clear all operational data?\n\nThis will not delete skills, but will remove all performance data.\n\nThis action cannot be undone.')) {
                operationalData = {};
                localStorage.removeItem('hboard_operational_data');
                
                logAction('Clear Data', 'All operational data cleared');
                refreshData();
                alert('‚úÖ Operational data cleared successfully!');
            }
        }

        function syncData() {
            console.log('üîÑ Syncing data...');
            
            // Simulate sync process
            const syncMessage = document.createElement('div');
            syncMessage.innerHTML = 'üîÑ Syncing data...';
            syncMessage.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--primary-green);
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                font-weight: 600;
                z-index: 1001;
                box-shadow: var(--shadow-medium);
                animation: slideInRight 0.3s ease-out;
            `;
            
            document.body.appendChild(syncMessage);
            
            setTimeout(() => {
                syncMessage.innerHTML = '‚úÖ Sync complete!';
                setTimeout(() => {
                    if (document.body.contains(syncMessage)) {
                        document.body.removeChild(syncMessage);
                    }
                }, 2000);
            }, 1500);
            
            logAction('Sync Data', 'Data synchronized successfully');
        }

        function logAction(action, details) {
            const entry = {
                action: action,
                details: details,
                timestamp: new Date().toLocaleString(),
                user: window.isAdminMode ? 'Admin User' : window.firebaseUser ? window.firebaseUser.email : 'Current User',
                landscape: currentLandscape
            };
            
            historyLog.push(entry);
            
            // Keep only last 100 entries
            if (historyLog.length > 100) {
                historyLog = historyLog.slice(-100);
            }
            
            localStorage.setItem('hboard_history_log', JSON.stringify(historyLog));
        }

        // ========================================
        // MODAL MANAGEMENT
        // ========================================

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            
            // Reset forms
            const modal = document.getElementById(modalId);
            const inputs = modal.querySelectorAll('input, textarea, select');
            inputs.forEach(input => {
                if (input.type !== 'file') {
                    input.value = '';
                }
            });
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal') || event.target.classList.contains('email-modal')) {
                if (event.target.id === 'emailModal') {
                    closeEmailModal();
                } else {
                    closeModal(event.target.id);
                }
            }
        }

        // Keyboard shortcuts and accessibility
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                // Close any open modal
                const modals = document.querySelectorAll('.modal, .email-modal');
                modals.forEach(modal => {
                    if (modal.style.display === 'block' || modal.style.display === 'flex') {
                        if (modal.id === 'emailModal') {
                            closeEmailModal();
                        } else {
                            closeModal(modal.id);
                        }
                    }
                });
            }
            
            // Quick admin access (Ctrl+Alt+A)
            if (event.ctrlKey && event.altKey && event.key === 'a') {
                if (!window.isAdminMode) {
                    document.getElementById('email').value = 'admin';
                    document.getElementById('password').value = 'admin123';
                    document.getElementById('auth-status').innerHTML = '<div>üëë Quick Admin Access - Click Sign In</div>';
                    document.getElementById('auth-status').className = 'auth-status success';
                }
            }
        });

        // Add keyboard support for skill input
        document.addEventListener('DOMContentLoaded', function() {
            const newSkillInput = document.getElementById('newSkillInput');
            if (newSkillInput) {
                newSkillInput.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter') {
                        addSkillFromInput();
                    }
                });
            }
        });

        // ========================================
        // INITIALIZATION
        // ========================================

        // Initialize dashboard when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved data
            const savedSkills = localStorage.getItem('hboard_skills_data');
            if (savedSkills) {
                skillsData = JSON.parse(savedSkills);
            }
            
            const savedOperationalData = localStorage.getItem('hboard_operational_data');
            if (savedOperationalData) {
                operationalData = JSON.parse(savedOperationalData);
            }
            
            const savedHistoryLog = localStorage.getItem('hboard_history_log');
            if (savedHistoryLog) {
                historyLog = JSON.parse(savedHistoryLog);
            }
            
            // Firebase Auth State Listener
            if (window.firebaseAuth && window.firebaseAuthStateChanged) {
                window.firebaseAuthStateChanged(window.firebaseAuth, (user) => {
                    if (user) {
                        window.firebaseUser = user;
                        updateConnectionStatus('connected');
                        showDashboard();
                        
                        // Show user info
                        const userInfo = document.getElementById('userInfo');
                        const userEmail = document.getElementById('userEmail');
                        userInfo.style.display = 'block';
                        userEmail.textContent = user.email;
                    } else {
                        window.firebaseUser = null;
                        if (!window.isAdminMode) {
                            hideDashboard();
                        }
                    }
                });
            }
            
            // Log system startup
            logAction('System Startup', 'HBoard Operations Dashboard initialized with SMTP and Firebase integration');
            
            console.log('‚úÖ Dashboard data loaded from localStorage');
            updateConnectionStatus('connecting');
        });

        // Add CSS animation keyframes dynamically
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from {
                    opacity: 0;
                    transform: translateX(100px);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }
        `;
        document.head.appendChild(style);

        // Console welcome message
        console.log(`
üîπ HBoard - Advanced Operations Excellence Dashboard v2024.09.07 üîπ
‚úÖ Production-ready dashboard loaded successfully
üîê Authentication: Firebase + Admin access (admin/admin123)
üìß Email Integration: SMTP.js + EmailJS with screenshot preview
üéØ Dynamic KPIs: Monthly/Yearly performance tracking
üìä Skills Management: Full CRUD operations (REDUCED WIDTH)
üîÑ Real-time Sync: Active and functional
üé® Responsive Design: Optimized for all devices
üì± Mobile Ready: Touch-friendly interface
üöÄ Ready for enterprise deployment and internship presentation
        `);
    </script>
</body>
</html>
