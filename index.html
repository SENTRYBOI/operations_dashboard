<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>üîπ HBoard - Advanced Operations Excellence Dashboard v2024 üîπ</title>
    <meta name="description" content="Production-ready operations dashboard with Firebase authentication, Gmail API integration, dynamic KPI analytics, and real-time team collaboration">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
    
    <!-- Google API Library -->
    <script src="https://apis.google.com/js/api.js"></script>
    
    <!-- External CDN Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3.11.0/dist/email.min.js"></script>
    
    <style>
        /* Global Styles and CSS Variables */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-green: #28a745;
            --secondary-teal: #20c997;
            --accent-blue: #17a2b8;
            --warning-amber: #ffc107;
            --danger-red: #dc3545;
            --light-gray: #f8f9fa;
            --medium-gray: #6c757d;
            --dark-gray: #343a40;
            --border-color: #dee2e6;
            --shadow-light: 0 2px 10px rgba(0,0,0,0.1);
            --shadow-medium: 0 4px 20px rgba(0,0,0,0.15);
            --shadow-heavy: 0 8px 30px rgba(0,0,0,0.2);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --gradient-primary: linear-gradient(135deg, var(--primary-green) 0%, var(--secondary-teal) 100%);
            --gradient-secondary: linear-gradient(135deg, var(--secondary-teal) 0%, var(--accent-blue) 100%);
        }
        
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--dark-gray);
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
            font-size: 14px;
            padding: 10px;
        }

        /* Authentication Section Styles */
        #auth-section {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(10px);
        }

        .auth-container {
            background: white;
            padding: 50px;
            border-radius: 20px;
            box-shadow: var(--shadow-heavy);
            text-align: center;
            min-width: 450px;
            max-width: 500px;
            border: 3px solid var(--primary-green);
            position: relative;
            animation: slideInUp 0.6s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(100px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .auth-container h2 {
            color: var(--primary-green);
            font-size: 2.5rem;
            margin-bottom: 15px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .auth-container .subtitle {
            color: var(--medium-gray);
            margin-bottom: 40px;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .auth-form input {
            padding: 18px 25px;
            border: 3px solid var(--primary-green);
            border-radius: 12px;
            font-size: 18px;
            background: white;
            color: var(--dark-gray);
            transition: var(--transition);
            font-family: inherit;
        }

        .auth-form input:focus {
            outline: none;
            border-color: var(--secondary-teal);
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
            transform: translateY(-2px);
        }

        .auth-form input::placeholder {
            color: var(--medium-gray);
        }

        .auth-buttons {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }

        .auth-btn {
            flex: 1;
            padding: 18px 25px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            font-family: inherit;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .auth-btn.signup {
            background: var(--primary-green);
            color: white;
            border: 3px solid var(--primary-green);
        }

        .auth-btn.signup:hover {
            background: var(--secondary-teal);
            border-color: var(--secondary-teal);
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }

        .auth-btn.signin {
            background: transparent;
            color: var(--primary-green);
            border: 3px solid var(--primary-green);
        }

        .auth-btn.signin:hover {
            background: var(--primary-green);
            color: white;
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }

        .auth-btn.signout {
            background: var(--danger-red);
            color: white;
            border: 3px solid var(--danger-red);
            position: fixed;
            top: 20px;
            right: 20px;
            flex: none;
            padding: 12px 20px;
            font-size: 14px;
            z-index: 10000;
            border-radius: 25px;
        }

        .auth-btn.signout:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .google-signin-btn {
            background: #4285f4;
            color: white;
            border: 3px solid #4285f4;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .google-signin-btn:hover {
            background: #3367d6;
            border-color: #3367d6;
        }

        .auth-status {
            margin-top: 25px;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 16px;
        }

        .auth-status.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .auth-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .auth-loading {
            color: var(--primary-green);
            font-style: italic;
        }

        .auth-divider {
            margin: 30px 0;
            position: relative;
            text-align: center;
        }

        .auth-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--border-color);
        }

        .auth-divider span {
            background: white;
            padding: 0 20px;
            color: var(--medium-gray);
            font-weight: 600;
        }

        /* Connection Status */
        .connection-status {
            position: fixed;
            top: 10px;
            left: 20px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1000;
            transition: var(--transition);
        }

        .connection-status.connected {
            background: var(--primary-green);
            color: white;
        }

        .connection-status.connecting {
            background: var(--warning-amber);
            color: var(--dark-gray);
        }

        .connection-status.offline {
            background: var(--danger-red);
            color: white;
        }

        /* Main Container */
        .main-container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-heavy);
            overflow: hidden;
            border: 2px solid var(--primary-green);
            display: none; /* Hidden by default until authenticated */
        }
        
        /* Header Styles */
        .header {
            background: var(--gradient-primary);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 2.4rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .header .subtitle {
            font-size: 1.15rem;
            opacity: 0.95;
            font-weight: 500;
        }
        
        .version-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .user-info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: none;
        }
        
        /* Content Area */
        .content {
            padding: 25px;
            background: var(--light-gray);
        }
        
        /* Control Panel */
        .control-panel {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow-light);
            border: 2px solid var(--primary-green);
        }
        
        .control-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 180px;
        }
        
        .control-group label {
            font-weight: 700;
            color: var(--primary-green);
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Form Elements */
        select, input[type="month"], input[type="date"], input[type="text"], input[type="number"], input[type="email"] {
            padding: 12px 16px;
            border: 2px solid var(--primary-green);
            border-radius: 8px;
            font-size: 14px;
            background: white;
            color: var(--dark-gray);
            transition: var(--transition);
            font-family: inherit;
        }
        
        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: var(--secondary-teal);
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
            transform: translateY(-1px);
        }
        
        textarea {
            padding: 12px 16px;
            border: 2px solid var(--primary-green);
            border-radius: 8px;
            font-size: 14px;
            background: white;
            color: var(--dark-gray);
            resize: vertical;
            font-family: inherit;
            min-height: 80px;
        }
        
        /* View Toggle */
        .view-toggle {
            display: flex;
            background: var(--border-color);
            border-radius: 25px;
            padding: 4px;
            border: 2px solid var(--primary-green);
        }
        
        .toggle-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 20px;
            background: transparent;
            color: var(--medium-gray);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .toggle-btn.active {
            background: var(--primary-green);
            color: white;
            box-shadow: var(--shadow-light);
        }
        
        .toggle-btn:hover:not(.active) {
            background: rgba(40, 167, 69, 0.1);
            color: var(--primary-green);
        }
        
        /* Buttons */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border: 2px solid transparent;
        }
        
        .btn-primary {
            background: var(--primary-green);
            color: white;
            border-color: var(--primary-green);
        }
        
        .btn-primary:hover {
            background: var(--secondary-teal);
            border-color: var(--secondary-teal);
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        .btn-success {
            background: var(--secondary-teal);
            color: white;
            border-color: var(--secondary-teal);
        }
        
        .btn-success:hover {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        .btn-warning {
            background: var(--warning-amber);
            color: var(--dark-gray);
            border-color: var(--warning-amber);
        }
        
        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        .btn-danger {
            background: var(--danger-red);
            color: white;
            border-color: var(--danger-red);
        }
        
        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        .btn-email {
            background: var(--accent-blue);
            color: white;
            border-color: var(--accent-blue);
        }
        
        .btn-email:hover {
            background: #138496;
            border-color: #138496;
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        /* Action Buttons Grid */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        /* KPI Dashboard Section */
        .kpi-dashboard {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 25px;
            border: 2px solid var(--secondary-teal);
            box-shadow: var(--shadow-light);
        }

        .kpi-dashboard h2 {
            color: var(--secondary-teal);
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .kpi-performance-section {
            margin-bottom: 40px;
        }

        .kpi-performance-section h3 {
            color: var(--primary-green);
            font-size: 1.4rem;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .performance-card {
            background: var(--gradient-primary);
            color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: var(--shadow-medium);
            transition: var(--transition);
        }

        .performance-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-heavy);
        }

        .performance-card h4 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .performance-value {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .performance-label {
            font-size: 0.9rem;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .performance-trend {
            margin-top: 15px;
            padding: 10px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            font-size: 0.85rem;
            backdrop-filter: blur(10px);
        }

        /* Dashboard Views */
        .dashboard-container {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-light);
            border: 2px solid var(--primary-green);
        }
        
        /* KPI Section */
        .kpi-section {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            border: 2px solid var(--secondary-teal);
            box-shadow: var(--shadow-light);
        }
        
        .kpi-section h3 {
            color: var(--secondary-teal);
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.4rem;
            font-weight: 700;
        }
        
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
        }
        
        .kpi-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid var(--secondary-teal);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
        }
        
        .kpi-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
            border-color: var(--primary-green);
        }
        
        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .kpi-value.red { color: var(--danger-red) !important; }
        .kpi-value.amber { color: var(--warning-amber) !important; }
        .kpi-value.green { color: var(--primary-green) !important; }
        
        .kpi-label {
            font-size: 0.85rem;
            color: var(--medium-gray);
            font-weight: 600;
            line-height: 1.3;
        }
        
        /* Monthly View Table */
        .monthly-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            background: white;
        }
        
        .monthly-table th {
            background: var(--gradient-primary);
            color: white;
            padding: 16px 12px;
            text-align: center;
            border: 1px solid var(--secondary-teal);
            font-weight: 700;
            font-size: 13px;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .monthly-table th.skill-header {
            text-align: left;
            padding-left: 20px;
            min-width: 140px;
            max-width: 160px;
            position: sticky;
            left: 0;
            z-index: 11;
        }
        
        .monthly-table td {
            border: 1px solid var(--border-color);
            padding: 12px 8px;
            text-align: center;
            vertical-align: middle;
            transition: var(--transition);
        }
        
        .monthly-table td.skill-name {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            font-weight: 600;
            text-align: left;
            padding-left: 20px;
            border-right: 3px solid var(--primary-green);
            color: var(--primary-green);
            min-width: 140px;
            max-width: 160px;
            font-size: 12px;
            position: sticky;
            left: 0;
            z-index: 5;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .monthly-table td.skill-name:hover {
            background: rgba(40, 167, 69, 0.1);
        }
        
        .monthly-table tbody tr:hover {
            background: rgba(40, 167, 69, 0.02);
        }
        
        /* Status Cells and Dots */
        .status-cell {
            cursor: pointer;
            position: relative;
            padding: 15px 8px;
        }
        
        .status-cell:hover {
            background: rgba(40, 167, 69, 0.1);
            transform: scale(1.02);
        }
        
        .status-dot {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin: 0 auto 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 11px;
            color: white;
            border: 3px solid transparent;
            box-shadow: var(--shadow-light);
            transition: var(--transition);
        }
        
        .status-dot:hover {
            transform: scale(1.2);
            box-shadow: var(--shadow-medium);
        }
        
        .status-dot.green {
            background: var(--primary-green);
            border-color: #1e7e34;
        }
        
        .status-dot.amber {
            background: var(--warning-amber);
            border-color: #d39e00;
            color: var(--dark-gray);
        }
        
        .status-dot.red {
            background: var(--danger-red);
            border-color: #bd2130;
        }
        
        .status-dot.gray {
            background: var(--medium-gray);
            border-color: #495057;
        }
        
        .status-dot.empty {
            background: var(--light-gray);
            border: 3px dashed var(--medium-gray);
            color: var(--medium-gray);
        }
        
        /* Status Indicators */
        .status-indicators {
            display: flex;
            justify-content: center;
            gap: 2px;
            margin-top: 5px;
        }
        
        .status-indicator {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--border-color);
            transition: var(--transition);
        }
        
        .status-indicator.filled {
            background: var(--primary-green);
        }
        
        .status-indicator.partial {
            background: var(--warning-amber);
        }

        /* Skill Management Section */
        .skill-management {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid var(--accent-blue);
            box-shadow: var(--shadow-light);
        }

        .skill-management h3 {
            color: var(--accent-blue);
            font-size: 1.4rem;
            margin-bottom: 20px;
            font-weight: 700;
            text-align: center;
        }

        .skill-management-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .skill-list-section, .add-skill-section {
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
        }

        .skill-list-section h4, .add-skill-section h4 {
            color: var(--primary-green);
            margin-bottom: 15px;
            font-weight: 600;
        }

        .skills-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .skill-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 8px;
            transition: var(--transition);
        }

        .skill-item:hover {
            background: var(--light-gray);
            border-color: var(--primary-green);
        }

        .skill-item-name {
            font-weight: 600;
            color: var(--dark-gray);
        }

        .skill-item-actions {
            display: flex;
            gap: 5px;
        }

        .skill-action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .skill-action-btn.edit {
            background: var(--warning-amber);
            color: var(--dark-gray);
        }

        .skill-action-btn.delete {
            background: var(--danger-red);
            color: white;
        }

        .skill-action-btn:hover {
            transform: scale(1.1);
        }

        .add-skill-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .add-skill-form input {
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
        }

        .add-skill-form input:focus {
            border-color: var(--primary-green);
            outline: none;
        }
        
        /* Email Modal Styles */
        .email-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .email-modal-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-heavy);
            border: 3px solid var(--accent-blue);
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .email-modal h3 {
            color: var(--accent-blue);
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 25px;
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--accent-blue);
        }
        
        .email-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .email-form label {
            font-weight: 700;
            color: var(--accent-blue);
            margin-bottom: 5px;
            display: block;
        }
        
        .email-form select[multiple] {
            min-height: 120px;
        }
        
        .email-form small {
            color: var(--medium-gray);
            font-size: 11px;
            margin-top: 5px;
            display: block;
        }
        
        .email-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            color: var(--danger-red);
            cursor: pointer;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .email-close:hover {
            background: var(--danger-red);
            color: white;
            transform: scale(1.1);
        }
        
        .email-status {
            padding: 15px;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            margin-top: 15px;
            display: none;
        }
        
        .email-status.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        
        .email-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        
        .email-status.loading {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffeaa7;
        }

        /* API Status Indicator */
        .api-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1000;
            transition: var(--transition);
        }

        .api-status.gmail-ready {
            background: #4285f4;
            color: white;
        }

        .api-status.emailjs-ready {
            background: var(--accent-blue);
            color: white;
        }

        .api-status.api-error {
            background: var(--danger-red);
            color: white;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            
            .auth-container {
                min-width: 300px;
                padding: 30px;
                margin: 20px;
            }

            .auth-buttons {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .content {
                padding: 15px;
            }
            
            .control-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .control-group {
                min-width: auto;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .skill-management-content {
                grid-template-columns: 1fr;
            }
        }
        
        /* Print Styles */
        @media print {
            .action-buttons, .version-badge, .email-modal, .auth-section {
                display: none !important;
            }
            
            .main-container {
                box-shadow: none;
                border: 1px solid #ccc;
            }
            
            .header {
                background: #28a745 !important;
                -webkit-print-color-adjust: exact;
            }
        }
        
        /* Utility Classes */
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        .font-bold { font-weight: 700; }
        .font-medium { font-weight: 600; }
        .text-green { color: var(--primary-green); }
        .text-teal { color: var(--secondary-teal); }
        .text-red { color: var(--danger-red); }
        .text-amber { color: var(--warning-amber); }
        .text-gray { color: var(--medium-gray); }
        .mb-10 { margin-bottom: 10px; }
        .mb-15 { margin-bottom: 15px; }
        .mb-20 { margin-bottom: 20px; }
        .mt-10 { margin-top: 10px; }
        .mt-15 { margin-top: 15px; }
        .mt-20 { margin-top: 20px; }
        .hidden { display: none; }
        .visible { display: block; }
    </style>
</head>
<body>
    <!-- Authentication Section -->
    <div id="auth-section">
        <div class="auth-container">
            <h2>üîê HBoard Login</h2>
            <p class="subtitle">Secure access with Firebase & Gmail API integration</p>
            
            <form class="auth-form" onsubmit="return false;">
                <input type="text" id="email" placeholder="üìß Enter your email address" required>
                <input type="password" id="password" placeholder="üîí Enter your password" required>
                
                <div class="auth-buttons">
                    <button type="button" class="auth-btn signup" onclick="signUp()">
                        üöÄ Create Account
                    </button>
                    <button type="button" class="auth-btn signin" onclick="signIn()">
                        üîë Sign In
                    </button>
                </div>
                
                <button type="button" class="auth-btn google-signin-btn" onclick="signInWithGoogle()">
                    <svg width="18" height="18" viewBox="0 0 18 18">
                        <path fill="#4285F4" d="M16.51,8H8.98v3h4.3c-0.21,0.83-0.64,1.54-1.23,2.1v1.74h1.98c1.16-1.07,1.97-2.75,1.97-4.76 C15.99,9.43,16.26,8.68,16.51,8z"/>
                        <path fill="#34A853" d="M8.98,17c2.16,0,3.97-0.72,5.3-1.94l-1.98-1.74c-0.73,0.5-1.67,0.79-2.84,0.79 c-2.19,0-4.04-1.48-4.7-3.47H2.78v1.79C4.1,15.07,6.4,17,8.98,17z"/>
                        <path fill="#FBBC05" d="M4.28,10.64c-0.17-0.5-0.28-1.04-0.28-1.58c0-0.54,0.11-1.08,0.28-1.58V5.69H2.78 C2.01,7.21,1.6,8.84,1.6,10.5s0.41,3.29,1.18,4.81L4.28,10.64z"/>
                        <path fill="#EA4335" d="M8.98,4.18c1.17,0,2.23,0.4,3.06,1.2l2.3-2.3C13.94,1.69,11.7,0.5,8.98,0.5 C6.4,0.5,4.1,2.43,2.78,5.69l1.5,4.67C4.94,5.66,6.79,4.18,8.98,4.18z"/>
                    </svg>
                    Continue with Google
                </button>
            </form>
            
            <div id="auth-status" class="auth-status"></div>
            
            <div class="auth-divider">
                <span>Firebase Authentication + Gmail API + EmailJS Backup</span>
            </div>
        </div>
    </div>

    <!-- Sign Out Button -->
    <button id="signOutBtn" class="auth-btn signout" onclick="signOut()" style="display:none">
        üö™ Sign Out
    </button>

    <!-- Connection Status -->
    <div id="connectionStatus" class="connection-status connecting">üîÑ Initializing...</div>

    <!-- API Status -->
    <div id="apiStatus" class="api-status api-error">üîÑ Loading APIs...</div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Header Section -->
        <header class="header">
            <div id="userInfo" class="user-info" style="display:none">
                üë§ <span id="userEmail"></span>
            </div>
            <div class="version-badge">v2024.09.08</div>
            <h1>üìä HBoard - Operations Excellence Dashboard</h1>
            <p class="subtitle">Firebase Authentication, Gmail API Integration, Dynamic KPIs & Real-time Collaboration</p>
        </header>

        <!-- Main Content -->
        <main class="content">
            <!-- Control Panel -->
            <section class="control-panel">
                <div class="control-row">
                    <div class="control-group">
                        <label for="landscapeSelect">üåç Landscape</label>
                        <select id="landscapeSelect">
                            <option value="Europe">Europe</option>
                            <option value="NAM">North America</option>
                            <option value="APAC">Asia Pacific</option>
                            <option value="SEA">Southeast Asia</option>
                            <option value="IA">India & Australia</option>
                            <option value="Global">Global Operations</option>
                        </select>
                    </div>

                    <div class="control-group" id="monthControl">
                        <label for="monthSelect">üìÖ Month/Year</label>
                        <input type="month" id="monthSelect">
                    </div>

                    <div class="control-group">
                        <label>üìä View Mode</label>
                        <div class="view-toggle">
                            <button class="toggle-btn active" onclick="switchView('monthly')">üìä Monthly</button>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="refreshData()">
                        üîÑ Refresh Data
                    </button>
                    <button class="btn btn-email" onclick="openEmailModal()">
                        üì§ Send via Gmail
                    </button>
                    <button class="btn btn-success" onclick="addNewSkill()">
                        ‚ûï Add Skill
                    </button>
                    <button class="btn btn-primary" onclick="exportToExcel()">
                        üìä Export Data
                    </button>
                    <button class="btn btn-warning" onclick="testEmailApis()">
                        üìß Test Email APIs
                    </button>
                    <button class="btn btn-success" onclick="syncData()">
                        üîÑ Sync Firebase
                    </button>
                </div>
            </section>

            <!-- KPI Dashboard Section -->
            <section class="kpi-dashboard">
                <h2>üìà Key Performance Indicators</h2>
                
                <!-- Monthly/Yearly Performance -->
                <div class="kpi-performance-section">
                    <h3>üìÖ Monthly Performance - <span id="currentMonthDisplay">September 2025</span></h3>
                    <div class="performance-grid">
                        <div class="performance-card">
                            <h4>üìÖ Monthly Performance</h4>
                            <div class="performance-value" id="monthlyPerformance">0%</div>
                            <div class="performance-label">Overall Availability</div>
                            <div class="performance-trend" id="monthlyTrend">üìä Monthly Trend</div>
                        </div>
                        <div class="performance-card">
                            <h4>üìä Yearly Performance</h4>
                            <div class="performance-value" id="yearlyPerformance">0%</div>
                            <div class="performance-label">Overall Availability</div>
                            <div class="performance-trend" id="yearlyTrend">üìä Yearly Trend</div>
                        </div>
                    </div>
                </div>

                <!-- Dynamic Percentage Calculation -->
                <div style="background: white; border-radius: var(--border-radius); padding: 25px; margin-bottom: 25px; border: 2px solid var(--warning-amber); box-shadow: var(--shadow-light);">
                    <h3 style="color: var(--warning-amber); font-size: 1.4rem; margin-bottom: 20px; font-weight: 700; text-align: center;">ü§ñ Dynamic Percentage Calculation + Real-time Firebase Sync</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="padding: 20px; border-radius: var(--border-radius); border: 2px solid var(--primary-green); background: rgba(40, 167, 69, 0.05); transition: var(--transition);">
                            <div style="font-size: 2rem; margin-bottom: 15px;">üü¢</div>
                            <div style="font-weight: 700; font-size: 1.1rem; margin-bottom: 10px;">Green (95-100%):</div>
                            <div style="color: var(--medium-gray); font-size: 0.9rem; line-height: 1.5;">Minimal downtime (‚â§1.2 hours/day)</div>
                        </div>
                        <div style="padding: 20px; border-radius: var(--border-radius); border: 2px solid var(--warning-amber); background: rgba(255, 193, 7, 0.05); transition: var(--transition);">
                            <div style="font-size: 2rem; margin-bottom: 15px;">üü°</div>
                            <div style="font-weight: 700; font-size: 1.1rem; margin-bottom: 10px;">Amber (45-95%):</div>
                            <div style="color: var(--medium-gray); font-size: 0.9rem; line-height: 1.5;">Moderate downtime (1.2-13.2 hours/day)</div>
                        </div>
                        <div style="padding: 20px; border-radius: var(--border-radius); border: 2px solid var(--danger-red); background: rgba(220, 53, 69, 0.05); transition: var(--transition);">
                            <div style="font-size: 2rem; margin-bottom: 15px;">üî¥</div>
                            <div style="font-weight: 700; font-size: 1.1rem; margin-bottom: 10px;">Red (0-45%):</div>
                            <div style="color: var(--medium-gray); font-size: 0.9rem; line-height: 1.5;">High downtime (>13.2 hours/day)</div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 20px; padding: 15px; background: rgba(32, 201, 151, 0.1); border-radius: 8px;">
                        <strong>üìä Real-time Sync:</strong> Data syncs automatically across all team members via Firebase<br>
                        <strong>üî• Multi-API Email:</strong> Gmail API primary, EmailJS backup integration
                    </div>
                </div>
            </section>

            <!-- Skill Management Section -->
            <section class="skill-management">
                <h3>üõ†Ô∏è Skill Management</h3>
                <p style="text-align: center; color: var(--medium-gray); margin-bottom: 25px;">
                    Manage operational skills tracked across your team - synced via Firebase
                </p>
                <div class="skill-management-content">
                    <div class="skill-list-section">
                        <h4>üìã Current Skills</h4>
                        <div class="skills-list" id="skillsList">
                            <!-- Skills will be populated dynamically -->
                        </div>
                    </div>
                    <div class="add-skill-section">
                        <h4>‚ûï Add New Skill</h4>
                        <div class="add-skill-form">
                            <input type="text" id="newSkillInput" placeholder="Enter new skill/operational area...">
                            <button class="btn btn-success" onclick="addSkillFromInput()">
                                ‚úÖ Add Skill
                            </button>
                        </div>
                        <div style="margin-top: 15px; font-size: 12px; color: var(--medium-gray);">
                            <strong>Note:</strong> Skills are automatically synced to Firebase for team collaboration
                        </div>
                    </div>
                </div>
            </section>

            <!-- Dashboard Container -->
            <section class="dashboard-container">
                <div id="monthlyView">
                    <!-- KPI Section -->
                    <div class="kpi-section" id="weeklyKPIs">
                        <h3>üìä Weekly Skill Availability Overview</h3>
                        <div class="kpi-grid" id="kpiGrid">
                            <!-- KPI cards will be generated by JavaScript -->
                        </div>
                    </div>

                    <!-- Monthly Table -->
                    <div style="overflow-x: auto;">
                        <table class="monthly-table" id="monthlyTable">
                            <thead id="monthlyHeaders">
                                <!-- Headers will be generated by JavaScript -->
                            </thead>
                            <tbody id="monthlyBody">
                                <!-- Table body will be generated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Email Screenshot Modal -->
    <div class="email-modal" id="emailModal">
        <div class="email-modal-content">
            <button class="email-close" onclick="closeEmailModal()">&times;</button>
            <h3>üì§ Send Dashboard Screenshot</h3>
            
            <form class="email-form" onsubmit="return false;">
                <div>
                    <label for="emailRecipients">üìß Select Recipients:</label>
                    <select id="emailRecipients" multiple>
                        <option value="manager@company.com">üëî Manager (manager@company.com)</option>
                        <option value="team.lead@company.com">üë• Team Lead (team.lead@company.com)</option>
                        <option value="operations@company.com">‚öôÔ∏è Operations Team (operations@company.com)</option>
                        <option value="executives@company.com">üè¢ Executive Team (executives@company.com)</option>
                        <option value="qa.team@company.com">üîç QA Team (qa.team@company.com)</option>
                        <option value="support@company.com">üõü Support Team (support@company.com)</option>
                    </select>
                    <small>Hold Ctrl (or Cmd on Mac) to select multiple recipients</small>
                </div>

                <div>
                    <label for="customEmail">üìù Or enter custom email:</label>
                    <input type="email" id="customEmail" placeholder="user@company.com">
                </div>

                <div>
                    <label for="screenshotType">üìä Screenshot Content:</label>
                    <select id="screenshotType">
                        <option value="complete">üìä Complete Dashboard (KPIs + Table)</option>
                        <option value="kpi-dashboard">üìà KPI Dashboard Section</option>
                        <option value="weekly-kpis">üìä Weekly KPIs Overview Only</option>
                        <option value="skills-table">üìã Skills Performance Table Only</option>
                        <option value="skill-management">üõ†Ô∏è Skill Management Section</option>
                    </select>
                </div>

                <div>
                    <label for="emailSubject">üìå Email Subject:</label>
                    <input type="text" id="emailSubject" placeholder="HBoard Operations Report">
                </div>

                <div>
                    <label for="emailMessage">üí¨ Message (optional):</label>
                    <textarea id="emailMessage" rows="4" placeholder="Add a custom message to accompany the screenshot..."></textarea>
                </div>

                <div>
                    <label for="emailMethod">üìß Send Method:</label>
                    <select id="emailMethod">
                        <option value="gmail">üì® Gmail API (Primary)</option>
                        <option value="emailjs">üì§ EmailJS (Backup)</option>
                        <option value="auto">ü§ñ Auto (Gmail first, EmailJS fallback)</option>
                    </select>
                </div>

                <button type="button" class="btn btn-email" onclick="sendScreenshotEmail()">
                    üì§ Capture & Send Screenshot
                </button>
            </form>

            <div id="emailStatus" class="email-status"></div>
        </div>
    </div>

    <script>
        // ========================================
        // FIREBASE CONFIGURATION
        // ========================================
        const firebaseConfig = {
            // Replace with your Firebase config
           apiKey: "AIzaSyBUER5i1yjaLqQq8ycf9ZZaH3MMB2AmiXY",
  authDomain: "hboard-af489.firebaseapp.com",
  projectId: "hboard-af489",
  storageBucket: "hboard-af489.firebasestorage.app",
  messagingSenderId: "286896691982",
  appId: "1:286896691982:web:4df21083f8f2350874555f",
  measurementId: "G-EQ8S9T513X"
        };

        // Initialize Firebase
        let firebaseApp;
        let auth;
        let db;

        try {
            firebaseApp = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            console.log('üî• Firebase initialized successfully');
        } catch (error) {
            console.error('‚ùå Firebase initialization error:', error);
        }

        // ========================================
        // GMAIL API CONFIGURATION
        // ========================================
        const GMAIL_CONFIG = {
            CLIENT_ID: '879257674381-1qajkdfqtlfuguamntpqute3vfrqmrd5.apps.googleusercontent.com',
            API_KEY: 'AIzaSyAWhW6-mJf1Df4AodIkuPQcV2ryU4_pDKA',
            DISCOVERY_DOC: 'https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest',
            SCOPES: 'https://www.googleapis.com/auth/gmail.send'
        };

        let gmailInitialized = false;
        let gmailAuthorized = false;

        // ========================================
        // EMAILJS CONFIGURATION (BACKUP)
        // ========================================
        const EMAILJS_CONFIG = {
            PUBLIC_KEY: "uMjP4LeVCl37KXNHo",
            SERVICE_ID: "service_gf6rddd",
            TEMPLATE_ID: "template_894t362"
        };

        let emailjsInitialized = false;

        // ========================================
        // GLOBAL VARIABLES AND DATA STORAGE
        // ========================================
        let currentView = 'monthly';
        let currentLandscape = 'Europe';
        let currentMonth = new Date().toISOString().substring(0, 7);
        let currentUser = null;

        // Sample Skills Data
        let skillsData = [
            'Business Clarity',
            'Revenue',
            'BPT Processing', 
            'Stock Aging',
            'Inventory',
            'AMB for Manufacturing',
            'PMI for Manufacturing',
            'BPM Stock Reconciliation'
        ];

        // Operational Data Storage
        let operationalData = {};
        let historyLog = [];

        // Statistics Data
        let statisticsData = {
            totalEntries: 0,
            optimalCount: 0,
            attentionCount: 0,
            criticalCount: 0,
            monthlyPerformance: 0,
            yearlyPerformance: 0
        };

        // ========================================
        // INITIALIZATION
        // ========================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ HBoard Dashboard initializing...');
            
            // Initialize APIs
            initializeGmailAPI();
            initializeEmailJS();
            
            // Set up Firebase auth state listener
            if (auth) {
                auth.onAuthStateChanged(handleAuthStateChange);
            }
            
            // Update connection status
            updateConnectionStatus('connecting');
            updateApiStatus('api-error', 'üîÑ Loading APIs...');
        });

        // ========================================
        // GMAIL API FUNCTIONS
        // ========================================
        async function initializeGmailAPI() {
            try {
                await new Promise((resolve, reject) => {
                    gapi.load('client:auth2', resolve);
                });

                await gapi.client.init({
                    apiKey: GMAIL_CONFIG.API_KEY,
                    clientId: GMAIL_CONFIG.CLIENT_ID,
                    discoveryDocs: [GMAIL_CONFIG.DISCOVERY_DOC],
                    scope: GMAIL_CONFIG.SCOPES
                });

                gmailInitialized = true;
                console.log('üì® Gmail API initialized successfully');
                
                // Check if user is already authorized
                const authInstance = gapi.auth2.getAuthInstance();
                gmailAuthorized = authInstance.isSignedIn.get();
                
                updateApiStatus('gmail-ready', 'üì® Gmail API Ready');
                return true;
            } catch (error) {
                console.error('‚ùå Gmail API initialization error:', error);
                updateApiStatus('api-error', '‚ùå Gmail API Error');
                return false;
            }
        }

        async function authorizeGmailAPI() {
            try {
                if (!gmailInitialized) {
                    await initializeGmailAPI();
                }

                const authInstance = gapi.auth2.getAuthInstance();
                
                if (!authInstance.isSignedIn.get()) {
                    await authInstance.signIn();
                }
                
                gmailAuthorized = true;
                console.log('‚úÖ Gmail API authorized successfully');
                return true;
            } catch (error) {
                console.error('‚ùå Gmail authorization error:', error);
                return false;
            }
        }

        async function sendGmailEmail(to, subject, htmlBody, attachment = null) {
            try {
                if (!gmailAuthorized) {
                    const authorized = await authorizeGmailAPI();
                    if (!authorized) {
                        throw new Error('Gmail authorization failed');
                    }
                }

                // Create email message
                let message = [
                    `To: ${to}`,
                    `Subject: ${subject}`,
                    'Content-Type: text/html; charset="UTF-8"',
                    'MIME-Version: 1.0',
                    '',
                    htmlBody
                ].join('\r\n');

                // If attachment (base64 image), create multipart message
                if (attachment) {
                    const boundary = 'boundary_' + Math.random().toString(36).substr(2, 9);
                    message = [
                        `To: ${to}`,
                        `Subject: ${subject}`,
                        `Content-Type: multipart/mixed; boundary="${boundary}"`,
                        'MIME-Version: 1.0',
                        '',
                        `--${boundary}`,
                        'Content-Type: text/html; charset="UTF-8"',
                        '',
                        htmlBody,
                        '',
                        `--${boundary}`,
                        'Content-Type: image/png',
                        'Content-Disposition: attachment; filename="dashboard-screenshot.png"',
                        'Content-Transfer-Encoding: base64',
                        '',
                        attachment.split(',')[1], // Remove data:image/png;base64, prefix
                        '',
                        `--${boundary}--`
                    ].join('\r\n');
                }

                // Encode message
                const encodedMessage = btoa(unescape(encodeURIComponent(message)));

                // Send email via Gmail API
                const response = await gapi.client.gmail.users.messages.send({
                    userId: 'me',
                    resource: {
                        raw: encodedMessage
                    }
                });

                console.log('üì® Gmail email sent successfully:', response);
                return { success: true, messageId: response.result.id };
            } catch (error) {
                console.error('‚ùå Gmail send error:', error);
                throw error;
            }
        }

        // ========================================
        // EMAILJS FUNCTIONS (BACKUP)
        // ========================================
        function initializeEmailJS() {
            try {
                emailjs.init(EMAILJS_CONFIG.PUBLIC_KEY);
                emailjsInitialized = true;
                console.log('üìß EmailJS initialized successfully');
                
                if (!gmailInitialized) {
                    updateApiStatus('emailjs-ready', 'üìß EmailJS Ready (Backup)');
                }
                
                return true;
            } catch (error) {
                console.error('‚ùå EmailJS initialization error:', error);
                return false;
            }
        }

        async function sendEmailJSEmail(to, subject, message, attachment = null) {
            try {
                if (!emailjsInitialized) {
                    initializeEmailJS();
                }

                const templateParams = {
                    to_email: to,
                    to_name: to.split('@')[0],
                    subject: subject,
                    message: message,
                    landscape: currentLandscape,
                    period: currentMonth,
                    timestamp: new Date().toLocaleString(),
                    view_name: 'Dashboard Screenshot',
                    screenshot_data: attachment
                };

                const response = await emailjs.send(
                    EMAILJS_CONFIG.SERVICE_ID,
                    EMAILJS_CONFIG.TEMPLATE_ID,
                    templateParams
                );

                console.log('üìß EmailJS email sent successfully:', response);
                return { success: true, messageId: response.text };
            } catch (error) {
                console.error('‚ùå EmailJS send error:', error);
                throw error;
            }
        }

        // ========================================
        // AUTHENTICATION FUNCTIONS
        // ========================================
        function handleAuthStateChange(user) {
            currentUser = user;
            
            if (user) {
                console.log('‚úÖ User authenticated:', user.email);
                showDashboard();
                updateConnectionStatus('connected');
                
                // Show user info
                const userInfo = document.getElementById('userInfo');
                const userEmail = document.getElementById('userEmail');
                userInfo.style.display = 'block';
                userEmail.textContent = user.email;
                
                // Load user data from Firestore
                loadUserDataFromFirestore();
            } else {
                console.log('‚ùå User not authenticated');
                hideDashboard();
                updateConnectionStatus('connecting');
            }
        }

        // Sign up function
        window.signUp = async function() {
            const emailInput = document.getElementById("email").value.trim();
            const passwordInput = document.getElementById("password").value;
            const statusDiv = document.getElementById("auth-status");
            
            if (!emailInput || !passwordInput) {
                showAuthStatus('Please enter both email and password', 'error');
                return;
            }

            if (passwordInput.length < 6) {
                showAuthStatus('Password must be at least 6 characters', 'error');
                return;
            }

            try {
                showAuthStatus('Creating account...', 'loading');
                
                const userCredential = await auth.createUserWithEmailAndPassword(emailInput, passwordInput);
                const user = userCredential.user;
                
                // Send email verification
                await user.sendEmailVerification();
                
                showAuthStatus('Account created! Please check your email for verification.', 'success');
                console.log('‚úÖ User signed up:', user.email);
                
                // Create user document in Firestore
                await createUserDocument(user);
                
            } catch (error) {
                console.error('‚ùå Sign up error:', error);
                showAuthStatus(getAuthErrorMessage(error.code), 'error');
            }
        }

        // Sign in function
        window.signIn = async function() {
            const emailInput = document.getElementById("email").value.trim();
            const passwordInput = document.getElementById("password").value;
            
            if (!emailInput || !passwordInput) {
                showAuthStatus('Please enter both email and password', 'error');
                return;
            }

            try {
                showAuthStatus('Signing in...', 'loading');
                
                const userCredential = await auth.signInWithEmailAndPassword(emailInput, passwordInput);
                const user = userCredential.user;
                
                if (!user.emailVerified) {
                    showAuthStatus('Please verify your email address before signing in', 'error');
                    await auth.signOut();
                    return;
                }
                
                showAuthStatus('Signed in successfully!', 'success');
                console.log('‚úÖ User signed in:', user.email);
                
            } catch (error) {
                console.error('‚ùå Sign in error:', error);
                showAuthStatus(getAuthErrorMessage(error.code), 'error');
            }
        }

        // Google Sign In
        window.signInWithGoogle = async function() {
            try {
                showAuthStatus('Signing in with Google...', 'loading');
                
                const provider = new firebase.auth.GoogleAuthProvider();
                provider.addScope('profile');
                provider.addScope('email');
                
                const result = await auth.signInWithPopup(provider);
                const user = result.user;
                
                showAuthStatus('Signed in with Google successfully!', 'success');
                console.log('‚úÖ Google sign in successful:', user.email);
                
                // Create user document if new user
                await createUserDocument(user);
                
            } catch (error) {
                console.error('‚ùå Google sign in error:', error);
                showAuthStatus('Google sign in failed', 'error');
            }
        }

        // Sign out function
        window.signOut = async function() {
            try {
                await auth.signOut();
                console.log('‚úÖ User signed out');
                
                // Also sign out from Gmail API if signed in
                if (gmailAuthorized && gapi.auth2) {
                    const authInstance = gapi.auth2.getAuthInstance();
                    if (authInstance.isSignedIn.get()) {
                        await authInstance.signOut();
                        gmailAuthorized = false;
                    }
                }
                
            } catch (error) {
                console.error('‚ùå Sign out error:', error);
            }
        }

        // ========================================
        // FIRESTORE FUNCTIONS
        // ========================================
        async function createUserDocument(user) {
            try {
                const userDoc = {
                    uid: user.uid,
                    email: user.email,
                    displayName: user.displayName || user.email.split('@')[0],
                    photoURL: user.photoURL || null,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    lastLoginAt: firebase.firestore.FieldValue.serverTimestamp(),
                    skillsData: skillsData,
                    operationalData: {},
                    preferences: {
                        landscape: currentLandscape,
                        emailNotifications: true
                    }
                };

                await db.collection('users').doc(user.uid).set(userDoc, { merge: true });
                console.log('‚úÖ User document created/updated');
            } catch (error) {
                console.error('‚ùå Error creating user document:', error);
            }
        }

        async function loadUserDataFromFirestore() {
            if (!currentUser) return;

            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    
                    // Load user's skills and data
                    skillsData = userData.skillsData || skillsData;
                    operationalData = userData.operationalData || {};
                    
                    if (userData.preferences) {
                        currentLandscape = userData.preferences.landscape || currentLandscape;
                        document.getElementById('landscapeSelect').value = currentLandscape;
                    }
                    
                    console.log('‚úÖ User data loaded from Firestore');
                    
                    // Refresh dashboard with loaded data
                    initializeDashboard();
                } else {
                    // Create document for new user
                    await createUserDocument(currentUser);
                }
            } catch (error) {
                console.error('‚ùå Error loading user data:', error);
            }
        }

        async function saveUserDataToFirestore() {
            if (!currentUser) return;

            try {
                const updateData = {
                    skillsData: skillsData,
                    operationalData: operationalData,
                    preferences: {
                        landscape: currentLandscape,
                        emailNotifications: true
                    },
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                };

                await db.collection('users').doc(currentUser.uid).update(updateData);
                console.log('‚úÖ User data saved to Firestore');
            } catch (error) {
                console.error('‚ùå Error saving user data:', error);
            }
        }

        // ========================================
        // UTILITY FUNCTIONS
        // ========================================
        function showAuthStatus(message, type) {
            const statusDiv = document.getElementById('auth-status');
            statusDiv.textContent = message;
            statusDiv.className = `auth-status ${type}`;
            statusDiv.style.display = 'block';
        }

        function getAuthErrorMessage(errorCode) {
            const errorMessages = {
                'auth/user-not-found': 'No account found with this email address',
                'auth/wrong-password': 'Incorrect password',
                'auth/email-already-in-use': 'An account with this email already exists',
                'auth/weak-password': 'Password should be at least 6 characters',
                'auth/invalid-email': 'Invalid email address',
                'auth/too-many-requests': 'Too many failed attempts. Please try again later'
            };
            
            return errorMessages[errorCode] || 'Authentication error occurred';
        }

        function showDashboard() {
            const dashboard = document.querySelector('.main-container');
            const authSection = document.getElementById('auth-section');
            const signOutBtn = document.getElementById('signOutBtn');
            
            dashboard.style.display = "block";
            authSection.style.display = "none";
            signOutBtn.style.display = "block";
        }

        function hideDashboard() {
            const dashboard = document.querySelector('.main-container');
            const authSection = document.getElementById('auth-section');
            const signOutBtn = document.getElementById('signOutBtn');
            const userInfo = document.getElementById('userInfo');
            
            dashboard.style.display = "none";
            authSection.style.display = "flex";
            signOutBtn.style.display = "none";
            userInfo.style.display = "none";
            
            // Clear form
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
            document.getElementById('auth-status').innerHTML = '';
        }
        
        function updateConnectionStatus(status) {
            const statusEl = document.getElementById('connectionStatus');
            if (!statusEl) return;
            
            statusEl.className = `connection-status ${status}`;
            
            switch(status) {
                case 'connected':
                    statusEl.textContent = 'üî• Firebase Connected';
                    break;
                case 'connecting':
                    statusEl.textContent = 'üîÑ Connecting...';
                    break;
                case 'offline':
                    statusEl.textContent = '‚ö†Ô∏è Offline Mode';
                    break;
            }
        }

        function updateApiStatus(status, message) {
            const statusEl = document.getElementById('apiStatus');
            if (!statusEl) return;
            
            statusEl.className = `api-status ${status}`;
            statusEl.textContent = message;
        }

        // ========================================
        // EMAIL FUNCTIONS
        // ========================================
        function openEmailModal() {
            document.getElementById('emailModal').style.display = 'flex';
            document.getElementById('emailStatus').style.display = 'none';
            
            // Set default subject
            const landscape = document.getElementById('landscapeSelect').value;
            const month = document.getElementById('monthSelect').value;
            document.getElementById('emailSubject').value = `HBoard Operations Report - ${landscape} (${month})`;
        }

        function closeEmailModal() {
            document.getElementById('emailModal').style.display = 'none';
            document.getElementById('emailStatus').style.display = 'none';
            
            // Reset form
            const recipientSelect = document.getElementById('emailRecipients');
            for (let i = 0; i < recipientSelect.options.length; i++) {
                recipientSelect.options[i].selected = false;
            }
            document.getElementById('customEmail').value = '';
            document.getElementById('emailMessage').value = '';
        }

        async function sendScreenshotEmail() {
            const recipientSelect = document.getElementById('emailRecipients');
            const customEmail = document.getElementById('customEmail').value.trim();
            const screenshotType = document.getElementById('screenshotType').value;
            const subject = document.getElementById('emailSubject').value.trim();
            const message = document.getElementById('emailMessage').value.trim();
            const emailMethod = document.getElementById('emailMethod').value;

            // Get selected recipients
            let recipients = [];
            for (let option of recipientSelect.selectedOptions) {
                recipients.push(option.value);
            }
            
            if (customEmail) {
                if (isValidEmail(customEmail)) {
                    recipients.push(customEmail);
                } else {
                    showEmailStatus('‚ùå Please enter a valid email address', 'error');
                    return;
                }
            }

            // Validation
            if (recipients.length === 0) {
                showEmailStatus('‚ùå Please select at least one recipient or enter a custom email', 'error');
                return;
            }

            if (!subject) {
                showEmailStatus('‚ùå Please enter an email subject', 'error');
                return;
            }

            try {
                showEmailStatus('üì∏ Capturing screenshot...', 'loading');

                // Determine what to capture
                let targetElement, viewName;
                switch (screenshotType) {
                    case 'complete':
                        targetElement = document.querySelector('.dashboard-container');
                        viewName = 'Complete Dashboard View';
                        break;
                    case 'kpi-dashboard':
                        targetElement = document.querySelector('.kpi-dashboard');
                        viewName = 'KPI Dashboard Section';
                        break;
                    case 'weekly-kpis':
                        targetElement = document.getElementById('weeklyKPIs');
                        viewName = 'Weekly KPIs Overview';
                        break;
                    case 'skills-table':
                        targetElement = document.getElementById('monthlyTable');
                        viewName = 'Skills Performance Table';
                        break;
                    case 'skill-management':
                        targetElement = document.querySelector('.skill-management');
                        viewName = 'Skill Management Section';
                        break;
                    default:
                        targetElement = document.querySelector('.dashboard-container');
                        viewName = 'Dashboard View';
                }

                if (!targetElement || targetElement.offsetWidth === 0) {
                    showEmailStatus('‚ùå Selected view is not visible or available', 'error');
                    return;
                }

                // Capture screenshot with better options
                const canvas = await html2canvas(targetElement, {
                    useCORS: true,
                    allowTaint: false,
                    scale: 1.5,
                    backgroundColor: '#ffffff',
                    logging: false,
                    width: targetElement.scrollWidth,
                    height: targetElement.scrollHeight
                });

                const imageData = canvas.toDataURL('image/png', 0.9);
                
                showEmailStatus('üì§ Sending emails...', 'loading');

                // Prepare email data
                const landscape = document.getElementById('landscapeSelect').value;
                const period = document.getElementById('monthSelect').value;
                const timestamp = new Date().toLocaleString();

                const emailBody = message || `Please find attached the ${viewName} screenshot from our HBoard Operations Dashboard.

Landscape: ${landscape}
Period: ${period}
Generated: ${timestamp}
User: ${currentUser?.email || 'Anonymous'}

This automated report provides key insights into our operational performance and system availability.

Best regards,
HBoard Operations Team`;

                let successCount = 0;
                let errors = [];
                
                // Send emails to all recipients
                for (let email of recipients) {
                    try {
                        let emailSent = false;

                        // Try sending based on selected method
                        if (emailMethod === 'gmail' || emailMethod === 'auto') {
                            try {
                                await sendGmailEmail(email, subject, emailBody.replace(/\n/g, '<br>'), imageData);
                                emailSent = true;
                                console.log(`üì® Gmail email sent successfully to: ${email}`);
                            } catch (gmailError) {
                                console.warn(`üì® Gmail failed for ${email}, trying EmailJS...`);
                                if (emailMethod === 'gmail') {
                                    throw gmailError; // Don't fallback if Gmail specifically requested
                                }
                            }
                        }

                        // Try EmailJS if Gmail failed or if EmailJS was requested
                        if (!emailSent && (emailMethod === 'emailjs' || emailMethod === 'auto')) {
                            await sendEmailJSEmail(email, subject, emailBody, imageData);
                            emailSent = true;
                            console.log(`üìß EmailJS email sent successfully to: ${email}`);
                        }

                        if (emailSent) {
                            successCount++;
                        } else {
                            errors.push(`${email}: No email method available`);
                        }
                        
                        // Add delay between emails to avoid rate limiting
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        
                    } catch (error) {
                        console.error(`Failed to send to ${email}:`, error);
                        errors.push(`${email}: ${error.message || 'Unknown error'}`);
                    }
                }

                if (successCount > 0) {
                    showEmailStatus(`‚úÖ Screenshot sent successfully to ${successCount} recipient(s)!${errors.length > 0 ? ` (${errors.length} failed)` : ''}`, 'success');
                    
                    // Log the action to Firestore
                    if (currentUser) {
                        logActionToFirestore('Email Screenshot', `Sent ${viewName} to ${successCount} recipients via ${emailMethod}`);
                    }
                    
                    // Auto-close after 3 seconds
                    setTimeout(closeEmailModal, 3000);
                } else {
                    showEmailStatus(`‚ùå Failed to send emails. ${errors.length > 0 ? 'Errors: ' + errors.join(', ') : 'Please check your email API configuration.'}`, 'error');
                }

            } catch (error) {
                console.error('Screenshot email error:', error);
                showEmailStatus('‚ùå Failed to capture screenshot: ' + error.message, 'error');
            }
        }

        function showEmailStatus(message, type) {
            const statusDiv = document.getElementById('emailStatus');
            statusDiv.textContent = message;
            statusDiv.className = `email-status ${type}`;
            statusDiv.style.display = 'block';
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // ========================================
        // DASHBOARD FUNCTIONS
        // ========================================
        function initializeDashboard() {
            console.log('üöÄ Initializing HBoard Operations Dashboard...');
            
            // Set current date values
            document.getElementById('monthSelect').value = currentMonth;
            document.getElementById('landscapeSelect').value = currentLandscape;
            
            // Update current month display
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            const [year, month] = currentMonth.split('-');
            document.getElementById('currentMonthDisplay').textContent = `${monthNames[parseInt(month) - 1]} ${year}`;
            
            // Add event listeners
            document.getElementById('landscapeSelect').addEventListener('change', handleLandscapeChange);
            document.getElementById('monthSelect').addEventListener('change', refreshData);
            
            // Load initial data
            refreshData();
            updateSkillsList();
            updateStatistics();
            
            console.log('‚úÖ Dashboard initialized successfully');
        }

        function switchView(viewType) {
            currentView = viewType;
            
            // Update toggle buttons
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            refreshData();
        }

        async function handleLandscapeChange() {
            currentLandscape = document.getElementById('landscapeSelect').value;
            
            // Save preference to Firestore
            if (currentUser) {
                await saveUserDataToFirestore();
            }
            
            refreshData();
        }

        function refreshData() {
            currentLandscape = document.getElementById('landscapeSelect').value;
            currentMonth = document.getElementById('monthSelect').value;
            
            generateMonthlyView();
            updateStatistics();
            
            // Update month display
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            const [year, month] = currentMonth.split('-');
            document.getElementById('currentMonthDisplay').textContent = `${monthNames[parseInt(month) - 1]} ${year}`;
        }

        function generateMonthlyView() {
            const weeks = getWeeksInMonth(currentMonth);
            generateKPICards(weeks);
            generateMonthlyHeaders(weeks);
            generateMonthlyTableBody(weeks);
        }

        function getWeeksInMonth(monthYear) {
            const [year, month] = monthYear.split('-').map(Number);
            const firstDay = new Date(year, month - 1, 1);
            const lastDay = new Date(year, month, 0);
            
            const weeks = [];
            let currentWeek = 1;
            let currentDate = new Date(firstDay);
            
            while (currentDate <= lastDay) {
                const weekStart = new Date(currentDate);
                const weekEnd = new Date(Math.min(currentDate.getTime() + 6 * 24 * 60 * 60 * 1000, lastDay.getTime()));
                
                weeks.push({
                    number: currentWeek,
                    label: `WK ${currentWeek}`,
                    start: weekStart.getDate(),
                    end: weekEnd.getDate(),
                    dates: getWeekDates(weekStart, weekEnd)
                });
                
                currentDate.setTime(weekEnd.getTime() + 24 * 60 * 60 * 1000);
                currentWeek++;
            }
            
            return weeks;
        }

        function getWeekDates(start, end) {
            const dates = [];
            const currentDate = new Date(start);
            
            while (currentDate <= end) {
                dates.push(new Date(currentDate));
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            return dates;
        }

        function generateKPICards(weeks) {
            const kpiGrid = document.getElementById('kpiGrid');
            let kpiHTML = '';
            
            weeks.forEach((week, index) => {
                // Sample data - replace with actual operational data
                const percentage = index === 0 ? 100 : 0;
                const colorClass = percentage >= 95 ? 'green' : percentage >= 45 ? 'amber' : 'red';
                
                kpiHTML += `
                    <div class="kpi-card">
                        <div class="kpi-value ${colorClass}">${percentage}%</div>
                        <div class="kpi-label">${week.label} Availability</div>
                    </div>
                `;
            });
            
            kpiGrid.innerHTML = kpiHTML;
        }

        function generateMonthlyHeaders(weeks) {
            const headersContainer = document.getElementById('monthlyHeaders');
            let headerHTML = '<tr><th class="skill-header">Skills / Operational Areas</th>';
            
            weeks.forEach(week => {
                headerHTML += `<th>${week.label}<br><small>${week.start}-${week.end}</small></th>`;
            });
            
            headerHTML += '</tr>';
            headersContainer.innerHTML = headerHTML;
        }

        function generateMonthlyTableBody(weeks) {
            const bodyContainer = document.getElementById('monthlyBody');
            let bodyHTML = '';
            
            skillsData.forEach((skill, skillIndex) => {
                bodyHTML += `<tr><td class="skill-name" title="${skill}">${skill}</td>`;
                
                weeks.forEach((week, weekIndex) => {
                    // Sample data - replace with actual operational data
                    const percentage = (skillIndex === 0 && weekIndex === 0) ? 100 : 0;
                    const statusClass = percentage >= 95 ? 'green' : percentage >= 45 ? 'amber' : percentage > 0 ? 'red' : 'empty';
                    const filledDays = percentage >= 95 ? 7 : percentage >= 45 ? Math.floor(percentage / 100 * 7) : 0;
                    
                    bodyHTML += `
                        <td class="status-cell" onclick="editCell('${skill}', '${week.label}')">
                            <div class="status-dot ${statusClass}">
                                ${percentage > 0 ? percentage + '%' : '--'}
                            </div>
                            <div class="status-indicators">
                                ${generateStatusIndicators(7, filledDays)}
                            </div>
                        </td>
                    `;
                });
                
                bodyHTML += '</tr>';
            });
            
            bodyContainer.innerHTML = bodyHTML;
        }

        function generateStatusIndicators(total, filled) {
            let indicators = '';
            for (let i = 0; i < total; i++) {
                const className = i < filled ? 'status-indicator filled' : 'status-indicator';
                indicators += `<div class="${className}"></div>`;
            }
            return indicators;
        }

        function updateStatistics() {
            // Calculate statistics from current data
            let totalEntries = skillsData.length * 5; // 5 weeks of data per skill
            let optimalCount = 1; // One entry at 100%
            let attentionCount = 0;
            let criticalCount = totalEntries - optimalCount - attentionCount;

            // Update performance metrics
            const monthlyPerf = Math.round((optimalCount / totalEntries) * 100) || 0;
            const yearlyPerf = Math.round(monthlyPerf * 0.8) || 0;

            document.getElementById('monthlyPerformance').textContent = monthlyPerf + '%';
            document.getElementById('yearlyPerformance').textContent = yearlyPerf + '%';

            // Update trend indicators
            document.getElementById('monthlyTrend').textContent = monthlyPerf > 50 ? 'üìà Improving' : 'üìâ Needs Attention';
            document.getElementById('yearlyTrend').textContent = yearlyPerf > 50 ? 'üìà Stable Growth' : 'üìâ Focus Required';

            // Store updated statistics
            statisticsData = {
                totalEntries,
                optimalCount,
                attentionCount,
                criticalCount,
                monthlyPerformance: monthlyPerf,
                yearlyPerformance: yearlyPerf
            };
        }

        // ========================================
        // SKILL MANAGEMENT FUNCTIONS
        // ========================================
        function updateSkillsList() {
            const skillsList = document.getElementById('skillsList');
            let skillsHTML = '';

            skillsData.forEach((skill, index) => {
                skillsHTML += `
                    <div class="skill-item">
                        <div class="skill-item-name">${skill}</div>
                        <div class="skill-item-actions">
                            <button class="skill-action-btn edit" onclick="editSkill(${index})">‚úèÔ∏è Edit</button>
                            <button class="skill-action-btn delete" onclick="deleteSkill(${index})">üóëÔ∏è Delete</button>
                        </div>
                    </div>
                `;
            });

            skillsList.innerHTML = skillsHTML || '<p style="color: var(--medium-gray);">No skills added yet.</p>';
        }

        async function addSkillFromInput() {
            const skillInput = document.getElementById('newSkillInput');
            const skillName = skillInput.value.trim();

            if (!skillName) {
                alert('Please enter a skill name');
                return;
            }

            if (skillsData.includes(skillName)) {
                alert('This skill already exists');
                return;
            }

            skillsData.push(skillName);
            skillInput.value = '';
            updateSkillsList();
            refreshData();
            
            // Save to Firestore
            if (currentUser) {
                await saveUserDataToFirestore();
                await logActionToFirestore('Add Skill', `Added new skill: ${skillName}`);
            }

            console.log('‚úÖ Skill added:', skillName);
        }

        async function editSkill(index) {
            const currentName = skillsData[index];
            const newName = prompt('Enter new skill name:', currentName);

            if (newName && newName.trim() && newName !== currentName) {
                const trimmedName = newName.trim();
                
                if (skillsData.includes(trimmedName)) {
                    alert('This skill name already exists');
                    return;
                }

                skillsData[index] = trimmedName;
                updateSkillsList();
                refreshData();
                
                // Save to Firestore
                if (currentUser) {
                    await saveUserDataToFirestore();
                    await logActionToFirestore('Edit Skill', `Changed "${currentName}" to "${trimmedName}"`);
                }

                console.log('‚úÖ Skill edited:', trimmedName);
            }
        }

        async function deleteSkill(index) {
            const skillName = skillsData[index];
            
            if (confirm(`Are you sure you want to delete "${skillName}"?\n\nThis will remove all associated data.`)) {
                skillsData.splice(index, 1);
                updateSkillsList();
                refreshData();
                
                // Save to Firestore
                if (currentUser) {
                    await saveUserDataToFirestore();
                    await logActionToFirestore('Delete Skill', `Deleted skill: ${skillName}`);
                }

                console.log('üóëÔ∏è Skill deleted:', skillName);
            }
        }

        // ========================================
        // ADDITIONAL UTILITY FUNCTIONS
        // ========================================
        function editCell(skill, week) {
            console.log(`Editing: ${skill} - ${week}`);
            const newValue = prompt(`Edit ${skill} for ${week}:\n\nEnter percentage (0-100):`);
            
            if (newValue !== null && !isNaN(newValue) && newValue >= 0 && newValue <= 100) {
                console.log(`Updated ${skill} ${week} to ${newValue}%`);
                
                // In real implementation, save to operationalData and Firestore
                if (currentUser) {
                    logActionToFirestore('Edit Cell', `Updated ${skill} ${week} to ${newValue}%`);
                }
            }
        }

        function addNewSkill() {
            const skillName = prompt('Enter new skill/operational area name:');
            
            if (skillName && skillName.trim()) {
                const trimmedName = skillName.trim();
                
                if (!skillsData.includes(trimmedName)) {
                    skillsData.push(trimmedName);
                    updateSkillsList();
                    refreshData();
                    
                    // Save to Firestore
                    if (currentUser) {
                        saveUserDataToFirestore();
                        logActionToFirestore('Add Skill', `Added new skill: ${trimmedName}`);
                    }
                    
                    console.log('‚úÖ Skill added:', trimmedName);
                } else {
                    alert('This skill already exists');
                }
            }
        }

        function exportToExcel() {
            const data = {
                landscape: currentLandscape,
                month: currentMonth,
                skills: skillsData,
                statistics: statisticsData,
                user: currentUser?.email || 'Anonymous',
                timestamp: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `hboard-export-${currentLandscape}-${currentMonth}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            if (currentUser) {
                logActionToFirestore('Export Data', `Exported data for ${currentLandscape} - ${currentMonth}`);
            }
            
            alert('‚úÖ Data exported successfully!');
        }

        async function testEmailApis() {
            showEmailStatus('üß™ Testing email APIs...', 'loading');
            
            try {
                // Test Gmail API
                let gmailWorking = false;
                try {
                    if (gmailInitialized) {
                        await authorizeGmailAPI();
                        gmailWorking = true;
                        console.log('‚úÖ Gmail API test passed');
                    }
                } catch (error) {
                    console.warn('‚ö†Ô∏è Gmail API test failed:', error);
                }
                
                // Test EmailJS
                let emailjsWorking = false;
                try {
                    if (emailjsInitialized) {
                        emailjsWorking = true;
                        console.log('‚úÖ EmailJS test passed');
                    }
                } catch (error) {
                    console.warn('‚ö†Ô∏è EmailJS test failed:', error);
                }
                
                const results = [];
                if (gmailWorking) results.push('Gmail API ‚úÖ');
                if (emailjsWorking) results.push('EmailJS ‚úÖ');
                
                if (results.length > 0) {
                    showEmailStatus(`‚úÖ Email APIs working: ${results.join(', ')}`, 'success');
                } else {
                    showEmailStatus('‚ùå No email APIs are working properly', 'error');
                }
                
                setTimeout(() => {
                    document.getElementById('emailStatus').style.display = 'none';
                }, 3000);
                
            } catch (error) {
                showEmailStatus('‚ùå Email API test failed', 'error');
            }
        }

        async function syncData() {
            if (!currentUser) {
                alert('Please sign in to sync data');
                return;
            }
            
            try {
                await saveUserDataToFirestore();
                
                const syncMessage = document.createElement('div');
                syncMessage.innerHTML = 'üîÑ Syncing with Firebase...';
                syncMessage.style.cssText = `
                    position: fixed;
                    top: 80px;
                    right: 20px;
                    background: var(--primary-green);
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    font-weight: 600;
                    z-index: 1001;
                    box-shadow: var(--shadow-medium);
                    animation: slideInRight 0.3s ease-out;
                `;
                
                document.body.appendChild(syncMessage);
                
                setTimeout(() => {
                    syncMessage.innerHTML = '‚úÖ Firebase sync complete!';
                    setTimeout(() => {
                        if (document.body.contains(syncMessage)) {
                            document.body.removeChild(syncMessage);
                        }
                    }, 2000);
                }, 1500);
                
                await logActionToFirestore('Sync Data', 'Manual data synchronization completed');
                
            } catch (error) {
                console.error('‚ùå Sync error:', error);
                alert('‚ùå Sync failed: ' + error.message);
            }
        }

        async function logActionToFirestore(action, details) {
            if (!currentUser || !db) return;
            
            try {
                await db.collection('activity_logs').add({
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    action: action,
                    details: details,
                    landscape: currentLandscape,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    month: currentMonth
                });
            } catch (error) {
                console.error('‚ùå Error logging action:', error);
            }
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('email-modal')) {
                closeEmailModal();
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeEmailModal();
            }
        });

        // Add dynamic CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from {
                    opacity: 0;
                    transform: translateX(100px);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }
        `;
        document.head.appendChild(style);

        // Console welcome message
        console.log(`
üîπ HBoard - Advanced Operations Excellence Dashboard v2024.09.08 üîπ
‚úÖ Firebase Authentication: Fully integrated with email/password + Google Sign-In
üì® Gmail API: Primary email sending with OAuth2 authentication
üìß EmailJS: Backup email service for reliability
üî• Firestore: Real-time data synchronization across team members
üìä Dynamic KPIs: Monthly/Yearly performance tracking with live updates
üéØ Skills Management: Full CRUD operations synced to cloud
üé® Responsive Design: Optimized for all devices and screen sizes
üöÄ Production Ready: Enterprise-grade security and scalability
        `);
    </script>
</body>
</html>
