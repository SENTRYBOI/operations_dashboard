<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>🔹 HBoard - Operations Excellence Dashboard v2024 🔹</title>
    
    <!-- External CDN Libraries for Email Screenshot -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3.2.0/dist/email.min.js"></script>
    
    <style>
        /* Global Styles and Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-green: #28a745;
            --secondary-teal: #20c997;
            --accent-blue: #17a2b8;
            --warning-amber: #ffc107;
            --danger-red: #dc3545;
            --light-gray: #f8f9fa;
            --medium-gray: #6c757d;
            --dark-gray: #343a40;
            --border-color: #dee2e6;
            --shadow-light: 0 2px 10px rgba(0,0,0,0.1);
            --shadow-medium: 0 4px 20px rgba(0,0,0,0.15);
            --shadow-heavy: 0 8px 30px rgba(0,0,0,0.2);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--dark-gray);
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
            font-size: 14px;
            padding: 10px;
        }
        
        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-heavy);
            overflow: hidden;
            border: 2px solid var(--primary-green);
        }
        
        /* Header Styles */
        .header {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--secondary-teal) 100%);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .header .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 400;
        }
        
        .version-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }
        
        /* Content Area */
        .content {
            padding: 25px;
            background: var(--light-gray);
        }
        
        /* Control Panel */
        .control-panel {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow-light);
            border: 2px solid var(--primary-green);
        }
        
        .control-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 180px;
        }
        
        .control-group label {
            font-weight: 700;
            color: var(--primary-green);
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Form Elements */
        select, input[type="month"], input[type="date"], input[type="text"], input[type="number"], input[type="email"] {
            padding: 12px 16px;
            border: 2px solid var(--primary-green);
            border-radius: 8px;
            font-size: 14px;
            background: white;
            color: var(--dark-gray);
            transition: var(--transition);
            font-family: inherit;
        }
        
        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: var(--secondary-teal);
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
            transform: translateY(-1px);
        }
        
        textarea {
            padding: 12px 16px;
            border: 2px solid var(--primary-green);
            border-radius: 8px;
            font-size: 14px;
            background: white;
            color: var(--dark-gray);
            resize: vertical;
            font-family: inherit;
            min-height: 80px;
        }
        
        /* View Toggle */
        .view-toggle {
            display: flex;
            background: var(--border-color);
            border-radius: 25px;
            padding: 4px;
            border: 2px solid var(--primary-green);
        }
        
        .toggle-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 20px;
            background: transparent;
            color: var(--medium-gray);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .toggle-btn.active {
            background: var(--primary-green);
            color: white;
            box-shadow: var(--shadow-light);
        }
        
        .toggle-btn:hover:not(.active) {
            background: rgba(40, 167, 69, 0.1);
            color: var(--primary-green);
        }
        
        /* Buttons */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border: 2px solid transparent;
        }
        
        .btn-primary {
            background: var(--primary-green);
            color: white;
            border-color: var(--primary-green);
        }
        
        .btn-primary:hover {
            background: var(--secondary-teal);
            border-color: var(--secondary-teal);
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        .btn-success {
            background: var(--secondary-teal);
            color: white;
            border-color: var(--secondary-teal);
        }
        
        .btn-success:hover {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        .btn-warning {
            background: var(--warning-amber);
            color: var(--dark-gray);
            border-color: var(--warning-amber);
        }
        
        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        .btn-danger {
            background: var(--danger-red);
            color: white;
            border-color: var(--danger-red);
        }
        
        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        .btn-email {
            background: var(--accent-blue);
            color: white;
            border-color: var(--accent-blue);
        }
        
        .btn-email:hover {
            background: #138496;
            border-color: #138496;
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        /* Action Buttons Grid */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        /* Dashboard Views */
        .dashboard-container {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-light);
            border: 2px solid var(--primary-green);
        }
        
        /* KPI Section */
        .kpi-section {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            border: 2px solid var(--secondary-teal);
            box-shadow: var(--shadow-light);
        }
        
        .kpi-section h3 {
            color: var(--secondary-teal);
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.4rem;
            font-weight: 700;
        }
        
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
        }
        
        .kpi-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid var(--secondary-teal);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
        }
        
        .kpi-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
            border-color: var(--primary-green);
        }
        
        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--primary-green), var(--secondary-teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .kpi-value.red { color: var(--danger-red); }
        .kpi-value.amber { color: var(--warning-amber); }
        .kpi-value.green { color: var(--primary-green); }
        
        .kpi-label {
            font-size: 0.85rem;
            color: var(--medium-gray);
            font-weight: 600;
            line-height: 1.3;
        }
        
        /* Monthly View Table */
        .monthly-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            background: white;
        }
        
        .monthly-table th {
            background: linear-gradient(135deg, var(--primary-green), var(--secondary-teal));
            color: white;
            padding: 16px 12px;
            text-align: center;
            border: 1px solid var(--secondary-teal);
            font-weight: 700;
            font-size: 13px;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .monthly-table th.skill-header {
            text-align: left;
            padding-left: 20px;
            min-width: 140px; /* Reduced from previous larger width */
            max-width: 160px; /* Added max-width constraint */
            position: sticky;
            left: 0;
            z-index: 11;
        }
        
        .monthly-table td {
            border: 1px solid var(--border-color);
            padding: 12px 8px;
            text-align: center;
            vertical-align: middle;
            transition: var(--transition);
        }
        
        .monthly-table td.skill-name {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            font-weight: 600;
            text-align: left;
            padding-left: 20px;
            border-right: 3px solid var(--primary-green);
            color: var(--primary-green);
            min-width: 140px; /* Reduced width */
            max-width: 160px; /* Added max-width */
            font-size: 12px; /* Reduced font size */
            position: sticky;
            left: 0;
            z-index: 5;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .monthly-table td.skill-name:hover {
            background: rgba(40, 167, 69, 0.1);
        }
        
        .monthly-table tbody tr:hover {
            background: rgba(40, 167, 69, 0.02);
        }
        
        /* Status Cells and Dots */
        .status-cell {
            cursor: pointer;
            position: relative;
            padding: 15px 8px;
        }
        
        .status-cell:hover {
            background: rgba(40, 167, 69, 0.1);
            transform: scale(1.02);
        }
        
        .status-dot {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin: 0 auto 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 11px;
            color: white;
            border: 3px solid transparent;
            box-shadow: var(--shadow-light);
            transition: var(--transition);
        }
        
        .status-dot:hover {
            transform: scale(1.2);
            box-shadow: var(--shadow-medium);
        }
        
        .status-dot.green {
            background: var(--primary-green);
            border-color: #1e7e34;
        }
        
        .status-dot.amber {
            background: var(--warning-amber);
            border-color: #d39e00;
            color: var(--dark-gray);
        }
        
        .status-dot.red {
            background: var(--danger-red);
            border-color: #bd2130;
        }
        
        .status-dot.gray {
            background: var(--medium-gray);
            border-color: #495057;
        }
        
        .status-dot.empty {
            background: var(--light-gray);
            border: 3px dashed var(--medium-gray);
            color: var(--medium-gray);
        }
        
        /* Status Indicators */
        .status-indicators {
            display: flex;
            justify-content: center;
            gap: 2px;
            margin-top: 5px;
        }
        
        .status-indicator {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--border-color);
            transition: var(--transition);
        }
        
        .status-indicator.filled {
            background: var(--primary-green);
        }
        
        .status-indicator.partial {
            background: var(--warning-amber);
        }
        
        /* Daily View Styles */
        .daily-container {
            padding: 25px;
        }
        
        .daily-stats {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            border: 2px solid var(--primary-green);
            box-shadow: var(--shadow-light);
        }
        
        .daily-stats h3 {
            color: var(--primary-green);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .daily-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }
        
        .daily-stat-card {
            text-align: center;
        }
        
        .daily-stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-green);
            margin-bottom: 5px;
        }
        
        .daily-stat-label {
            font-size: 0.9rem;
            color: var(--medium-gray);
            font-weight: 600;
        }
        
        .daily-grid {
            display: grid;
            grid-template-columns: 120px repeat(7, 1fr); /* Reduced first column width */
            gap: 2px;
            background: var(--border-color);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-light);
        }
        
        .daily-header {
            background: linear-gradient(135deg, var(--primary-green), var(--secondary-teal));
            color: white;
            padding: 15px 8px;
            text-align: center;
            font-weight: 700;
            font-size: 12px;
        }
        
        .daily-skill {
            background: var(--secondary-teal);
            color: white;
            padding: 15px 8px;
            font-weight: 600;
            display: flex;
            align-items: center;
            font-size: 11px; /* Reduced font size */
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .daily-cell {
            background: white;
            padding: 12px 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 70px;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }
        
        .daily-cell:hover {
            background: rgba(40, 167, 69, 0.1);
            border-color: var(--primary-green);
            transform: scale(1.02);
        }
        
        /* Email Modal Styles */
        .email-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .email-modal-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-heavy);
            border: 3px solid var(--accent-blue);
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .email-modal h3 {
            color: var(--accent-blue);
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 25px;
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--accent-blue);
        }
        
        .email-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .email-form label {
            font-weight: 700;
            color: var(--accent-blue);
            margin-bottom: 5px;
            display: block;
        }
        
        .email-form select[multiple] {
            min-height: 120px;
        }
        
        .email-form small {
            color: var(--medium-gray);
            font-size: 11px;
            margin-top: 5px;
            display: block;
        }
        
        .email-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            color: var(--danger-red);
            cursor: pointer;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .email-close:hover {
            background: var(--danger-red);
            color: white;
            transform: scale(1.1);
        }
        
        .email-status {
            padding: 15px;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            margin-top: 15px;
            display: none;
        }
        
        .email-status.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        
        .email-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        
        .email-status.loading {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffeaa7;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            box-shadow: var(--shadow-heavy);
            border: 3px solid var(--primary-green);
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            color: var(--danger-red);
            cursor: pointer;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .modal-close:hover {
            background: var(--danger-red);
            color: white;
            transform: scale(1.1);
        }
        
        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-container {
                margin: 0 10px;
            }
            
            .action-buttons {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .content {
                padding: 15px;
            }
            
            .control-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .control-group {
                min-width: auto;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .kpi-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
            
            .daily-stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
            
            .daily-grid {
                grid-template-columns: 100px repeat(7, 1fr);
                font-size: 12px;
            }
            
            .daily-skill {
                font-size: 10px;
            }
            
            .monthly-table th.skill-header,
            .monthly-table td.skill-name {
                min-width: 110px;
                max-width: 130px;
                font-size: 11px;
            }
            
            .monthly-table {
                font-size: 12px;
            }
            
            .email-modal-content {
                padding: 25px;
                margin: 20px;
            }
        }
        
        /* Print Styles */
        @media print {
            .action-buttons, .version-badge, .email-modal {
                display: none !important;
            }
            
            .main-container {
                box-shadow: none;
                border: 1px solid #ccc;
            }
            
            .header {
                background: #28a745 !important;
                -webkit-print-color-adjust: exact;
            }
        }
        
        /* Utility Classes */
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        .font-bold { font-weight: 700; }
        .font-medium { font-weight: 600; }
        .text-green { color: var(--primary-green); }
        .text-teal { color: var(--secondary-teal); }
        .text-red { color: var(--danger-red); }
        .text-amber { color: var(--warning-amber); }
        .text-gray { color: var(--medium-gray); }
        .mb-10 { margin-bottom: 10px; }
        .mb-15 { margin-bottom: 15px; }
        .mb-20 { margin-bottom: 20px; }
        .mt-10 { margin-top: 10px; }
        .mt-15 { margin-top: 15px; }
        .mt-20 { margin-top: 20px; }
        .hidden { display: none; }
        .visible { display: block; }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Header Section -->
        <header class="header">
            <div class="version-badge">v2024.09</div>
            <h1>📊 HBoard - Operations Excellence Dashboard</h1>
            <p class="subtitle">Advanced KPI Analytics with Dynamic Downtime Calculations & Real-time Team Collaboration</p>
        </header>

        <!-- Main Content -->
        <main class="content">
            <!-- Control Panel -->
            <section class="control-panel">
                <div class="control-row">
                    <div class="control-group">
                        <label for="landscapeSelect">🌍 Landscape</label>
                        <select id="landscapeSelect">
                            <option value="Europe">Europe</option>
                            <option value="NAM">NAM</option>
                            <option value="IA">IA</option>
                            <option value="SEA">SEA</option>
                            <option value="Global">Global</option>
                        </select>
                    </div>

                    <div class="control-group" id="monthControl">
                        <label for="monthSelect">📅 Month/Year</label>
                        <input type="month" id="monthSelect">
                    </div>

                    <div class="control-group hidden" id="dateControl">
                        <label for="dateSelect">📅 Specific Date</label>
                        <input type="date" id="dateSelect">
                    </div>

                    <div class="control-group">
                        <label>📊 View Mode</label>
                        <div class="view-toggle">
                            <button class="toggle-btn active" onclick="switchView('monthly')">📊 Monthly</button>
                            <button class="toggle-btn" onclick="switchView('daily')">📅 Daily</button>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="refreshData()">
                        🔄 Refresh Data
                    </button>
                    <button class="btn btn-email" onclick="openEmailModal()">
                        📤 Email Screenshot
                    </button>
                    <button class="btn btn-success" onclick="addNewSkill()">
                        ➕ Add Skill
                    </button>
                    <button class="btn btn-primary" onclick="exportToExcel()">
                        📊 Export Excel
                    </button>
                    <button class="btn btn-warning" onclick="importData()">
                        📤 Import Data
                    </button>
                    <button class="btn btn-primary" onclick="viewHistory()">
                        📋 View History
                    </button>
                    <button class="btn btn-danger" onclick="clearData()">
                        🗑️ Clear Data
                    </button>
                    <button class="btn btn-success" onclick="syncData()">
                        🔄 Sync Now
                    </button>
                </div>
            </section>

            <!-- Dashboard Container -->
            <section class="dashboard-container">
                <!-- Monthly View -->
                <div id="monthlyView">
                    <!-- KPI Section -->
                    <div class="kpi-section" id="weeklyKPIs">
                        <h3>📊 Weekly Skill Availability Overview</h3>
                        <div class="kpi-grid" id="kpiGrid">
                            <!-- KPI cards will be generated by JavaScript -->
                        </div>
                    </div>

                    <!-- Monthly Table -->
                    <div style="overflow-x: auto;">
                        <table class="monthly-table" id="monthlyTable">
                            <thead id="monthlyHeaders">
                                <!-- Headers will be generated by JavaScript -->
                            </thead>
                            <tbody id="monthlyBody">
                                <!-- Table body will be generated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Daily View -->
                <div id="dailyView" class="hidden">
                    <div class="daily-container">
                        <!-- Daily Stats -->
                        <div class="daily-stats">
                            <h3>📊 Daily Performance Statistics</h3>
                            <div class="daily-stats-grid">
                                <div class="daily-stat-card">
                                    <div class="daily-stat-value" id="todayAverage">0%</div>
                                    <div class="daily-stat-label">Today's Average</div>
                                </div>
                                <div class="daily-stat-card">
                                    <div class="daily-stat-value" id="weeklyAverage">0%</div>
                                    <div class="daily-stat-label">Weekly Average</div>
                                </div>
                                <div class="daily-stat-card">
                                    <div class="daily-stat-value" id="trendIndicator">📈</div>
                                    <div class="daily-stat-label">Performance Trend</div>
                                </div>
                                <div class="daily-stat-card">
                                    <div class="daily-stat-value text-teal">🔥</div>
                                    <div class="daily-stat-label">Team Sync Active</div>
                                </div>
                            </div>
                        </div>

                        <!-- Daily Grid -->
                        <div class="daily-grid" id="dailyGrid">
                            <!-- Daily grid will be generated by JavaScript -->
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Email Screenshot Modal -->
    <div class="email-modal" id="emailModal">
        <div class="email-modal-content">
            <button class="email-close" onclick="closeEmailModal()">&times;</button>
            <h3>📤 Send Dashboard Screenshot</h3>
            
            <form class="email-form" onsubmit="return false;">
                <div>
                    <label for="emailRecipients">📧 Select Recipients:</label>
                    <select id="emailRecipients" multiple>
                        <option value="manager@company.com">👔 Manager (manager@company.com)</option>
                        <option value="team.lead@company.com">👥 Team Lead (team.lead@company.com)</option>
                        <option value="operations@company.com">⚙️ Operations Team (operations@company.com)</option>
                        <option value="executives@company.com">🏢 Executive Team (executives@company.com)</option>
                        <option value="qa.team@company.com">🔍 QA Team (qa.team@company.com)</option>
                        <option value="support@company.com">🛟 Support Team (support@company.com)</option>
                    </select>
                    <small>Hold Ctrl (or Cmd on Mac) to select multiple recipients</small>
                </div>

                <div>
                    <label for="customEmail">📝 Or enter custom email:</label>
                    <input type="email" id="customEmail" placeholder="user@company.com">
                </div>

                <div>
                    <label for="screenshotType">📊 Screenshot Content:</label>
                    <select id="screenshotType">
                        <option value="complete">📊 Complete Dashboard (KPIs + Table)</option>
                        <option value="kpi-only">📈 Weekly KPIs Overview Only</option>
                        <option value="table-only">📋 Skills Performance Table Only</option>
                        <option value="daily-view">📅 Daily View (if active)</option>
                    </select>
                </div>

                <div>
                    <label for="emailSubject">📌 Email Subject:</label>
                    <input type="text" id="emailSubject" placeholder="Operations Dashboard Report">
                </div>

                <div>
                    <label for="emailMessage">💬 Message (optional):</label>
                    <textarea id="emailMessage" rows="4" placeholder="Add a custom message to accompany the screenshot..."></textarea>
                </div>

                <button type="button" class="btn btn-email" onclick="sendScreenshotEmail()">
                    📤 Capture & Send Screenshot
                </button>
            </form>

            <div id="emailStatus" class="email-status"></div>
        </div>
    </div>

    <!-- Add Skill Modal -->
    <div class="modal" id="addSkillModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('addSkillModal')">&times;</button>
            <h2 style="color: var(--primary-green); margin-bottom: 20px;">➕ Add New Skill</h2>
            <form onsubmit="return submitNewSkill();">
                <div style="margin-bottom: 20px;">
                    <label for="newSkillName" style="display: block; margin-bottom: 10px; font-weight: bold;">Skill Name:</label>
                    <input type="text" id="newSkillName" placeholder="Enter new skill/operational area..." required>
                </div>
                <div style="display: flex; gap: 15px; justify-content: flex-end;">
                    <button type="button" class="btn btn-danger" onclick="closeModal('addSkillModal')">❌ Cancel</button>
                    <button type="submit" class="btn btn-success">✅ Add Skill</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Import Data Modal -->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('importModal')">&times;</button>
            <h2 style="color: var(--primary-green); margin-bottom: 20px;">📤 Import Data</h2>
            <p style="margin-bottom: 20px; color: var(--medium-gray);">
                Upload a JSON file containing operational data or Excel file with skill performance data.
            </p>
            <div style="margin-bottom: 20px;">
                <input type="file" id="importFile" accept=".json,.xlsx,.csv" style="margin-bottom: 15px;">
                <div style="font-size: 12px; color: var(--medium-gray);">
                    Supported formats: JSON, Excel (.xlsx), CSV
                </div>
            </div>
            <div style="display: flex; gap: 15px; justify-content: flex-end;">
                <button type="button" class="btn btn-danger" onclick="closeModal('importModal')">❌ Cancel</button>
                <button type="button" class="btn btn-success" onclick="processImport()">📤 Import</button>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div class="modal" id="historyModal">
        <div class="modal-content" style="max-width: 800px;">
            <button class="modal-close" onclick="closeModal('historyModal')">&times;</button>
            <h2 style="color: var(--primary-green); margin-bottom: 20px;">📋 Data History & Changes</h2>
            <div id="historyContent" style="max-height: 400px; overflow-y: auto;">
                <!-- History content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Hidden file input for imports -->
    <input type="file" id="hiddenFileInput" style="display: none;" accept=".json,.xlsx,.csv">

    <script>
        // Initialize EmailJS (Replace with your EmailJS credentials)
        (function() {
            // emailjs.init("YOUR_EMAILJS_PUBLIC_KEY"); // Uncomment and add your key
            console.log('📧 EmailJS ready for configuration');
        })();

        // Global Variables
        let currentView = 'monthly';
        let currentLandscape = 'Europe';
        let currentMonth = new Date().toISOString().substring(0, 7);
        let currentDate = new Date().toISOString().split('T')[0];

        // Sample Skills Data
        let skillsData = [
            'Business Clarity',
            'Revenue',
            'BPT Processing', 
            'Stock Aging',
            'Inventory',
            'AMB for Manufacturing',
            'PMI for Manufacturing',
            'BPM Stock Reconciliation'
        ];

        // Operational Data Storage
        let operationalData = JSON.parse(localStorage.getItem('hboard_operational_data')) || {};
        let historyLog = JSON.parse(localStorage.getItem('hboard_history_log')) || [];

        // ========================================
        // EMAIL SCREENSHOT FUNCTIONALITY
        // ========================================

        function openEmailModal() {
            document.getElementById('emailModal').style.display = 'flex';
            document.getElementById('emailStatus').style.display = 'none';
            
            // Set default subject
            const landscape = document.getElementById('landscapeSelect').value;
            const month = document.getElementById('monthSelect').value;
            document.getElementById('emailSubject').value = `Operations Dashboard Report - ${landscape} (${month})`;
        }

        function closeEmailModal() {
            document.getElementById('emailModal').style.display = 'none';
            document.getElementById('emailStatus').style.display = 'none';
            
            // Reset form
            document.getElementById('emailRecipients').selectedIndex = -1;
            document.getElementById('customEmail').value = '';
            document.getElementById('emailMessage').value = '';
        }

        async function sendScreenshotEmail() {
            const recipientSelect = document.getElementById('emailRecipients');
            const customEmail = document.getElementById('customEmail').value.trim();
            const screenshotType = document.getElementById('screenshotType').value;
            const subject = document.getElementById('emailSubject').value.trim();
            const message = document.getElementById('emailMessage').value.trim();

            // Get selected recipients
            let recipients = [];
            for (let option of recipientSelect.selectedOptions) {
                recipients.push(option.value);
            }
            
            if (customEmail) {
                if (isValidEmail(customEmail)) {
                    recipients.push(customEmail);
                } else {
                    showEmailStatus('❌ Please enter a valid email address', 'error');
                    return;
                }
            }

            // Validation
            if (recipients.length === 0) {
                showEmailStatus('❌ Please select at least one recipient or enter a custom email', 'error');
                return;
            }

            if (!subject) {
                showEmailStatus('❌ Please enter an email subject', 'error');
                return;
            }

            try {
                showEmailStatus('📸 Capturing screenshot...', 'loading');

                // Determine what to capture
                let targetElement, viewName;
                switch (screenshotType) {
                    case 'complete':
                        targetElement = document.getElementById('monthlyView').style.display !== 'none' 
                            ? document.getElementById('monthlyView') 
                            : document.getElementById('dailyView');
                        viewName = 'Complete Dashboard View';
                        break;
                    case 'kpi-only':
                        targetElement = document.getElementById('weeklyKPIs');
                        viewName = 'Weekly KPIs Overview';
                        break;
                    case 'table-only':
                        targetElement = document.getElementById('monthlyTable');
                        viewName = 'Skills Performance Table';
                        break;
                    case 'daily-view':
                        targetElement = document.getElementById('dailyView');
                        viewName = 'Daily Operations View';
                        break;
                    default:
                        targetElement = document.querySelector('.dashboard-container');
                        viewName = 'Dashboard View';
                }

                if (!targetElement || targetElement.offsetWidth === 0) {
                    showEmailStatus('❌ Selected view is not visible or available', 'error');
                    return;
                }

                // Capture screenshot
                const canvas = await html2canvas(targetElement, {
                    useCORS: true,
                    scale: 2,
                    backgroundColor: '#ffffff',
                    logging: false,
                    allowTaint: false,
                    foreignObjectRendering: true
                });

                const imageData = canvas.toDataURL('image/png', 0.8);
                
                showEmailStatus('📤 Sending emails...', 'loading');

                // Prepare email data
                const landscape = document.getElementById('landscapeSelect').value;
                const period = document.getElementById('monthSelect').value;
                const timestamp = new Date().toLocaleString();

                // Simulate email sending (replace with actual EmailJS implementation)
                let successCount = 0;
                for (let email of recipients) {
                    try {
                        // Simulate delay
                        await new Promise(resolve => setTimeout(resolve, 500));
                        
                        // For actual EmailJS implementation, uncomment and configure:
                        /*
                        await emailjs.send('YOUR_SERVICE_ID', 'YOUR_TEMPLATE_ID', {
                            to_email: email,
                            subject: subject,
                            message: message || `Please find attached the ${viewName} screenshot from our Operations Dashboard.\n\nLandscape: ${landscape}\nPeriod: ${period}\nGenerated: ${timestamp}`,
                            screenshot: imageData,
                            landscape: landscape,
                            period: period,
                            timestamp: timestamp,
                            view_name: viewName
                        });
                        */
                        
                        console.log(`📧 Email would be sent to: ${email}`);
                        successCount++;
                    } catch (error) {
                        console.error(`Failed to send to ${email}:`, error);
                    }
                }

                if (successCount > 0) {
                    showEmailStatus(`✅ Screenshot sent successfully to ${successCount} recipient(s)!`, 'success');
                    
                    // Log the action
                    logAction('Email Screenshot', `Sent ${viewName} to ${successCount} recipients`);
                    
                    // Auto-close after 3 seconds
                    setTimeout(closeEmailModal, 3000);
                } else {
                    showEmailStatus('❌ Failed to send emails. Please check your EmailJS configuration.', 'error');
                }

            } catch (error) {
                console.error('Screenshot email error:', error);
                showEmailStatus('❌ Failed to capture screenshot: ' + error.message, 'error');
            }
        }

        function showEmailStatus(message, type) {
            const statusDiv = document.getElementById('emailStatus');
            statusDiv.textContent = message;
            statusDiv.className = `email-status ${type}`;
            statusDiv.style.display = 'block';
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // ========================================
        // MAIN DASHBOARD FUNCTIONALITY
        // ========================================

        function initializeDashboard() {
            console.log('🚀 Initializing HBoard Operations Dashboard...');
            
            // Set current date values
            document.getElementById('monthSelect').value = currentMonth;
            document.getElementById('dateSelect').value = currentDate;
            document.getElementById('landscapeSelect').value = currentLandscape;
            
            // Add event listeners
            document.getElementById('landscapeSelect').addEventListener('change', refreshData);
            document.getElementById('monthSelect').addEventListener('change', refreshData);
            document.getElementById('dateSelect').addEventListener('change', refreshData);
            
            // Load initial view
            refreshData();
            
            console.log('✅ Dashboard initialized successfully');
        }

        function switchView(viewType) {
            currentView = viewType;
            
            // Update toggle buttons
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Show/hide appropriate controls and views
            const monthControl = document.getElementById('monthControl');
            const dateControl = document.getElementById('dateControl');
            const monthlyView = document.getElementById('monthlyView');
            const dailyView = document.getElementById('dailyView');
            
            if (viewType === 'daily') {
                monthControl.classList.add('hidden');
                dateControl.classList.remove('hidden');
                monthlyView.classList.add('hidden');
                dailyView.classList.remove('hidden');
                generateDailyView();
            } else {
                monthControl.classList.remove('hidden');
                dateControl.classList.add('hidden');
                monthlyView.classList.remove('hidden');
                dailyView.classList.add('hidden');
                generateMonthlyView();
            }
        }

        function refreshData() {
            currentLandscape = document.getElementById('landscapeSelect').value;
            
            if (currentView === 'monthly') {
                currentMonth = document.getElementById('monthSelect').value;
                generateMonthlyView();
            } else {
                currentDate = document.getElementById('dateSelect').value;
                generateDailyView();
            }
        }

        function generateMonthlyView() {
            console.log('📊 Generating monthly view...');
            
            const weeks = getWeeksInMonth(currentMonth);
            generateKPICards(weeks);
            generateMonthlyHeaders(weeks);
            generateMonthlyTableBody(weeks);
        }

        function getWeeksInMonth(monthYear) {
            const [year, month] = monthYear.split('-').map(Number);
            const firstDay = new Date(year, month - 1, 1);
            const lastDay = new Date(year, month, 0);
            
            const weeks = [];
            let currentWeek = 1;
            let currentDate = new Date(firstDay);
            
            while (currentDate <= lastDay) {
                const weekStart = new Date(currentDate);
                const weekEnd = new Date(Math.min(currentDate.getTime() + 6 * 24 * 60 * 60 * 1000, lastDay.getTime()));
                
                weeks.push({
                    number: currentWeek,
                    label: `WK ${currentWeek}`,
                    start: weekStart.getDate(),
                    end: weekEnd.getDate(),
                    dates: getWeekDates(weekStart, weekEnd)
                });
                
                currentDate.setTime(weekEnd.getTime() + 24 * 60 * 60 * 1000);
                currentWeek++;
            }
            
            return weeks;
        }

        function getWeekDates(start, end) {
            const dates = [];
            const currentDate = new Date(start);
            
            while (currentDate <= end) {
                dates.push(new Date(currentDate));
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            return dates;
        }

        function generateKPICards(weeks) {
            const kpiGrid = document.getElementById('kpiGrid');
            let kpiHTML = '';
            
            weeks.forEach((week, index) => {
                // Sample data - in real implementation, calculate from actual data
                const percentage = index === 0 ? 100 : 0;
                const colorClass = percentage >= 95 ? 'green' : percentage >= 45 ? 'amber' : 'red';
                
                kpiHTML += `
                    <div class="kpi-card">
                        <div class="kpi-value ${colorClass}">${percentage}%</div>
                        <div class="kpi-label">${week.label} Availability</div>
                    </div>
                `;
            });
            
            kpiGrid.innerHTML = kpiHTML;
        }

        function generateMonthlyHeaders(weeks) {
            const headersContainer = document.getElementById('monthlyHeaders');
            let headerHTML = '<tr><th class="skill-header">Skills / Operational Areas</th>';
            
            weeks.forEach(week => {
                headerHTML += `<th>${week.label}<br><small>${week.start}-${week.end}</small></th>`;
            });
            
            headerHTML += '</tr>';
            headersContainer.innerHTML = headerHTML;
        }

        function generateMonthlyTableBody(weeks) {
            const bodyContainer = document.getElementById('monthlyBody');
            let bodyHTML = '';
            
            skillsData.forEach((skill, skillIndex) => {
                bodyHTML += `<tr><td class="skill-name" title="${skill}">${skill}</td>`;
                
                weeks.forEach((week, weekIndex) => {
                    // Sample data - replace with actual operational data
                    const percentage = (skillIndex === 0 && weekIndex === 0) ? 100 : 0;
                    const statusClass = percentage >= 95 ? 'green' : percentage >= 45 ? 'amber' : percentage > 0 ? 'red' : 'empty';
                    const filledDays = percentage >= 95 ? 7 : percentage >= 45 ? Math.floor(percentage / 100 * 7) : 0;
                    
                    bodyHTML += `
                        <td class="status-cell" onclick="editCell('${skill}', '${week.label}')">
                            <div class="status-dot ${statusClass}">
                                ${percentage > 0 ? percentage + '%' : '--'}
                            </div>
                            <div class="status-indicators">
                                ${generateStatusIndicators(7, filledDays)}
                            </div>
                        </td>
                    `;
                });
                
                bodyHTML += '</tr>';
            });
            
            bodyContainer.innerHTML = bodyHTML;
        }

        function generateStatusIndicators(total, filled) {
            let indicators = '';
            for (let i = 0; i < total; i++) {
                const className = i < filled ? 'status-indicator filled' : 'status-indicator';
                indicators += `<div class="${className}"></div>`;
            }
            return indicators;
        }

        function generateDailyView() {
            console.log('📅 Generating daily view...');
            
            const selectedDate = new Date(currentDate);
            const weekStart = new Date(selectedDate);
            weekStart.setDate(selectedDate.getDate() - selectedDate.getDay());
            
            generateDailyStats();
            generateDailyGrid(weekStart);
        }

        function generateDailyStats() {
            // Sample statistics - replace with actual calculations
            document.getElementById('todayAverage').textContent = '75%';
            document.getElementById('weeklyAverage').textContent = '68%';
            document.getElementById('trendIndicator').textContent = '📈';
        }

        function generateDailyGrid(weekStart) {
            const gridContainer = document.getElementById('dailyGrid');
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            
            let gridHTML = '<div class="daily-header">Skills</div>';
            
            // Generate day headers
            for (let i = 0; i < 7; i++) {
                const currentDay = new Date(weekStart);
                currentDay.setDate(weekStart.getDate() + i);
                
                gridHTML += `
                    <div class="daily-header">
                        ${dayNames[i]}<br>
                        <small>${currentDay.getDate()}/${currentDay.getMonth() + 1}</small>
                    </div>
                `;
            }
            
            // Generate skill rows
            skillsData.forEach((skill, skillIndex) => {
                gridHTML += `<div class="daily-skill" title="${skill}">${skill}</div>`;
                
                // Generate daily cells for each skill
                for (let i = 0; i < 7; i++) {
                    // Sample data - replace with actual data
                    const hasData = skillIndex === 0 && i < 3; // Sample: first skill has data for first 3 days
                    const percentage = hasData ? 100 : 0;
                    const statusClass = hasData ? 'green' : 'empty';
                    
                    gridHTML += `
                        <div class="daily-cell" onclick="editDailyCell('${skill}', ${i})">
                            <div class="status-dot ${statusClass}">
                                ${hasData ? '✓' : '--'}
                            </div>
                            <div style="font-size: 10px; font-weight: 600; color: var(--primary-green); margin-top: 4px;">
                                ${percentage}%
                            </div>
                        </div>
                    `;
                }
            });
            
            gridContainer.innerHTML = gridHTML;
        }

        // ========================================
        // UTILITY FUNCTIONS
        // ========================================

        function editCell(skill, week) {
            console.log(`Editing: ${skill} - ${week}`);
            // In a real implementation, this would open an editing interface
            alert(`Edit ${skill} for ${week}\n(This would open an edit dialog in the full implementation)`);
        }

        function editDailyCell(skill, dayIndex) {
            console.log(`Editing daily: ${skill} - Day ${dayIndex}`);
            // In a real implementation, this would open an editing interface
            alert(`Edit ${skill} for day ${dayIndex}\n(This would open an edit dialog in the full implementation)`);
        }

        function addNewSkill() {
            document.getElementById('addSkillModal').style.display = 'block';
            document.getElementById('newSkillName').focus();
        }

        function submitNewSkill() {
            const skillName = document.getElementById('newSkillName').value.trim();
            
            if (!skillName) {
                alert('Please enter a skill name');
                return false;
            }
            
            if (skillsData.includes(skillName)) {
                alert('This skill already exists');
                return false;
            }
            
            skillsData.push(skillName);
            localStorage.setItem('hboard_skills_data', JSON.stringify(skillsData));
            
            logAction('Add Skill', `Added new skill: ${skillName}`);
            closeModal('addSkillModal');
            refreshData();
            
            return false;
        }

        function exportToExcel() {
            console.log('📊 Exporting to Excel...');
            
            // In a real implementation, this would generate an actual Excel file
            const data = {
                landscape: currentLandscape,
                month: currentMonth,
                skills: skillsData,
                timestamp: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `hboard-export-${currentLandscape}-${currentMonth}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            logAction('Export Data', `Exported data for ${currentLandscape} - ${currentMonth}`);
            alert('✅ Data exported successfully!');
        }

        function importData() {
            document.getElementById('importModal').style.display = 'block';
        }

        function processImport() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a file to import');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Process imported data
                    if (data.skills && Array.isArray(data.skills)) {
                        skillsData = [...new Set([...skillsData, ...data.skills])]; // Merge and deduplicate
                        localStorage.setItem('hboard_skills_data', JSON.stringify(skillsData));
                    }
                    
                    if (data.operationalData) {
                        Object.assign(operationalData, data.operationalData);
                        localStorage.setItem('hboard_operational_data', JSON.stringify(operationalData));
                    }
                    
                    logAction('Import Data', `Imported data from ${file.name}`);
                    closeModal('importModal');
                    refreshData();
                    alert('✅ Data imported successfully!');
                    
                } catch (error) {
                    console.error('Import error:', error);
                    alert('❌ Error importing file: Invalid format');
                }
            };
            
            reader.readAsText(file);
        }

        function viewHistory() {
            document.getElementById('historyModal').style.display = 'block';
            
            const historyContent = document.getElementById('historyContent');
            
            if (historyLog.length === 0) {
                historyContent.innerHTML = '<p>No history available.</p>';
                return;
            }
            
            let historyHTML = '<div style="space-y: 10px;">';
            
            historyLog.slice(-20).reverse().forEach(entry => { // Show last 20 entries
                historyHTML += `
                    <div style="padding: 12px; border-left: 3px solid var(--primary-green); background: var(--light-gray); margin-bottom: 8px; border-radius: 4px;">
                        <div style="font-weight: 600; color: var(--primary-green);">${entry.action}</div>
                        <div style="font-size: 12px; color: var(--medium-gray); margin-top: 4px;">
                            ${entry.details} • ${entry.timestamp}
                        </div>
                    </div>
                `;
            });
            
            historyHTML += '</div>';
            historyContent.innerHTML = historyHTML;
        }

        function clearData() {
            if (confirm('⚠️ Are you sure you want to clear all data? This action cannot be undone.')) {
                operationalData = {};
                historyLog = [];
                localStorage.removeItem('hboard_operational_data');
                localStorage.removeItem('hboard_history_log');
                
                logAction('Clear Data', 'All operational data cleared');
                refreshData();
                alert('✅ Data cleared successfully!');
            }
        }

        function syncData() {
            console.log('🔄 Syncing data...');
            
            // Simulate sync process
            const syncMessage = document.createElement('div');
            syncMessage.innerHTML = '🔄 Syncing data...';
            syncMessage.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--primary-green);
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                font-weight: 600;
                z-index: 1001;
                box-shadow: var(--shadow-medium);
            `;
            
            document.body.appendChild(syncMessage);
            
            setTimeout(() => {
                syncMessage.innerHTML = '✅ Sync complete!';
                setTimeout(() => {
                    document.body.removeChild(syncMessage);
                }, 2000);
            }, 1500);
            
            logAction('Sync Data', 'Data synchronized with server');
        }

        function logAction(action, details) {
            const entry = {
                action: action,
                details: details,
                timestamp: new Date().toLocaleString(),
                user: 'Current User' // In real app, get from authentication
            };
            
            historyLog.push(entry);
            localStorage.setItem('hboard_history_log', JSON.stringify(historyLog));
        }

        // ========================================
        // MODAL MANAGEMENT
        // ========================================

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            
            // Reset forms
            const modal = document.getElementById(modalId);
            const inputs = modal.querySelectorAll('input, textarea, select');
            inputs.forEach(input => {
                if (input.type !== 'file') {
                    input.value = '';
                }
            });
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal') || event.target.classList.contains('email-modal')) {
                if (event.target.id === 'emailModal') {
                    closeEmailModal();
                } else {
                    closeModal(event.target.id);
                }
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                // Close any open modal
                const modals = document.querySelectorAll('.modal, .email-modal');
                modals.forEach(modal => {
                    if (modal.style.display === 'block' || modal.style.display === 'flex') {
                        if (modal.id === 'emailModal') {
                            closeEmailModal();
                        } else {
                            closeModal(modal.id);
                        }
                    }
                });
            }
        });

        // ========================================
        // INITIALIZATION
        // ========================================

        // Initialize dashboard when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved data
            const savedSkills = localStorage.getItem('hboard_skills_data');
            if (savedSkills) {
                skillsData = JSON.parse(savedSkills);
            }
            
            const savedOperationalData = localStorage.getItem('hboard_operational_data');
            if (savedOperationalData) {
                operationalData = JSON.parse(savedOperationalData);
            }
            
            const savedHistoryLog = localStorage.getItem('hboard_history_log');
            if (savedHistoryLog) {
                historyLog = JSON.parse(savedHistoryLog);
            }
            
            // Initialize the dashboard
            initializeDashboard();
            
            // Log initialization
            logAction('System Startup', 'HBoard Operations Dashboard initialized');
        });

        // Console welcome message
        console.log(`
🔹 HBoard - Operations Excellence Dashboard v2024 🔹
✅ Dashboard loaded successfully
📧 Email Screenshot: Configure EmailJS credentials for email functionality
🎯 Ready for operations tracking and KPI analysis
📊 Skills column width optimized for better display
        `);
    </script>
</body>
</html>
