<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>🔹 HBoard - Advanced Operations Dashboard v2024 🔹</title>
    <meta name="description" content="Production-ready operations dashboard with Firebase authentication, dynamic KPI analytics, and screenshot download functionality">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- External CDN Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    
    <style>
        /* Global Styles and CSS Variables */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-green: #28a745;
            --secondary-teal: #20c997;
            --accent-blue: #17a2b8;
            --warning-amber: #ffc107;
            --danger-red: #dc3545;
            --light-gray: #f8f9fa;
            --medium-gray: #6c757d;
            --dark-gray: #343a40;
            --border-color: #dee2e6;
            --shadow-light: 0 2px 10px rgba(0,0,0,0.1);
            --shadow-medium: 0 4px 20px rgba(0,0,0,0.15);
            --shadow-heavy: 0 8px 30px rgba(0,0,0,0.2);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --gradient-primary: linear-gradient(135deg, var(--primary-green) 0%, var(--secondary-teal) 100%);
            --gradient-secondary: linear-gradient(135deg, var(--secondary-teal) 0%, var(--accent-blue) 100%);
        }
        
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--dark-gray);
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
            font-size: 14px;
            padding: 10px;
        }

        /* Authentication Section Styles */
        #auth-section {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(10px);
        }

        .auth-container {
            background: white;
            padding: 50px;
            border-radius: 20px;
            box-shadow: var(--shadow-heavy);
            text-align: center;
            min-width: 450px;
            max-width: 500px;
            border: 3px solid var(--primary-green);
            position: relative;
            animation: slideInUp 0.6s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(100px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .auth-container h2 {
            color: var(--primary-green);
            font-size: 2.5rem;
            margin-bottom: 15px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .auth-container .subtitle {
            color: var(--medium-gray);
            margin-bottom: 40px;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .auth-form input {
            padding: 18px 25px;
            border: 3px solid var(--primary-green);
            border-radius: 12px;
            font-size: 18px;
            background: white;
            color: var(--dark-gray);
            transition: var(--transition);
            font-family: inherit;
        }

        .auth-form input:focus {
            outline: none;
            border-color: var(--secondary-teal);
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
            transform: translateY(-2px);
        }

        .auth-form input::placeholder {
            color: var(--medium-gray);
        }

        .auth-buttons {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }

        .auth-btn {
            flex: 1;
            padding: 18px 25px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            font-family: inherit;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .auth-btn.signup {
            background: var(--primary-green);
            color: white;
            border: 3px solid var(--primary-green);
        }

        .auth-btn.signup:hover {
            background: var(--secondary-teal);
            border-color: var(--secondary-teal);
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }

        .auth-btn.signin {
            background: transparent;
            color: var(--primary-green);
            border: 3px solid var(--primary-green);
        }

        .auth-btn.signin:hover {
            background: var(--primary-green);
            color: white;
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }

        .auth-btn.signout {
            background: var(--danger-red);
            color: white;
            border: 3px solid var(--danger-red);
            position: fixed;
            top: 20px;
            right: 20px;
            flex: none;
            padding: 12px 20px;
            font-size: 14px;
            z-index: 10000;
            border-radius: 25px;
        }

        .auth-btn.signout:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .auth-status {
            margin-top: 25px;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 16px;
        }

        .auth-status.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .auth-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .auth-loading {
            color: var(--primary-green);
            font-style: italic;
        }

        .auth-divider {
            margin: 30px 0;
            position: relative;
            text-align: center;
        }

        .auth-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--border-color);
        }

        .auth-divider span {
            background: white;
            padding: 0 20px;
            color: var(--medium-gray);
            font-weight: 600;
        }

        /* Connection Status */
        .connection-status {
            position: fixed;
            top: 10px;
            left: 20px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1000;
            transition: var(--transition);
        }

        .connection-status.connected {
            background: var(--primary-green);
            color: white;
        }

        .connection-status.connecting {
            background: var(--warning-amber);
            color: var(--dark-gray);
        }

        .connection-status.offline {
            background: var(--danger-red);
            color: white;
        }

        /* Main Container */
        .main-container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-heavy);
            overflow: hidden;
            border: 2px solid var(--primary-green);
            display: none; /* Hidden by default until authenticated */
        }
        
        /* Header Styles */
        .header {
            background: var(--gradient-primary);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 2.4rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .header .subtitle {
            font-size: 1.15rem;
            opacity: 0.95;
            font-weight: 500;
        }
        
        .version-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .user-info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: none;
        }
        
        /* Content Area */
        .content {
            padding: 25px;
            background: var(--light-gray);
        }
        
        /* Control Panel */
        .control-panel {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow-light);
            border: 2px solid var(--primary-green);
        }
        
        .control-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 180px;
        }

        .control-group-inline {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .control-group label {
            font-weight: 700;
            color: var(--primary-green);
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .add-landscape-btn {
            padding: 8px 12px;
            font-size: 12px;
            border: 2px solid var(--secondary-teal);
            background: var(--secondary-teal);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .add-landscape-btn:hover {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
            transform: translateY(-1px);
        }
        
        /* Form Elements */
        select, input[type="month"], input[type="date"], input[type="text"], input[type="number"], input[type="email"] {
            padding: 12px 16px;
            border: 2px solid var(--primary-green);
            border-radius: 8px;
            font-size: 14px;
            background: white;
            color: var(--dark-gray);
            transition: var(--transition);
            font-family: inherit;
        }
        
        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: var(--secondary-teal);
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
            transform: translateY(-1px);
        }
        
        textarea {
            padding: 12px 16px;
            border: 2px solid var(--primary-green);
            border-radius: 8px;
            font-size: 14px;
            background: white;
            color: var(--dark-gray);
            resize: vertical;
            font-family: inherit;
            min-height: 80px;
        }
        
        /* View Toggle */
        .view-toggle {
            display: flex;
            background: var(--border-color);
            border-radius: 25px;
            padding: 4px;
            border: 2px solid var(--primary-green);
        }
        
        .toggle-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 20px;
            background: transparent;
            color: var(--medium-gray);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .toggle-btn.active {
            background: var(--primary-green);
            color: white;
            box-shadow: var(--shadow-light);
        }
        
        .toggle-btn:hover:not(.active) {
            background: rgba(40, 167, 69, 0.1);
            color: var(--primary-green);
        }
        
        /* Buttons */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border: 2px solid transparent;
        }
        
        .btn-primary {
            background: var(--primary-green);
            color: white;
            border-color: var(--primary-green);
        }
        
        .btn-primary:hover {
            background: var(--secondary-teal);
            border-color: var(--secondary-teal);
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        .btn-success {
            background: var(--secondary-teal);
            color: white;
            border-color: var(--secondary-teal);
        }
        
        .btn-success:hover {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        .btn-warning {
            background: var(--warning-amber);
            color: var(--dark-gray);
            border-color: var(--warning-amber);
        }
        
        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        .btn-danger {
            background: var(--danger-red);
            color: white;
            border-color: var(--danger-red);
        }
        
        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        .btn-download {
            background: var(--accent-blue);
            color: white;
            border-color: var(--accent-blue);
        }
        
        .btn-download:hover {
            background: #138496;
            border-color: #138496;
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        /* Action Buttons Grid */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        /* KPI Dashboard Section */
        .kpi-dashboard {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 25px;
            border: 2px solid var(--secondary-teal);
            box-shadow: var(--shadow-light);
        }

        .kpi-dashboard h2 {
            color: var(--secondary-teal);
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .kpi-performance-section {
            margin-bottom: 40px;
        }

        .kpi-performance-section h3 {
            color: var(--primary-green);
            font-size: 1.4rem;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .performance-card {
            background: var(--gradient-primary);
            color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: var(--shadow-medium);
            transition: var(--transition);
        }

        .performance-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-heavy);
        }

        .performance-card h4 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .performance-value {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .performance-label {
            font-size: 0.9rem;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .performance-trend {
            margin-top: 15px;
            padding: 10px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            font-size: 0.85rem;
            backdrop-filter: blur(10px);
        }

        /* Dynamic Calculation Section */
        .calculation-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid var(--warning-amber);
            box-shadow: var(--shadow-light);
        }

        .calculation-section h3 {
            color: var(--warning-amber);
            font-size: 1.4rem;
            margin-bottom: 20px;
            font-weight: 700;
            text-align: center;
        }

        .calculation-rules {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .rule-card {
            padding: 20px;
            border-radius: var(--border-radius);
            border: 2px solid;
            transition: var(--transition);
        }

        .rule-card.green {
            border-color: var(--primary-green);
            background: rgba(40, 167, 69, 0.05);
        }

        .rule-card.amber {
            border-color: var(--warning-amber);
            background: rgba(255, 193, 7, 0.05);
        }

        .rule-card.red {
            border-color: var(--danger-red);
            background: rgba(220, 53, 69, 0.05);
        }

        .rule-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-light);
        }

        .rule-icon {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .rule-title {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .rule-description {
            color: var(--medium-gray);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* Statistics Cards */
        .stats-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid var(--accent-blue);
            box-shadow: var(--shadow-light);
        }

        .stats-section h3 {
            color: var(--accent-blue);
            font-size: 1.4rem;
            margin-bottom: 20px;
            font-weight: 700;
            text-align: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-card {
            background: var(--gradient-secondary);
            color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: var(--shadow-light);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
            font-weight: 600;
        }

        .stat-icon {
            font-size: 1.2rem;
            margin-right: 8px;
        }

        /* Dashboard Views */
        .dashboard-container {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-light);
            border: 2px solid var(--primary-green);
        }
        
        /* KPI Section */
        .kpi-section {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            border: 2px solid var(--secondary-teal);
            box-shadow: var(--shadow-light);
        }
        
        .kpi-section h3 {
            color: var(--secondary-teal);
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.4rem;
            font-weight: 700;
        }
        
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
        }
        
        .kpi-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid var(--secondary-teal);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
        }
        
        .kpi-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
            border-color: var(--primary-green);
        }
        
        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .kpi-value.red { color: var(--danger-red) !important; }
        .kpi-value.amber { color: var(--warning-amber) !important; }
        .kpi-value.green { color: var(--primary-green) !important; }
        
        .kpi-label {
            font-size: 0.85rem;
            color: var(--medium-gray);
            font-weight: 600;
            line-height: 1.3;
        }
        
        /* Monthly View Table */
        .monthly-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            background: white;
        }
        
        .monthly-table th {
            background: var(--gradient-primary);
            color: white;
            padding: 16px 12px;
            text-align: center;
            border: 1px solid var(--secondary-teal);
            font-weight: 700;
            font-size: 13px;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .monthly-table th.skill-header {
            text-align: left;
            padding-left: 20px;
            min-width: 140px;
            max-width: 160px;
            position: sticky;
            left: 0;
            z-index: 11;
        }
        
        .monthly-table td {
            border: 1px solid var(--border-color);
            padding: 12px 8px;
            text-align: center;
            vertical-align: middle;
            transition: var(--transition);
        }
        
        .monthly-table td.skill-name {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            font-weight: 600;
            text-align: left;
            padding-left: 20px;
            border-right: 3px solid var(--primary-green);
            color: var(--primary-green);
            min-width: 110px;
            max-width: 130px;
            font-size: 12px;
            position: sticky;
            left: 0;
            z-index: 5;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .monthly-table td.skill-name:hover {
            background: rgba(40, 167, 69, 0.1);
        }
        
        .monthly-table tbody tr:hover {
            background: rgba(40, 167, 69, 0.02);
        }
        
        /* Status Cells and Dots */
        .status-cell {
            cursor: pointer;
            position: relative;
            padding: 15px 8px;
        }
        
        .status-cell:hover {
            background: rgba(40, 167, 69, 0.1);
            transform: scale(1.02);
        }
        
        .status-dot {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin: 0 auto 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 11px;
            color: white;
            border: 3px solid transparent;
            box-shadow: var(--shadow-light);
            transition: var(--transition);
        }
        
        .status-dot:hover {
            transform: scale(1.2);
            box-shadow: var(--shadow-medium);
        }
        
        .status-dot.green {
            background: var(--primary-green);
            border-color: #1e7e34;
        }
        
        .status-dot.amber {
            background: var(--warning-amber);
            border-color: #d39e00;
            color: var(--dark-gray);
        }
        
        .status-dot.red {
            background: var(--danger-red);
            border-color: #bd2130;
        }
        
        .status-dot.gray {
            background: var(--medium-gray);
            border-color: #495057;
        }
        
        .status-dot.empty {
            background: var(--light-gray);
            border: 3px dashed var(--medium-gray);
            color: var(--medium-gray);
        }
        
        /* Status Indicators */
        .status-indicators {
            display: flex;
            justify-content: center;
            gap: 2px;
            margin-top: 5px;
        }
        
        .status-indicator {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--border-color);
            transition: var(--transition);
        }
        
        .status-indicator.filled {
            background: var(--primary-green);
        }
        
        .status-indicator.partial {
            background: var(--warning-amber);
        }
        
        /* Daily View Styles */
        .daily-container {
            padding: 25px;
        }
        
        .daily-stats {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            border: 2px solid var(--primary-green);
            box-shadow: var(--shadow-light);
        }
        
        .daily-stats h3 {
            color: var(--primary-green);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .daily-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }
        
        .daily-stat-card {
            text-align: center;
        }
        
        .daily-stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-green);
            margin-bottom: 5px;
        }
        
        .daily-stat-label {
            font-size: 0.9rem;
            color: var(--medium-gray);
            font-weight: 600;
        }
        
        .daily-grid {
            display: grid;
            grid-template-columns: 120px repeat(7, 1fr);
            gap: 2px;
            background: var(--border-color);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-light);
        }
        
        .daily-header {
            background: var(--gradient-primary);
            color: white;
            padding: 15px 8px;
            text-align: center;
            font-weight: 700;
            font-size: 12px;
        }
        
        .daily-skill {
            background: var(--secondary-teal);
            color: white;
            padding: 15px 8px;
            font-weight: 600;
            display: flex;
            align-items: center;
            font-size: 11px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .daily-cell {
            background: white;
            padding: 12px 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 70px;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }
        
        .daily-cell:hover {
            background: rgba(40, 167, 69, 0.1);
            border-color: var(--primary-green);
            transform: scale(1.02);
        }

        /* Skill Management Section */
        .skill-management {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid var(--accent-blue);
            box-shadow: var(--shadow-light);
        }

        .skill-management h3 {
            color: var(--accent-blue);
            font-size: 1.4rem;
            margin-bottom: 20px;
            font-weight: 700;
            text-align: center;
        }

        .skill-management-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .skill-list-section, .add-skill-section {
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
        }

        .skill-list-section h4, .add-skill-section h4 {
            color: var(--primary-green);
            margin-bottom: 15px;
            font-weight: 600;
        }

        .skills-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .skill-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 8px;
            transition: var(--transition);
        }

        .skill-item:hover {
            background: var(--light-gray);
            border-color: var(--primary-green);
        }

        .skill-item-name {
            font-weight: 600;
            color: var(--dark-gray);
        }

        .skill-item-actions {
            display: flex;
            gap: 5px;
        }

        .skill-action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .skill-action-btn.edit {
            background: var(--warning-amber);
            color: var(--dark-gray);
        }

        .skill-action-btn.delete {
            background: var(--danger-red);
            color: white;
        }

        .skill-action-btn:hover {
            transform: scale(1.1);
        }

        .add-skill-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .add-skill-form input {
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
        }

        .add-skill-form input:focus {
            border-color: var(--primary-green);
            outline: none;
        }
        
        /* Download Modal Styles */
        .download-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .download-modal-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 40px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-heavy);
            border: 3px solid var(--accent-blue);
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .download-modal h3 {
            color: var(--accent-blue);
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 25px;
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--accent-blue);
        }
        
        .download-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .download-form label {
            font-weight: 700;
            color: var(--accent-blue);
            margin-bottom: 5px;
            display: block;
        }
        
        .download-form small {
            color: var(--medium-gray);
            font-size: 11px;
            margin-top: 5px;
            display: block;
        }

        .view-selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .view-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .view-option:hover {
            border-color: var(--accent-blue);
            background: rgba(23, 162, 184, 0.05);
        }

        .view-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .view-option.selected {
            border-color: var(--accent-blue);
            background: rgba(23, 162, 184, 0.1);
        }

        .preview-section {
            margin: 25px 0;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background: var(--light-gray);
        }

        .preview-section h4 {
            color: var(--primary-green);
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .preview-container {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: white;
            padding: 15px;
        }

        .format-selection {
            display: flex;
            gap: 15px;
            margin: 15px 0;
        }

        .format-btn {
            padding: 10px 20px;
            border: 2px solid var(--accent-blue);
            border-radius: 8px;
            background: white;
            color: var(--accent-blue);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }

        .format-btn.active {
            background: var(--accent-blue);
            color: white;
        }

        .format-btn:hover:not(.active) {
            background: rgba(23, 162, 184, 0.1);
        }
        
        .download-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            color: var(--danger-red);
            cursor: pointer;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .download-close:hover {
            background: var(--danger-red);
            color: white;
            transform: scale(1.1);
        }
        
        .download-status {
            padding: 15px;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            margin-top: 15px;
            display: none;
        }
        
        .download-status.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        
        .download-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        
        .download-status.loading {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffeaa7;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            box-shadow: var(--shadow-heavy);
            border: 3px solid var(--primary-green);
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            color: var(--danger-red);
            cursor: pointer;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .modal-close:hover {
            background: var(--danger-red);
            color: white;
            transform: scale(1.1);
        }
        
        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-container {
                margin: 0 10px;
            }
            
            .action-buttons {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .skill-management-content {
                grid-template-columns: 1fr;
            }

            .view-selection-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .content {
                padding: 15px;
            }
            
            .control-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .control-group {
                min-width: auto;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .kpi-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
            
            .daily-stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
            
            .daily-grid {
                grid-template-columns: 100px repeat(7, 1fr);
                font-size: 12px;
            }
            
            .daily-skill {
                font-size: 10px;
            }
            
            .monthly-table th.skill-header,
            .monthly-table td.skill-name {
                min-width: 110px;
                max-width: 130px;
                font-size: 11px;
            }
            
            .monthly-table {
                font-size: 12px;
            }
            
            .download-modal-content {
                padding: 25px;
                margin: 20px;
            }

            .auth-container {
                min-width: 300px;
                padding: 30px;
                margin: 20px;
            }

            .auth-buttons {
                flex-direction: column;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .calculation-rules {
                grid-template-columns: 1fr;
            }

            .format-selection {
                flex-direction: column;
            }
        }
        
        /* Print Styles */
        @media print {
            .action-buttons, .version-badge, .download-modal, .auth-section {
                display: none !important;
            }
            
            .main-container {
                box-shadow: none;
                border: 1px solid #ccc;
            }
            
            .header {
                background: #28a745 !important;
                -webkit-print-color-adjust: exact;
            }
        }
        
        /* Utility Classes */
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        .font-bold { font-weight: 700; }
        .font-medium { font-weight: 600; }
        .text-green { color: var(--primary-green); }
        .text-teal { color: var(--secondary-teal); }
        .text-red { color: var(--danger-red); }
        .text-amber { color: var(--warning-amber); }
        .text-gray { color: var(--medium-gray); }
        .mb-10 { margin-bottom: 10px; }
        .mb-15 { margin-bottom: 15px; }
        .mb-20 { margin-bottom: 20px; }
        .mt-10 { margin-top: 10px; }
        .mt-15 { margin-top: 15px; }
        .mt-20 { margin-top: 20px; }
        .hidden { display: none; }
        .visible { display: block; }
    </style>
</head>
<body>
    <!-- Authentication Section -->
    <div id="auth-section">
        <div class="auth-container">
            <h2>🔐 HBoard Login</h2>
            <p class="subtitle">Secure Firebase authentication for operations dashboard</p>
            
            <form class="auth-form" onsubmit="return false;">
                <input type="email" id="email" placeholder="📧 Enter your email address" required>
                <input type="password" id="password" placeholder="🔒 Enter your password" required>
                
                <div class="auth-buttons">
                    <button type="button" class="auth-btn signup" onclick="signUp()">
                        🚀 Create Account
                    </button>
                    <button type="button" class="auth-btn signin" onclick="signIn()">
                        🔑 Sign In
                    </button>
                </div>
            </form>
            
            <div id="auth-status" class="auth-status"></div>
            
            <div class="auth-divider">
                <span>Enterprise-grade Firebase Security</span>
            </div>
        </div>
    </div>

    <!-- Sign Out Button -->
    <button id="signOutBtn" class="auth-btn signout" onclick="signOut()" style="display:none">
        🚪 Sign Out
    </button>

    <!-- Connection Status -->
    <div id="connectionStatus" class="connection-status connecting">🔄 Connecting...</div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Header Section -->
        <header class="header">
            <div id="userInfo" class="user-info" style="display:none">
                👤 <span id="userEmail"></span>
            </div>
            <div class="version-badge">v2024.09.08</div>
            <h1>📊 HBoard - Operations Excellence Dashboard</h1>
            <p class="subtitle">Advanced KPI Analytics with Firebase Auth & High-Quality Screenshot Downloads</p>
        </header>

        <!-- Main Content -->
        <main class="content">
            <!-- Control Panel -->
            <section class="control-panel">
                <div class="control-row">
                    <div class="control-group">
                        <label for="landscapeSelect">🌍 Landscape</label>
                        <div class="control-group-inline">
                            <select id="landscapeSelect"></select>
                            <button type="button" class="add-landscape-btn" onclick="addNewLandscape()">
                                ➕ Add
                            </button>
                        </div>
                    </div>

                    <div class="control-group" id="monthControl">
                        <label for="monthSelect">📅 Month/Year</label>
                        <input type="month" id="monthSelect">
                    </div>

                    <div class="control-group hidden" id="dateControl">
                        <label for="dateSelect">📅 Specific Date</label>
                        <input type="date" id="dateSelect">
                    </div>

                    <div class="control-group">
                        <label>📊 View Mode</label>
                        <div class="view-toggle">
                            <button class="toggle-btn active" onclick="switchView('monthly')">📊 Monthly</button>
                            <button class="toggle-btn" onclick="switchView('daily')">📅 Daily</button>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="refreshData()">
                        🔄 Refresh Data
                    </button>
                    <button class="btn btn-download" onclick="openDownloadModal()">
                        📸 Download Screenshots
                    </button>
                    <button class="btn btn-success" onclick="addNewSkill()">
                        ➕ Add Skill
                    </button>
                    <button class="btn btn-primary" onclick="exportToExcel()">
                        📊 Export Excel
                    </button>
                    <button class="btn btn-warning" onclick="importData()">
                        📤 Import Data
                    </button>
                    <button class="btn btn-primary" onclick="viewHistory()">
                        📋 View History
                    </button>
                    <button class="btn btn-danger" onclick="clearData()">
                        🗑️ Clear Data
                    </button>
                    <button class="btn btn-success" onclick="syncData()">
                        🔄 Sync Now
                    </button>
                </div>
            </section>

            <!-- KPI Dashboard Section -->
            <section class="kpi-dashboard">
                <h2>📈 Key Performance Indicators</h2>
                
                <!-- Monthly/Yearly Performance -->
                <div class="kpi-performance-section">
                    <h3>📅 Monthly Performance - <span id="currentMonthDisplay">September 2024</span></h3>
                    <div class="performance-grid">
                        <div class="performance-card">
                            <h4>📅 Monthly Performance</h4>
                            <div class="performance-value" id="monthlyPerformance">0%</div>
                            <div class="performance-label">Overall Availability</div>
                            <div class="performance-trend" id="monthlyTrend">📊 Monthly Trend</div>
                        </div>
                        <div class="performance-card">
                            <h4>📊 Yearly Performance</h4>
                            <div class="performance-value" id="yearlyPerformance">0%</div>
                            <div class="performance-label">Overall Availability</div>
                            <div class="performance-trend" id="yearlyTrend">📊 Yearly Trend</div>
                        </div>
                    </div>
                </div>

                <!-- Dynamic Percentage Calculation -->
                <div class="calculation-section">
                    <h3>🤖 Dynamic Percentage Calculation (Downtime-Based) + Real-time Team Sync</h3>
                    <div class="calculation-rules">
                        <div class="rule-card green">
                            <div class="rule-icon">🟢</div>
                            <div class="rule-title">Green (95-100%):</div>
                            <div class="rule-description">Minimal downtime (≤1.2 hours/day)</div>
                        </div>
                        <div class="rule-card amber">
                            <div class="rule-icon">🟡</div>
                            <div class="rule-title">Amber (45-95%):</div>
                            <div class="rule-description">Moderate downtime (1.2-13.2 hours/day)</div>
                        </div>
                        <div class="rule-card red">
                            <div class="rule-icon">🔴</div>
                            <div class="rule-title">Red (0-45%):</div>
                            <div class="rule-description">High downtime (>13.2 hours/day)</div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 20px; padding: 15px; background: rgba(32, 201, 151, 0.1); border-radius: 8px;">
                        <strong>📊 Monthly View:</strong> Shows weekly averages calculated from daily data<br>
                        <strong>🔥 Team Sync:</strong> Changes sync in real-time across all team members
                    </div>
                </div>

                <!-- Performance Statistics -->
                <div class="stats-section">
                    <h3>📊 Performance Statistics</h3>
                    <div style="text-align: center; margin-bottom: 20px; font-weight: 600; color: var(--medium-gray);">
                        <strong>📌 Status Guide:</strong><br>
                        Green - Optimal Performance (95-100%) | Amber - Needs Attention (45-95%) | Red - Critical Issues (0-45%) | No Data Available (0%)
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="totalEntries">0</div>
                            <div class="stat-label">Total Entries</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="optimalCount">0</div>
                            <div class="stat-label"><span class="stat-icon">🟢</span>Optimal Performance</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="attentionCount">0</div>
                            <div class="stat-label"><span class="stat-icon">🟡</span>Needs Attention</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="criticalCount">0</div>
                            <div class="stat-label"><span class="stat-icon">🔴</span>Critical Issues</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Skill Management Section -->
            <section class="skill-management">
                <h3>🛠️ Skill Management</h3>
                <p style="text-align: center; color: var(--medium-gray); margin-bottom: 25px;">
                    Manage operational skills being tracked across your team
                </p>
                <div class="skill-management-content">
                    <div class="skill-list-section">
                        <h4>📋 Current Skills</h4>
                        <div class="skills-list" id="skillsList">
                            <!-- Skills will be populated dynamically -->
                        </div>
                    </div>
                    <div class="add-skill-section">
                        <h4>➕ Add New Skill</h4>
                        <div class="add-skill-form">
                            <input type="text" id="newSkillInput" placeholder="Enter new skill/operational area...">
                            <button class="btn btn-success" onclick="addSkillFromInput()">
                                ✅ Add Skill
                            </button>
                        </div>
                        <div style="margin-top: 15px; font-size: 12px; color: var(--medium-gray);">
                            <strong>Tip:</strong> Skills represent operational areas that require tracking and monitoring.
                        </div>
                    </div>
                </div>
            </section>

            <!-- Dashboard Container -->
            <section class="dashboard-container">
                <!-- Monthly View -->
                <div id="monthlyView">
                    <!-- KPI Section -->
                    <div class="kpi-section" id="weeklyKPIs">
                        <h3>📊 Weekly Skill Availability Overview</h3>
                        <div class="kpi-grid" id="kpiGrid">
                            <!-- KPI cards will be generated by JavaScript -->
                        </div>
                    </div>

                    <!-- Monthly Table -->
                    <div style="overflow-x: auto;">
                        <table class="monthly-table" id="monthlyTable">
                            <thead id="monthlyHeaders">
                                <!-- Headers will be generated by JavaScript -->
                            </thead>
                            <tbody id="monthlyBody">
                                <!-- Table body will be generated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Daily View -->
                <div id="dailyView" class="hidden">
                    <div class="daily-container">
                        <!-- Daily Stats -->
                        <div class="daily-stats">
                            <h3>📊 Daily Performance Statistics</h3>
                            <div class="daily-stats-grid">
                                <div class="daily-stat-card">
                                    <div class="daily-stat-value" id="todayAverage">0%</div>
                                    <div class="daily-stat-label">Today's Average</div>
                                </div>
                                <div class="daily-stat-card">
                                    <div class="daily-stat-value" id="weeklyAverage">0%</div>
                                    <div class="daily-stat-label">Weekly Average</div>
                                </div>
                                <div class="daily-stat-card">
                                    <div class="daily-stat-value" id="trendIndicator">📈</div>
                                    <div class="daily-stat-label">Performance Trend</div>
                                </div>
                                <div class="daily-stat-card">
                                    <div class="daily-stat-value text-teal">🔥</div>
                                    <div class="daily-stat-label">Team Sync Active</div>
                                </div>
                            </div>
                        </div>

                        <!-- Daily Grid -->
                        <div class="daily-grid" id="dailyGrid">
                            <!-- Daily grid will be generated by JavaScript -->
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Download Screenshot Modal -->
    <div class="download-modal" id="downloadModal">
        <div class="download-modal-content">
            <button class="download-close" onclick="closeDownloadModal()">&times;</button>
            <h3>📸 Download Dashboard Screenshots</h3>
            
            <form class="download-form" onsubmit="return false;">
                <div>
                    <label>📊 Select Views to Download:</label>
                    <small>Choose one or more sections to capture and download</small>
                    <div class="view-selection-grid">
                        <div class="view-option" data-view="complete">
                            <input type="checkbox" id="view-complete" value="complete">
                            <label for="view-complete">📊 Complete Dashboard</label>
                        </div>
                        <div class="view-option" data-view="kpi-dashboard">
                            <input type="checkbox" id="view-kpi-dashboard" value="kpi-dashboard">
                            <label for="view-kpi-dashboard">📈 KPI Dashboard</label>
                        </div>
                        <div class="view-option" data-view="weekly-kpis">
                            <input type="checkbox" id="view-weekly-kpis" value="weekly-kpis">
                            <label for="view-weekly-kpis">📊 Weekly KPIs</label>
                        </div>
                        <div class="view-option" data-view="skills-table">
                            <input type="checkbox" id="view-skills-table" value="skills-table">
                            <label for="view-skills-table">📋 Skills Table</label>
                        </div>
                        <div class="view-option" data-view="daily-view">
                            <input type="checkbox" id="view-daily-view" value="daily-view">
                            <label for="view-daily-view">📅 Daily View</label>
                        </div>
                        <div class="view-option" data-view="skill-management">
                            <input type="checkbox" id="view-skill-management" value="skill-management">
                            <label for="view-skill-management">🛠️ Skill Management</label>
                        </div>
                    </div>
                </div>

                <div>
                    <label>🎨 Image Format:</label>
                    <div class="format-selection">
                        <button type="button" class="format-btn active" id="formatPng" onclick="selectFormat('png')">
                            PNG (High Quality)
                        </button>
                        <button type="button" class="format-btn" id="formatJpeg" onclick="selectFormat('jpeg')">
                            JPEG (Compressed)
                        </button>
                    </div>
                </div>

                <div class="preview-section" id="previewSection" style="display: none;">
                    <h4>👀 Preview Selected Views:</h4>
                    <div class="preview-container" id="previewContainer">
                        <!-- Preview content will be shown here -->
                    </div>
                </div>

                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 25px;">
                    <button type="button" class="btn btn-primary" onclick="previewSelections()">
                        👁️ Preview Selections
                    </button>
                    <button type="button" class="btn btn-download" onclick="downloadScreenshots()">
                        📥 Download Screenshots
                    </button>
                </div>
            </form>

            <div id="downloadStatus" class="download-status"></div>
        </div>
    </div>

    <!-- Add Skill Modal -->
    <div class="modal" id="addSkillModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('addSkillModal')">&times;</button>
            <h2 style="color: var(--primary-green); margin-bottom: 20px;">➕ Add New Skill</h2>
            <form onsubmit="return submitNewSkill();">
                <div style="margin-bottom: 20px;">
                    <label for="newSkillName" style="display: block; margin-bottom: 10px; font-weight: bold;">Skill Name:</label>
                    <input type="text" id="newSkillName" placeholder="Enter new skill/operational area..." required>
                </div>
                <div style="display: flex; gap: 15px; justify-content: flex-end;">
                    <button type="button" class="btn btn-danger" onclick="closeModal('addSkillModal')">❌ Cancel</button>
                    <button type="submit" class="btn btn-success">✅ Add Skill</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Landscape Modal -->
    <div class="modal" id="addLandscapeModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('addLandscapeModal')">&times;</button>
            <h2 style="color: var(--secondary-teal); margin-bottom: 20px;">🌍 Add New Landscape</h2>
            <form onsubmit="return submitNewLandscape();">
                <div style="margin-bottom: 20px;">
                    <label for="newLandscapeName" style="display: block; margin-bottom: 10px; font-weight: bold;">Landscape Name:</label>
                    <input type="text" id="newLandscapeName" placeholder="Enter new landscape/region..." required>
                </div>
                <div style="display: flex; gap: 15px; justify-content: flex-end;">
                    <button type="button" class="btn btn-danger" onclick="closeModal('addLandscapeModal')">❌ Cancel</button>
                    <button type="submit" class="btn btn-success">✅ Add Landscape</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Import Data Modal -->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('importModal')">&times;</button>
            <h2 style="color: var(--primary-green); margin-bottom: 20px;">📤 Import Data</h2>
            <p style="margin-bottom: 20px; color: var(--medium-gray);">
                Upload a JSON file containing operational data or Excel file with skill performance data.
            </p>
            <div style="margin-bottom: 20px;">
                <input type="file" id="importFile" accept=".json,.xlsx,.csv" style="margin-bottom: 15px;">
                <div style="font-size: 12px; color: var(--medium-gray);">
                    Supported formats: JSON, Excel (.xlsx), CSV
                </div>
            </div>
            <div style="display: flex; gap: 15px; justify-content: flex-end;">
                <button type="button" class="btn btn-danger" onclick="closeModal('importModal')">❌ Cancel</button>
                <button type="button" class="btn btn-success" onclick="processImport()">📤 Import</button>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div class="modal" id="historyModal">
        <div class="modal-content" style="max-width: 800px;">
            <button class="modal-close" onclick="closeModal('historyModal')">&times;</button>
            <h2 style="color: var(--primary-green); margin-bottom: 20px;">📋 Data History & Changes</h2>
            <div id="historyContent" style="max-height: 400px; overflow-y: auto;">
                <!-- History content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Hidden file input for imports -->
    <input type="file" id="hiddenFileInput" style="display: none;" accept=".json,.xlsx,.csv">

    <script>
        // ========================================
        // FIREBASE CONFIGURATION
        // ========================================
        
        // Firebase Config - REPLACE WITH YOUR ACTUAL CONFIG
       const firebaseConfig = {
  apiKey: "AIzaSyBUER5i1yjaLqQq8ycf9ZZaH3MMB2AmiXY",
  authDomain: "hboard-af489.firebaseapp.com",
  projectId: "hboard-af489",
  storageBucket: "hboard-af489.firebasestorage.app",
  messagingSenderId: "286896691982",
  appId: "1:286896691982:web:4df21083f8f2350874555f",
  measurementId: "G-EQ8S9T513X"
};

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const firestore = firebase.firestore();

        // ========================================
        // GLOBAL VARIABLES AND DATA STORAGE
        // ========================================

        let currentView = 'monthly';
        let currentLandscape = 'Europe';
        let currentMonth = new Date().toISOString().substring(0, 7);
        let currentDate = new Date().toISOString().split('T')[0];
        let currentUser = null;
        let selectedFormat = 'png';

        // Sample Skills Data
        let skillsData = [
            'Business Clarity',
            'Revenue',
            'BPT Processing', 
            'Stock Aging',
            'Inventory',
            'AMB for Manufacturing',
            'PMI for Manufacturing',
            'BPM Stock Reconciliation'
        ];

        // Landscapes Data
        let landscapesData = [
            'Europe',
            'NAM',
            'APAC',
            'SEA',
            'IA',
            'Global'
        ];

        // Operational Data Storage
        let operationalData = {};
        let historyLog = [];

        // Statistics Data
        let statisticsData = {
            totalEntries: 0,
            optimalCount: 0,
            attentionCount: 0,
            criticalCount: 0,
            monthlyPerformance: 0,
            yearlyPerformance: 0
        };

        // ========================================
        // FIREBASE AUTHENTICATION FUNCTIONS
        // ========================================

        // Email/Password Sign Up
        window.signUp = async function() {
            const emailInput = document.getElementById("email").value.trim();
            const passwordInput = document.getElementById("password").value;
            const statusDiv = document.getElementById("auth-status");
            
            if (!emailInput || !passwordInput) {
                showAuthStatus('❌ Please enter both email and password', 'error');
                return;
            }

            if (passwordInput.length < 6) {
                showAuthStatus('❌ Password must be at least 6 characters long', 'error');
                return;
            }

            try {
                showAuthStatus('🔄 Creating account...', 'loading');
                
                const userCredential = await auth.createUserWithEmailAndPassword(emailInput, passwordInput);
                
                // Send email verification
                await userCredential.user.sendEmailVerification();
                
                showAuthStatus('✅ Account created! Please check your email for verification.', 'success');
                
                // Store user data in Firestore
                await firestore.collection('users').doc(userCredential.user.uid).set({
                    email: emailInput,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                });
                
            } catch (error) {
                console.error('❌ Sign up error:', error);
                showAuthStatus(`❌ ${error.message}`, 'error');
            }
        }

        // Email/Password Sign In
        window.signIn = async function() {
            const emailInput = document.getElementById("email").value.trim();
            const passwordInput = document.getElementById("password").value;
            
            if (!emailInput || !passwordInput) {
                showAuthStatus('❌ Please enter both email and password', 'error');
                return;
            }

            try {
                showAuthStatus('🔄 Signing in...', 'loading');
                
                const userCredential = await auth.signInWithEmailAndPassword(emailInput, passwordInput);
                
                if (!userCredential.user.emailVerified) {
                    showAuthStatus('❌ Please verify your email before signing in. Check your inbox.', 'error');
                    await auth.signOut();
                    return;
                }
                
                showAuthStatus('✅ Signed in successfully!', 'success');
                
                // Update last login
                await firestore.collection('users').doc(userCredential.user.uid).update({
                    lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                });
                
            } catch (error) {
                console.error('❌ Sign in error:', error);
                showAuthStatus(`❌ ${error.message}`, 'error');
            }
        }

        // Sign Out
        window.signOut = async function() {
            try {
                await auth.signOut();
                console.log('✅ User signed out successfully');
            } catch (error) {
                console.error('❌ Sign out error:', error);
            }
        }

        // Auth State Observer
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                console.log('✅ User is signed in:', user.email);
                
                // Show user info
                document.getElementById('userEmail').textContent = user.email;
                document.getElementById('userInfo').style.display = 'block';
                
                // Load user data from Firestore
                try {
                    const userDoc = await firestore.collection('users').doc(user.uid).get();
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        console.log('📊 User data loaded:', userData);
                    }
                } catch (error) {
                    console.error('❌ Error loading user data:', error);
                }
                
                showDashboard();
                updateConnectionStatus('connected');
                
            } else {
                currentUser = null;
                console.log('❌ User is signed out');
                hideDashboard();
                updateConnectionStatus('offline');
            }
        });

        function showAuthStatus(message, type) {
            const statusDiv = document.getElementById('auth-status');
            statusDiv.textContent = message;
            statusDiv.className = `auth-status ${type}`;
            statusDiv.style.display = 'block';
        }

        function showDashboard() {
            const dashboard = document.querySelector('.main-container');
            const authSection = document.getElementById('auth-section');
            const signOutBtn = document.getElementById('signOutBtn');
            
            dashboard.style.display = "block";
            authSection.style.display = "none";
            signOutBtn.style.display = "block";
            
            // Initialize dashboard
            setTimeout(() => {
                initializeDashboard();
            }, 500);
        }

        function hideDashboard() {
            const dashboard = document.querySelector('.main-container');
            const authSection = document.getElementById('auth-section');
            const signOutBtn = document.getElementById('signOutBtn');
            const userInfo = document.getElementById('userInfo');
            
            dashboard.style.display = "none";
            authSection.style.display = "flex";
            signOutBtn.style.display = "none";
            userInfo.style.display = "none";
            
            // Clear form
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
            document.getElementById('auth-status').style.display = 'none';
        }
        
        function updateConnectionStatus(status) {
            const statusEl = document.getElementById('connectionStatus');
            if (!statusEl) return;
            
            statusEl.className = `connection-status ${status}`;
            
            switch(status) {
                case 'connected':
                    statusEl.textContent = '🔥 Firebase Connected';
                    break;
                case 'connecting':
                    statusEl.textContent = '🔄 Connecting...';
                    break;
                case 'offline':
                    statusEl.textContent = '⚠️ Offline Mode';
                    break;
            }
        }

        // ========================================
        // DOWNLOAD SCREENSHOT FUNCTIONALITY
        // ========================================

        function selectFormat(format) {
            selectedFormat = format;
            
            // Update button states
            document.getElementById('formatPng').classList.toggle('active', format === 'png');
            document.getElementById('formatJpeg').classList.toggle('active', format === 'jpeg');
        }

        function openDownloadModal() {
            document.getElementById('downloadModal').style.display = 'flex';
            document.getElementById('downloadStatus').style.display = 'none';
            document.getElementById('previewSection').style.display = 'none';
            
            // Reset selections
            const checkboxes = document.querySelectorAll('.view-option input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            document.querySelectorAll('.view-option').forEach(option => {
                option.classList.remove('selected');
            });
        }

        function closeDownloadModal() {
            document.getElementById('downloadModal').style.display = 'none';
            document.getElementById('downloadStatus').style.display = 'none';
        }

        function previewSelections() {
            const selectedViews = [];
            const checkboxes = document.querySelectorAll('.view-option input[type="checkbox"]:checked');
            
            if (checkboxes.length === 0) {
                showDownloadStatus('❌ Please select at least one view to preview', 'error');
                return;
            }

            checkboxes.forEach(checkbox => {
                selectedViews.push(checkbox.value);
            });

            // Show preview section
            const previewSection = document.getElementById('previewSection');
            const previewContainer = document.getElementById('previewContainer');
            
            previewSection.style.display = 'block';
            
            let previewHTML = '<div style="display: flex; flex-direction: column; gap: 15px;">';
            
            selectedViews.forEach(viewType => {
                const viewInfo = getViewInfo(viewType);
                previewHTML += `
                    <div style="border: 1px solid var(--border-color); border-radius: 8px; padding: 15px;">
                        <h5 style="color: var(--primary-green); margin-bottom: 10px;">${viewInfo.name}</h5>
                        <p style="color: var(--medium-gray); font-size: 12px; margin-bottom: 10px;">${viewInfo.description}</p>
                        <div style="background: var(--light-gray); padding: 10px; border-radius: 4px; font-size: 11px; color: var(--medium-gray);">
                            📐 Estimated size: ${viewInfo.estimatedSize}<br>
                            📊 Format: ${selectedFormat.toUpperCase()}<br>
                            🎨 Quality: ${selectedFormat === 'png' ? 'Lossless' : 'Compressed'}
                        </div>
                    </div>
                `;
            });
            
            previewHTML += '</div>';
            previewContainer.innerHTML = previewHTML;
            
            showDownloadStatus(`✅ Preview ready! ${selectedViews.length} view(s) selected for download`, 'success');
        }

        function getViewInfo(viewType) {
            const viewInfoMap = {
                'complete': {
                    name: '📊 Complete Dashboard',
                    description: 'Full dashboard including KPIs, table, and all sections',
                    estimatedSize: 'Large (1200x2000px approx.)'
                },
                'kpi-dashboard': {
                    name: '📈 KPI Dashboard Section',
                    description: 'Key performance indicators and statistics',
                    estimatedSize: 'Medium (1200x800px approx.)'
                },
                'weekly-kpis': {
                    name: '📊 Weekly KPIs Overview',
                    description: 'Weekly availability cards only',
                    estimatedSize: 'Small (1200x400px approx.)'
                },
                'skills-table': {
                    name: '📋 Skills Performance Table',
                    description: 'Monthly skills performance table',
                    estimatedSize: 'Medium (1200x600px approx.)'
                },
                'daily-view': {
                    name: '📅 Daily Operations View',
                    description: 'Daily grid and statistics',
                    estimatedSize: 'Medium (1200x700px approx.)'
                },
                'skill-management': {
                    name: '🛠️ Skill Management Section',
                    description: 'Skills list and management interface',
                    estimatedSize: 'Small (1200x400px approx.)'
                }
            };
            
            return viewInfoMap[viewType] || { name: 'Unknown View', description: '', estimatedSize: 'Unknown' };
        }

        async function downloadScreenshots() {
            const selectedViews = [];
            const checkboxes = document.querySelectorAll('.view-option input[type="checkbox"]:checked');
            
            if (checkboxes.length === 0) {
                showDownloadStatus('❌ Please select at least one view to download', 'error');
                return;
            }

            checkboxes.forEach(checkbox => {
                selectedViews.push(checkbox.value);
            });

            try {
                showDownloadStatus('📸 Capturing screenshots...', 'loading');

                let successCount = 0;
                let errors = [];
                
                for (const viewType of selectedViews) {
                    try {
                        const targetElement = getTargetElement(viewType);
                        const viewInfo = getViewInfo(viewType);
                        
                        if (!targetElement || targetElement.offsetWidth === 0) {
                            errors.push(`${viewInfo.name}: Element not visible or available`);
                            continue;
                        }

                        // Capture screenshot with high quality options
                        const canvas = await html2canvas(targetElement, {
                            useCORS: true,
                            allowTaint: false,
                            scale: 2, // Higher quality
                            backgroundColor: '#ffffff',
                            logging: false,
                            width: targetElement.scrollWidth,
                            height: targetElement.scrollHeight,
                            onclone: function(clonedDoc) {
                                // Ensure all fonts are loaded in cloned document
                                const clonedTargetElement = clonedDoc.querySelector(`[data-view="${viewType}"]`) || targetElement;
                                if (clonedTargetElement) {
                                    clonedTargetElement.style.fontSize = '14px';
                                    clonedTargetElement.style.fontFamily = '"Segoe UI", Arial, sans-serif';
                                }
                            }
                        });

                        // Convert to desired format
                        const imageData = selectedFormat === 'png' ? 
                            canvas.toDataURL('image/png') : 
                            canvas.toDataURL('image/jpeg', 0.9);
                        
                        // Create download link
                        const link = document.createElement('a');
                        link.href = imageData;
                        
                        const timestamp = new Date().toISOString().slice(0, 19).replace(/[:\-T]/g, '');
                        const filename = `HBoard_${viewType}_${currentLandscape}_${timestamp}.${selectedFormat}`;
                        link.download = filename;
                        
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        
                        successCount++;
                        
                        // Small delay between downloads
                        await new Promise(resolve => setTimeout(resolve, 500));
                        
                    } catch (error) {
                        console.error(`Failed to capture ${viewType}:`, error);
                        errors.push(`${getViewInfo(viewType).name}: ${error.message}`);
                    }
                }

                if (successCount > 0) {
                    showDownloadStatus(`✅ Successfully downloaded ${successCount} screenshot(s)!${errors.length > 0 ? ` (${errors.length} failed)` : ''}`, 'success');
                    
                    // Log the action
                    logAction('Download Screenshots', `Downloaded ${successCount} screenshots in ${selectedFormat.toUpperCase()} format`);
                    
                    // Auto-close after 3 seconds
                    setTimeout(closeDownloadModal, 3000);
                } else {
                    showDownloadStatus(`❌ Failed to download screenshots. ${errors.length > 0 ? 'Errors: ' + errors.join(', ') : 'Unknown error occurred.'}`, 'error');
                }

            } catch (error) {
                console.error('Download screenshots error:', error);
                showDownloadStatus('❌ Failed to process screenshots: ' + error.message, 'error');
            }
        }

        function getTargetElement(viewType) {
            switch (viewType) {
                case 'complete':
                    return document.getElementById('monthlyView').style.display !== 'none' 
                        ? document.querySelector('.dashboard-container') 
                        : document.getElementById('dailyView');
                case 'kpi-dashboard':
                    return document.querySelector('.kpi-dashboard');
                case 'weekly-kpis':
                    return document.getElementById('weeklyKPIs');
                case 'skills-table':
                    return document.getElementById('monthlyTable');
                case 'daily-view':
                    return document.getElementById('dailyView');
                case 'skill-management':
                    return document.querySelector('.skill-management');
                default:
                    return document.querySelector('.dashboard-container');
            }
        }

        function showDownloadStatus(message, type) {
            const statusDiv = document.getElementById('downloadStatus');
            statusDiv.textContent = message;
            statusDiv.className = `download-status ${type}`;
            statusDiv.style.display = 'block';
        }

        // Handle checkbox selection visual feedback
        document.addEventListener('DOMContentLoaded', function() {
            const viewOptions = document.querySelectorAll('.view-option');
            viewOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const checkbox = this.querySelector('input[type="checkbox"]');
                    checkbox.checked = !checkbox.checked;
                    this.classList.toggle('selected', checkbox.checked);
                });
                
                const checkbox = option.querySelector('input[type="checkbox"]');
                checkbox.addEventListener('change', function() {
                    option.classList.toggle('selected', this.checked);
                });
            });
        });

        // ========================================
        // LANDSCAPE MANAGEMENT FUNCTIONS
        // ========================================

        function updateLandscapeSelect() {
            const landscapeSelect = document.getElementById('landscapeSelect');
            landscapeSelect.innerHTML = '';
            
            landscapesData.forEach(landscape => {
                const option = document.createElement('option');
                option.value = landscape;
                option.textContent = landscape;
                if (landscape === currentLandscape) {
                    option.selected = true;
                }
                landscapeSelect.appendChild(option);
            });
        }

        function addNewLandscape() {
            document.getElementById('addLandscapeModal').style.display = 'block';
            document.getElementById('newLandscapeName').focus();
        }

        function submitNewLandscape() {
            const landscapeName = document.getElementById('newLandscapeName').value.trim();
            
            if (!landscapeName) {
                alert('Please enter a landscape name');
                return false;
            }
            
            if (landscapesData.includes(landscapeName)) {
                alert('This landscape already exists');
                return false;
            }
            
            landscapesData.push(landscapeName);
            logAction('Add Landscape', `Added new landscape: ${landscapeName}`);
            closeModal('addLandscapeModal');
            updateLandscapeSelect();
            saveUserData(); // Auto-save
            
            // Switch to the newly added landscape
            currentLandscape = landscapeName;
            document.getElementById('landscapeSelect').value = landscapeName;
            refreshData();
            
            return false;
        }

        // ========================================
        // MAIN DASHBOARD FUNCTIONALITY
        // ========================================

        function initializeDashboard() {
            console.log('🚀 Initializing HBoard Operations Dashboard...');
            
            // Set current date values
            document.getElementById('monthSelect').value = currentMonth;
            document.getElementById('dateSelect').value = currentDate;
            
            // Update current month display
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            const [year, month] = currentMonth.split('-');
            document.getElementById('currentMonthDisplay').textContent = `${monthNames[parseInt(month) - 1]} ${year}`;
            
            // Add event listeners
            document.getElementById('landscapeSelect').addEventListener('change', refreshData);
            document.getElementById('monthSelect').addEventListener('change', refreshData);
            document.getElementById('dateSelect').addEventListener('change', refreshData);
            
            // Load user-specific data from Firestore
            loadUserData();
            
            // Initialize landscapes dropdown
            updateLandscapeSelect();
            
            // Load initial data
            refreshData();
            updateSkillsList();
            updateStatistics();
            
            console.log('✅ Dashboard initialized successfully with Firebase');
        }

        async function loadUserData() {
            if (!currentUser) return;
            
            try {
                const userDocRef = firestore.collection('users').doc(currentUser.uid);
                const userDataRef = userDocRef.collection('operationalData');
                
                // Load skills data
                const skillsDoc = await userDataRef.doc('skills').get();
                if (skillsDoc.exists) {
                    skillsData = skillsDoc.data().skills || skillsData;
                }
                
                // Load landscapes data
                const landscapesDoc = await userDataRef.doc('landscapes').get();
                if (landscapesDoc.exists) {
                    landscapesData = landscapesDoc.data().landscapes || landscapesData;
                }
                
                // Load operational data
                const operationalDoc = await userDataRef.doc('operational').get();
                if (operationalDoc.exists) {
                    operationalData = operationalDoc.data() || {};
                }
                
                // Load history log
                const historyDoc = await userDataRef.doc('history').get();
                if (historyDoc.exists) {
                    historyLog = historyDoc.data().log || [];
                }
                
                console.log('📊 User data loaded from Firestore');
                
            } catch (error) {
                console.error('❌ Error loading user data:', error);
                // Fallback to localStorage if Firestore fails
                loadDataFromLocalStorage();
            }
        }

        function loadDataFromLocalStorage() {
            const savedSkills = localStorage.getItem('hboard_skills_data');
            if (savedSkills) {
                skillsData = JSON.parse(savedSkills);
            }
            
            const savedLandscapes = localStorage.getItem('hboard_landscapes_data');
            if (savedLandscapes) {
                landscapesData = JSON.parse(savedLandscapes);
            }
            
            const savedOperationalData = localStorage.getItem('hboard_operational_data');
            if (savedOperationalData) {
                operationalData = JSON.parse(savedOperationalData);
            }
            
            const savedHistoryLog = localStorage.getItem('hboard_history_log');
            if (savedHistoryLog) {
                historyLog = JSON.parse(savedHistoryLog);
            }
        }

        async function saveUserData() {
            if (!currentUser) {
                // Fallback to localStorage if not authenticated
                localStorage.setItem('hboard_skills_data', JSON.stringify(skillsData));
                localStorage.setItem('hboard_landscapes_data', JSON.stringify(landscapesData));
                localStorage.setItem('hboard_operational_data', JSON.stringify(operationalData));
                localStorage.setItem('hboard_history_log', JSON.stringify(historyLog));
                return;
            }
            
            try {
                const userDocRef = firestore.collection('users').doc(currentUser.uid);
                const userDataRef = userDocRef.collection('operationalData');
                
                // Save skills data
                await userDataRef.doc('skills').set({
                    skills: skillsData,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Save landscapes data
                await userDataRef.doc('landscapes').set({
                    landscapes: landscapesData,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Save operational data
                await userDataRef.doc('operational').set({
                    ...operationalData,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Save history log (keep last 100 entries)
                if (historyLog.length > 100) {
                    historyLog = historyLog.slice(-100);
                }
                await userDataRef.doc('history').set({
                    log: historyLog,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                console.log('📊 User data saved to Firestore');
                
            } catch (error) {
                console.error('❌ Error saving user data:', error);
                // Fallback to localStorage
                localStorage.setItem('hboard_skills_data', JSON.stringify(skillsData));
                localStorage.setItem('hboard_landscapes_data', JSON.stringify(landscapesData));
                localStorage.setItem('hboard_operational_data', JSON.stringify(operationalData));
                localStorage.setItem('hboard_history_log', JSON.stringify(historyLog));
            }
        }

        function switchView(viewType) {
            currentView = viewType;
            
            // Update toggle buttons
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Show/hide appropriate controls and views
            const monthControl = document.getElementById('monthControl');
            const dateControl = document.getElementById('dateControl');
            const monthlyView = document.getElementById('monthlyView');
            const dailyView = document.getElementById('dailyView');
            
            if (viewType === 'daily') {
                monthControl.classList.add('hidden');
                dateControl.classList.remove('hidden');
                monthlyView.classList.add('hidden');
                dailyView.classList.remove('hidden');
                generateDailyView();
            } else {
                monthControl.classList.remove('hidden');
                dateControl.classList.add('hidden');
                monthlyView.classList.remove('hidden');
                dailyView.classList.add('hidden');
                generateMonthlyView();
            }
        }

        function refreshData() {
            currentLandscape = document.getElementById('landscapeSelect').value;
            
            if (currentView === 'monthly') {
                currentMonth = document.getElementById('monthSelect').value;
                generateMonthlyView();
                
                // Update month display
                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                    'July', 'August', 'September', 'October', 'November', 'December'];
                const [year, month] = currentMonth.split('-');
                document.getElementById('currentMonthDisplay').textContent = `${monthNames[parseInt(month) - 1]} ${year}`;
            } else {
                currentDate = document.getElementById('dateSelect').value;
                generateDailyView();
            }
            
            updateStatistics();
            saveUserData(); // Auto-save on data refresh
        }

        function generateMonthlyView() {
            console.log('📊 Generating monthly view...');
            
            const weeks = getWeeksInMonth(currentMonth);
            generateKPICards(weeks);
            generateMonthlyHeaders(weeks);
            generateMonthlyTableBody(weeks);
        }

        function getWeeksInMonth(monthYear) {
            const [year, month] = monthYear.split('-').map(Number);
            const firstDay = new Date(year, month - 1, 1);
            const lastDay = new Date(year, month, 0);
            
            const weeks = [];
            let currentWeek = 1;
            let currentDate = new Date(firstDay);
            
            while (currentDate <= lastDay) {
                const weekStart = new Date(currentDate);
                const weekEnd = new Date(Math.min(currentDate.getTime() + 6 * 24 * 60 * 60 * 1000, lastDay.getTime()));
                
                weeks.push({
                    number: currentWeek,
                    label: `WK ${currentWeek}`,
                    start: weekStart.getDate(),
                    end: weekEnd.getDate(),
                    dates: getWeekDates(weekStart, weekEnd)
                });
                
                currentDate.setTime(weekEnd.getTime() + 24 * 60 * 60 * 1000);
                currentWeek++;
            }
            
            return weeks;
        }

        function getWeekDates(start, end) {
            const dates = [];
            const currentDate = new Date(start);
            
            while (currentDate <= end) {
                dates.push(new Date(currentDate));
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            return dates;
        }

        function generateKPICards(weeks) {
            const kpiGrid = document.getElementById('kpiGrid');
            let kpiHTML = '';
            
            weeks.forEach((week, index) => {
                // Sample data - in real implementation, calculate from actual data
                const percentage = index === 0 ? 100 : 0;
                const colorClass = percentage >= 95 ? 'green' : percentage >= 45 ? 'amber' : 'red';
                
                kpiHTML += `
                    <div class="kpi-card">
                        <div class="kpi-value ${colorClass}">${percentage}%</div>
                        <div class="kpi-label">${week.label} Availability</div>
                    </div>
                `;
            });
            
            kpiGrid.innerHTML = kpiHTML;
        }

        function generateMonthlyHeaders(weeks) {
            const headersContainer = document.getElementById('monthlyHeaders');
            let headerHTML = '<tr><th class="skill-header">Skills / Operational Areas</th>';
            
            weeks.forEach(week => {
                headerHTML += `<th>${week.label}<br><small>${week.start}-${week.end}</small></th>`;
            });
            
            headerHTML += '</tr>';
            headersContainer.innerHTML = headerHTML;
        }

        function generateMonthlyTableBody(weeks) {
            const bodyContainer = document.getElementById('monthlyBody');
            let bodyHTML = '';
            
            skillsData.forEach((skill, skillIndex) => {
                bodyHTML += `<tr><td class="skill-name" title="${skill}">${skill}</td>`;
                
                weeks.forEach((week, weekIndex) => {
                    // Sample data - replace with actual operational data
                    const percentage = (skillIndex === 0 && weekIndex === 0) ? 100 : 0;
                    const statusClass = percentage >= 95 ? 'green' : percentage >= 45 ? 'amber' : percentage > 0 ? 'red' : 'empty';
                    const filledDays = percentage >= 95 ? 7 : percentage >= 45 ? Math.floor(percentage / 100 * 7) : 0;
                    
                    bodyHTML += `
                        <td class="status-cell" onclick="editCell('${skill}', '${week.label}')">
                            <div class="status-dot ${statusClass}">
                                ${percentage > 0 ? percentage + '%' : '--'}
                            </div>
                            <div class="status-indicators">
                                ${generateStatusIndicators(7, filledDays)}
                            </div>
                        </td>
                    `;
                });
                
                bodyHTML += '</tr>';
            });
            
            bodyContainer.innerHTML = bodyHTML;
        }

        function generateStatusIndicators(total, filled) {
            let indicators = '';
            for (let i = 0; i < total; i++) {
                const className = i < filled ? 'status-indicator filled' : 'status-indicator';
                indicators += `<div class="${className}"></div>`;
            }
            return indicators;
        }

        function generateDailyView() {
            console.log('📅 Generating daily view...');
            
            const selectedDate = new Date(currentDate);
            const weekStart = new Date(selectedDate);
            weekStart.setDate(selectedDate.getDate() - selectedDate.getDay());
            
            generateDailyStats();
            generateDailyGrid(weekStart);
        }

        function generateDailyStats() {
            // Sample statistics - replace with actual calculations
            document.getElementById('todayAverage').textContent = '75%';
            document.getElementById('weeklyAverage').textContent = '68%';
            document.getElementById('trendIndicator').textContent = '📈';
        }

        function generateDailyGrid(weekStart) {
            const gridContainer = document.getElementById('dailyGrid');
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            
            let gridHTML = '<div class="daily-header">Skills</div>';
            
            // Generate day headers
            for (let i = 0; i < 7; i++) {
                const currentDay = new Date(weekStart);
                currentDay.setDate(weekStart.getDate() + i);
                
                gridHTML += `
                    <div class="daily-header">
                        ${dayNames[i]}<br>
                        <small>${currentDay.getDate()}/${currentDay.getMonth() + 1}</small>
                    </div>
                `;
            }
            
            // Generate skill rows
            skillsData.forEach((skill, skillIndex) => {
                gridHTML += `<div class="daily-skill" title="${skill}">${skill}</div>`;
                
                // Generate daily cells for each skill
                for (let i = 0; i < 7; i++) {
                    // Sample data - replace with actual data
                    const hasData = skillIndex === 0 && i < 3; // Sample: first skill has data for first 3 days
                    const percentage = hasData ? 100 : 0;
                    const statusClass = hasData ? 'green' : 'empty';
                    
                    gridHTML += `
                        <div class="daily-cell" onclick="editDailyCell('${skill}', ${i})">
                            <div class="status-dot ${statusClass}">
                                ${hasData ? '✓' : '--'}
                            </div>
                            <div style="font-size: 10px; font-weight: 600; color: var(--primary-green); margin-top: 4px;">
                                ${percentage}%
                            </div>
                        </div>
                    `;
                }
            });
            
            gridContainer.innerHTML = gridHTML;
        }

        function updateStatistics() {
            // Calculate statistics from current data
            let totalEntries = 0;
            let optimalCount = 0;
            let attentionCount = 0;
            let criticalCount = 0;

            // Sample calculations - replace with actual data analysis
            totalEntries = skillsData.length * 5; // 5 weeks of data per skill
            optimalCount = 1; // One entry at 100%
            attentionCount = 0;
            criticalCount = totalEntries - optimalCount - attentionCount;

            // Update DOM elements
            document.getElementById('totalEntries').textContent = totalEntries;
            document.getElementById('optimalCount').textContent = optimalCount;
            document.getElementById('attentionCount').textContent = attentionCount;
            document.getElementById('criticalCount').textContent = criticalCount;

            // Update performance metrics
            const monthlyPerf = Math.round((optimalCount / totalEntries) * 100) || 0;
            const yearlyPerf = Math.round(monthlyPerf * 0.8) || 0; // Sample yearly calculation

            document.getElementById('monthlyPerformance').textContent = monthlyPerf + '%';
            document.getElementById('yearlyPerformance').textContent = yearlyPerf + '%';

            // Update trend indicators
            document.getElementById('monthlyTrend').textContent = monthlyPerf > 50 ? '📈 Improving' : '📉 Needs Attention';
            document.getElementById('yearlyTrend').textContent = yearlyPerf > 50 ? '📈 Stable Growth' : '📉 Focus Required';

            // Store updated statistics
            statisticsData = {
                totalEntries,
                optimalCount,
                attentionCount,
                criticalCount,
                monthlyPerformance: monthlyPerf,
                yearlyPerformance: yearlyPerf
            };
        }

        // ========================================
        // SKILL MANAGEMENT FUNCTIONS
        // ========================================

        function updateSkillsList() {
            const skillsList = document.getElementById('skillsList');
            let skillsHTML = '';

            skillsData.forEach((skill, index) => {
                skillsHTML += `
                    <div class="skill-item">
                        <div class="skill-item-name">${skill}</div>
                        <div class="skill-item-actions">
                            <button class="skill-action-btn edit" onclick="editSkill(${index})">✏️ Edit</button>
                            <button class="skill-action-btn delete" onclick="deleteSkill(${index})">🗑️ Delete</button>
                        </div>
                    </div>
                `;
            });

            skillsList.innerHTML = skillsHTML || '<p style="color: var(--medium-gray);">No skills added yet.</p>';
        }

        function addSkillFromInput() {
            const skillInput = document.getElementById('newSkillInput');
            const skillName = skillInput.value.trim();

            if (!skillName) {
                alert('Please enter a skill name');
                return;
            }

            if (skillsData.includes(skillName)) {
                alert('This skill already exists');
                return;
            }

            skillsData.push(skillName);
            skillInput.value = '';
            updateSkillsList();
            refreshData();
            logAction('Add Skill', `Added new skill: ${skillName}`);
            saveUserData(); // Auto-save

            console.log('✅ Skill added:', skillName);
        }

        function editSkill(index) {
            const currentName = skillsData[index];
            const newName = prompt('Enter new skill name:', currentName);

            if (newName && newName.trim() && newName !== currentName) {
                const trimmedName = newName.trim();
                
                if (skillsData.includes(trimmedName)) {
                    alert('This skill name already exists');
                    return;
                }

                skillsData[index] = trimmedName;
                updateSkillsList();
                refreshData();
                logAction('Edit Skill', `Changed "${currentName}" to "${trimmedName}"`);
                saveUserData(); // Auto-save

                console.log('✅ Skill edited:', trimmedName);
            }
        }

        function deleteSkill(index) {
            const skillName = skillsData[index];
            
            if (confirm(`Are you sure you want to delete "${skillName}"?\n\nThis will remove all associated data.`)) {
                skillsData.splice(index, 1);
                updateSkillsList();
                refreshData();
                logAction('Delete Skill', `Deleted skill: ${skillName}`);
                saveUserData(); // Auto-save

                console.log('🗑️ Skill deleted:', skillName);
            }
        }

        // ========================================
        // UTILITY FUNCTIONS
        // ========================================

        function editCell(skill, week) {
            console.log(`Editing: ${skill} - ${week}`);
            // In a real implementation, this would open an editing interface
            const newValue = prompt(`Edit ${skill} for ${week}:\n\nEnter percentage (0-100):`);
            
            if (newValue !== null && !isNaN(newValue) && newValue >= 0 && newValue <= 100) {
                console.log(`Updated ${skill} ${week} to ${newValue}%`);
                logAction('Edit Cell', `Updated ${skill} ${week} to ${newValue}%`);
                // In real implementation, save to operationalData and refresh view
                saveUserData(); // Auto-save
            }
        }

        function editDailyCell(skill, dayIndex) {
            console.log(`Editing daily: ${skill} - Day ${dayIndex}`);
            // In a real implementation, this would open an editing interface
            const newValue = prompt(`Edit ${skill} for day ${dayIndex}:\n\nEnter percentage (0-100):`);
            
            if (newValue !== null && !isNaN(newValue) && newValue >= 0 && newValue <= 100) {
                console.log(`Updated ${skill} day ${dayIndex} to ${newValue}%`);
                logAction('Edit Daily Cell', `Updated ${skill} day ${dayIndex} to ${newValue}%`);
                // In real implementation, save to operationalData and refresh view
                saveUserData(); // Auto-save
            }
        }

        function addNewSkill() {
            document.getElementById('addSkillModal').style.display = 'block';
            document.getElementById('newSkillName').focus();
        }

        function submitNewSkill() {
            const skillName = document.getElementById('newSkillName').value.trim();
            
            if (!skillName) {
                alert('Please enter a skill name');
                return false;
            }
            
            if (skillsData.includes(skillName)) {
                alert('This skill already exists');
                return false;
            }
            
            skillsData.push(skillName);
            logAction('Add Skill', `Added new skill: ${skillName}`);
            closeModal('addSkillModal');
            updateSkillsList();
            refreshData();
            saveUserData(); // Auto-save
            
            return false;
        }

        function exportToExcel() {
            console.log('📊 Exporting to Excel...');
            
            // In a real implementation, this would generate an actual Excel file
            const data = {
                landscape: currentLandscape,
                month: currentMonth,
                skills: skillsData,
                landscapes: landscapesData,
                statistics: statisticsData,
                timestamp: new Date().toISOString(),
                user: currentUser ? currentUser.email : 'anonymous'
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `hboard-export-${currentLandscape}-${currentMonth}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            logAction('Export Data', `Exported data for ${currentLandscape} - ${currentMonth}`);
            alert('✅ Data exported successfully!');
        }

        function importData() {
            document.getElementById('importModal').style.display = 'block';
        }

        function processImport() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a file to import');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Process imported data
                    if (data.skills && Array.isArray(data.skills)) {
                        skillsData = [...new Set([...skillsData, ...data.skills])]; // Merge and deduplicate
                    }

                    if (data.landscapes && Array.isArray(data.landscapes)) {
                        landscapesData = [...new Set([...landscapesData, ...data.landscapes])]; // Merge and deduplicate
                    }
                    
                    if (data.operationalData) {
                        Object.assign(operationalData, data.operationalData);
                    }
                    
                    logAction('Import Data', `Imported data from ${file.name}`);
                    closeModal('importModal');
                    updateSkillsList();
                    updateLandscapeSelect();
                    refreshData();
                    saveUserData(); // Auto-save
                    alert('✅ Data imported successfully!');
                    
                } catch (error) {
                    console.error('Import error:', error);
                    alert('❌ Error importing file: Invalid format');
                }
            };
            
            reader.readAsText(file);
        }

        function viewHistory() {
            document.getElementById('historyModal').style.display = 'block';
            
            const historyContent = document.getElementById('historyContent');
            
            if (historyLog.length === 0) {
                historyContent.innerHTML = '<p style="text-align: center; color: var(--medium-gray);">No history available yet. Start using the dashboard to see activity logs here.</p>';
                return;
            }
            
            let historyHTML = '<div style="space-y: 10px;">';
            
            historyLog.slice(-20).reverse().forEach(entry => { // Show last 20 entries
                historyHTML += `
                    <div style="padding: 12px; border-left: 3px solid var(--primary-green); background: var(--light-gray); margin-bottom: 8px; border-radius: 4px;">
                        <div style="font-weight: 600; color: var(--primary-green);">${entry.action}</div>
                        <div style="font-size: 12px; color: var(--medium-gray); margin-top: 4px;">
                            ${entry.details} • ${entry.timestamp}
                        </div>
                    </div>
                `;
            });
            
            historyHTML += '</div>';
            historyContent.innerHTML = historyHTML;
        }

        function clearData() {
            if (confirm('⚠️ Are you sure you want to clear all operational data?\n\nThis will not delete skills or landscapes, but will remove all performance data.\n\nThis action cannot be undone.')) {
                operationalData = {};
                logAction('Clear Data', 'All operational data cleared');
                refreshData();
                saveUserData(); // Auto-save
                alert('✅ Operational data cleared successfully!');
            }
        }

        function syncData() {
            console.log('🔄 Syncing data...');
            
            // Force save to Firestore
            saveUserData();
            
            // Simulate sync process
            const syncMessage = document.createElement('div');
            syncMessage.innerHTML = '🔄 Syncing with Firebase...';
            syncMessage.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--primary-green);
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                font-weight: 600;
                z-index: 1001;
                box-shadow: var(--shadow-medium);
                animation: slideInRight 0.3s ease-out;
            `;
            
            document.body.appendChild(syncMessage);
            
            setTimeout(() => {
                syncMessage.innerHTML = '✅ Firebase sync complete!';
                setTimeout(() => {
                    if (document.body.contains(syncMessage)) {
                        document.body.removeChild(syncMessage);
                    }
                }, 2000);
            }, 1500);
            
            logAction('Sync Data', 'Data synchronized with Firebase successfully');
        }

        function logAction(action, details) {
            const entry = {
                action: action,
                details: details,
                timestamp: new Date().toLocaleString(),
                user: currentUser ? currentUser.email : 'Anonymous User',
                landscape: currentLandscape
            };
            
            historyLog.push(entry);
            
            // Keep only last 100 entries
            if (historyLog.length > 100) {
                historyLog = historyLog.slice(-100);
            }
            
            // Auto-save history (debounced)
            setTimeout(() => saveUserData(), 1000);
        }

        // ========================================
        // MODAL MANAGEMENT
        // ========================================

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            
            // Reset forms
            const modal = document.getElementById(modalId);
            const inputs = modal.querySelectorAll('input, textarea, select');
            inputs.forEach(input => {
                if (input.type !== 'file') {
                    input.value = '';
                }
            });
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal') || event.target.classList.contains('download-modal')) {
                if (event.target.id === 'downloadModal') {
                    closeDownloadModal();
                } else {
                    closeModal(event.target.id);
                }
            }
        }

        // Keyboard shortcuts and accessibility
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                // Close any open modal
                const modals = document.querySelectorAll('.modal, .download-modal');
                modals.forEach(modal => {
                    if (modal.style.display === 'block' || modal.style.display === 'flex') {
                        if (modal.id === 'downloadModal') {
                            closeDownloadModal();
                        } else {
                            closeModal(modal.id);
                        }
                    }
                });
            }
        });

        // Add keyboard support for skill input
        document.addEventListener('DOMContentLoaded', function() {
            const newSkillInput = document.getElementById('newSkillInput');
            if (newSkillInput) {
                newSkillInput.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter') {
                        addSkillFromInput();
                    }
                });
            }
        });

        // ========================================
        // INITIALIZATION
        // ========================================

        // Initialize dashboard when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Load initial data from localStorage as fallback
            loadDataFromLocalStorage();
            
            // Log system startup
            logAction('System Startup', 'HBoard Operations Dashboard initialized with Firebase Authentication and Landscape Management');
            
            console.log('✅ Dashboard data loaded');
            updateConnectionStatus('connecting');
        });

        // Add CSS animation keyframes dynamically
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from {
                    opacity: 0;
                    transform: translateX(100px);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }
        `;
        document.head.appendChild(style);

        // Console welcome message
        console.log(`
🔹 HBoard - Advanced Operations Excellence Dashboard v2024.09.08 🔹
✅ Production-ready dashboard loaded successfully
🔐 Authentication: Firebase Email/Password Only
🌍 Landscape Management: Add custom landscapes dynamically
📸 Screenshot Download: High-quality PNG/JPEG with view selection
📊 Skills Management: Full CRUD operations with Firestore sync
🔄 Real-time Sync: Firebase Firestore integration
🎨 Responsive Design: Optimized for all devices
📱 Mobile Ready: Touch-friendly interface
🚀 Ready for enterprise deployment and internship presentation
        `);
    </script>
</body>
</html>

